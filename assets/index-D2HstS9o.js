import{_ as I}from"./index-DkoMvkBT.js";import{a as s}from"./antd-Cl3cKmq-.js";var M=function(r){return function(a,e){var t=s.useRef(!1);r(function(){return function(){t.current=!1}},[]),r(function(){if(!t.current)t.current=!0;else return a()},e)}},h=function(r){return typeof r=="function"},B=function(r){return typeof r=="number"},U=function(r){return typeof r>"u"};function V(r){var a=s.useRef(r);a.current=s.useMemo(function(){return r},[r]);var e=s.useRef();return e.current||(e.current=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return a.current.apply(this,t)}),e.current}const F=M(s.useEffect);function _(r,a){if(r===a)return!0;for(var e=0;e<r.length;e++)if(!Object.is(r[e],a[e]))return!1;return!0}function z(r){var a=s.useRef(r);return a.current=r,a}var W=function(r){var a=z(r);s.useEffect(function(){return function(){a.current()}},[])},L=!!(typeof window<"u"&&window.document&&window.document.createElement);function T(r,a){if(L){if(!r)return a;var e;return h(r)?e=r():"current"in r?e=r.current:e=r,e}}var x=function(r){var a=function(e,t,n){var l=s.useRef(!1),c=s.useRef([]),d=s.useRef([]),i=s.useRef();r(function(){var f,g=Array.isArray(n)?n:[n],o=g.map(function(E){return T(E)});if(!l.current){l.current=!0,c.current=o,d.current=t,i.current=e();return}(o.length!==c.current.length||!_(c.current,o)||!_(d.current,t))&&((f=i.current)===null||f===void 0||f.call(i),c.current=o,d.current=t,i.current=e())}),W(function(){var f;(f=i.current)===null||f===void 0||f.call(i),l.current=!1})};return a},G=x(s.useEffect);function y(r,a,e){e===void 0&&(e={});var t=e.enable,n=t===void 0?!0:t,l=z(a);G(function(){if(n){var c=T(e.target,window);if(c!=null&&c.addEventListener){var d=function(f){return l.current(f)},i=Array.isArray(r)?r:[r];return i.forEach(function(f){c.addEventListener(f,d,{capture:e.capture,once:e.once,passive:e.passive})}),function(){i.forEach(function(f){c.removeEventListener(f,d,{capture:e.capture})})}}}},[r,e.capture,e.once,e.passive,n],e.target)}var b="AHOOKS_SYNC_STORAGE_EVENT_NAME";function J(r){function a(e,t){t===void 0&&(t={});var n,l=t.listenStorageChange,c=l===void 0?!1:l,d=t.onError,i=d===void 0?function(u){console.error(u)}:d;try{n=r()}catch(u){i(u)}var f=function(u){return t.serializer?t.serializer(u):JSON.stringify(u)},g=function(u){return t.deserializer?t.deserializer(u):JSON.parse(u)};function o(){try{var u=n==null?void 0:n.getItem(e);if(u)return g(u)}catch(v){i(v)}return h(t.defaultValue)?t.defaultValue():t.defaultValue}var E=I(s.useState(o),2),R=E[0],S=E[1];F(function(){S(o())},[e]);var w=function(u){var v=h(u)?u(R):u;c||S(v);try{var m=void 0,O=n==null?void 0:n.getItem(e);U(v)?(m=null,n==null||n.removeItem(e)):(m=f(v),n==null||n.setItem(e,m)),dispatchEvent(new CustomEvent(b,{detail:{key:e,newValue:m,oldValue:O,storageArea:n}}))}catch(C){i(C)}},A=function(u){u.key!==e||u.storageArea!==n||S(o())},N=function(u){A(u.detail)};return y("storage",A,{enable:c}),y(b,N,{enable:c}),[R,V(w)]}return a}var H=J(function(){return L?localStorage:void 0});export{z as a,B as i,H as u};
