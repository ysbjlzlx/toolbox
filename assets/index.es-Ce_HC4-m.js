import{t as _}from"./index-6kZY_JYa.js";import{c as O,f as P,o as v,s as B}from"./floating-ui.dom-DtR07Cup.js";import{h as I,u as j,p as q}from"./index-BKZqlHfW.js";import{P as H,a as K,T as L}from"./index-CCHPmTqj.js";var S=t=>{throw TypeError(t)},W=(t,e,s)=>e.has(t)||S("Cannot "+s),a=(t,e,s)=>(W(t,e,"read from private field"),e.get(t)),n=(t,e,s)=>e.has(t)?S("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),o=(t,e,s,i)=>(W(t,e,"write to private field"),e.set(t,s),s),N=(t,e,s)=>(W(t,e,"access private method"),s),w,u,k,m,g,r,c,y,M,T;class V{constructor(e){n(this,M),n(this,w),n(this,u),n(this,k),n(this,m),n(this,g),n(this,r),n(this,c),n(this,y),o(this,r,!1),this.onShow=()=>{},this.onHide=()=>{},o(this,y,(s,i)=>{const{state:h,composing:l}=s,{selection:d,doc:x}=h,{ranges:f}=d,$=Math.min(...f.map(p=>p.$from.pos)),b=Math.max(...f.map(p=>p.$to.pos)),C=i&&i.doc.eq(x)&&i.selection.eq(d);if(a(this,r)||((a(this,g)??s.dom.parentElement??document.body).appendChild(this.element),o(this,r,!0)),!(l||C)){if(!a(this,u).call(this,s,i)){this.hide();return}O({getBoundingClientRect:()=>q(s,$,b)},this.element,{placement:a(this,m).placement??"top",middleware:[P(),v(a(this,c)),B(),...a(this,k)]}).then(({x:p,y:E})=>{Object.assign(this.element.style,{left:`${p}px`,top:`${E}px`})}),this.show()}}),this.update=(s,i)=>{_(a(this,y),a(this,w))(s,i)},this.destroy=()=>{},this.show=s=>{this.element.dataset.show="true",s&&O(s,this.element,{placement:"top",middleware:[P(),v(a(this,c))],...a(this,m)}).then(({x:i,y:h})=>{Object.assign(this.element.style,{left:`${i}px`,top:`${h}px`})}),this.onShow()},this.hide=()=>{this.element.dataset.show!=="false"&&(this.element.dataset.show="false",this.onHide())},this.element=e.content,o(this,w,e.debounce??200),o(this,u,e.shouldShow??N(this,M,T)),o(this,c,e.offset),o(this,k,e.middleware??[]),o(this,m,e.floatingUIOptions??{}),o(this,g,e.root),this.element.dataset.show="false"}}w=new WeakMap,u=new WeakMap,k=new WeakMap,m=new WeakMap,g=new WeakMap,r=new WeakMap,c=new WeakMap,y=new WeakMap,M=new WeakSet,T=function(t){const{doc:e,selection:s}=t.state,{empty:i,from:h,to:l}=s,d=!e.textBetween(h,l).length&&t.state.selection instanceof L,x=this.element.contains(document.activeElement),f=!t.hasFocus()&&!x,$=!t.editable;return!(f||i||d||$)};function z(t){const e=I({},`${t}_TOOLTIP_SPEC`),s=j(h=>{const l=h.get(e.key);return new H({key:new K(`${t}_TOOLTIP`),...l})}),i=[e,s];return i.key=e.key,i.pluginKey=s.key,e.meta={package:"@milkdown/plugin-tooltip",displayName:`Ctx<tooltipSpec>|${t}`},s.meta={package:"@milkdown/plugin-tooltip",displayName:`Prose<tooltip>|${t}`},i}export{V,z as W};
