const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B3KiKTSt-D-0R8ytP.js","assets/json-editor-D3HpTOiY.js","assets/antd-Cl3cKmq-.js","assets/pro-components-CPZIsSOc.js","assets/index-l9gUu6zl.js","assets/functions-Bsik6ikd-D8GGRsLx.js","assets/index.es-Bnv9eU2G.js","assets/hooks-Dt0wL0oo.js","assets/floating-ui.dom-DtR07Cup.js","assets/index-DkoMvkBT.js","assets/index-BI54Kwls.css","assets/index-CCHPmTqj.js","assets/syntax-2Kab1CR3.js","assets/index.browser-B0na17u1.js","assets/index-BUFMBfDr.js","assets/index-Cuk7cL-r-DWOVfCnx.js","assets/index-DcRgwPLd-r494DdVH.js","assets/index.es-D1kMcbY8.js","assets/index.es-Ce_HC4-m.js","assets/index-6kZY_JYa.js","assets/index-BFsG6770-DyI06fmS.js","assets/index.es-DqAO6ekn.js","assets/index-CxJ9fxJm-Izpfm4Xj.js","assets/index-DI1WyLXJ.js","assets/index-Yr5XBaro-ChW6bAZ_.js","assets/index-D6fLMv29-CeGVhQwU.js","assets/index-DOrkOhki-CGtavRST.js","assets/index-COPjfgxB-DeLTiUBN.js","assets/inline-latex-C9IGAXXQ-Bi8O4X4y.js","assets/index-CBrOT1fW-BwfKVNs4.js","assets/index-DO_xaFxN-B4bO0yn7.js"])))=>i.map(i=>d[i]);
import{af as Qa}from"./pro-components-CPZIsSOc.js";import{D as Za,a as ir}from"./antd-Cl3cKmq-.js";import{_ as ae}from"./json-editor-D3HpTOiY.js";import{M as kn,f as el,c as tl,P as z,a as F,N as Gs,S as nl,k as Js,E as rl,b as ol,D as Xs,d as sl,e as il,g as al,s as ll,j as cl,h as ul,i as ws,t as Yn,T as G,l as Kt,w as Yr,m as q,n as dl,o as Ys,p as pl,q as lt,r as ct,R as hl,A as fl,F as de,u as ml,v as Ie,x as gl,y as yl,z as wl,B as kl,C as bl,G as Cl,H as xl}from"./index-CCHPmTqj.js";import{e as Ml,t as Nl,V as Sl,y as Xt,S as ks,z as Al,v as $l,o as Qr,c as bs,u as ut,A as Zr,B as Yt,i as vl,q as Il,l as Tl,g as El,n as Rl,j as _l,x as eo,r as Vt,b as pe,C as Ll,D as Dl,f as Qs,E as Ol,h as Pl,p as Fl,k as zl}from"./syntax-2Kab1CR3.js";import{c as Wl}from"./index.browser-B0na17u1.js";import{q as jl}from"./index-BUFMBfDr.js";function Hl(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}var j=(t=>(t.docTypeError="docTypeError",t.contextNotFound="contextNotFound",t.timerNotFound="timerNotFound",t.ctxCallOutOfScope="ctxCallOutOfScope",t.createNodeInParserFail="createNodeInParserFail",t.stackOverFlow="stackOverFlow",t.parserMatchError="parserMatchError",t.serializerMatchError="serializerMatchError",t.getAtomFromSchemaFail="getAtomFromSchemaFail",t.expectDomTypeError="expectDomTypeError",t.callCommandBeforeEditorView="callCommandBeforeEditorView",t.missingRootElement="missingRootElement",t.missingNodeInSchema="missingNodeInSchema",t.missingMarkInSchema="missingMarkInSchema",t.ctxNotBind="ctxNotBind",t.missingYjsDoc="missingYjsDoc",t))(j||{});let J=class extends Error{constructor(e,n){super(n),this.name="MilkdownError",this.code=e}};const Bl=(t,e)=>typeof e=="function"?"[Function]":e,dt=t=>JSON.stringify(t,Bl);function Kl(t){return new J(j.docTypeError,`Doc type error, unsupported type: ${dt(t)}`)}function Vl(t){return new J(j.contextNotFound,`Context "${t}" not found, do you forget to inject it?`)}function ql(t){return new J(j.timerNotFound,`Timer "${t}" not found, do you forget to record it?`)}function to(){return new J(j.ctxCallOutOfScope,"Should not call a context out of the plugin.")}function Ul(...t){const e=t.reduce((n,r)=>{if(!r)return n;const o=s=>Array.isArray(s)?s.map(i=>o(i)).join(", "):s.toJSON?dt(s.toJSON()):s.spec?dt(s.spec):s.toString();return`${n}, ${o(r)}`},"Create prosemirror node from remark failed in parser");return new J(j.createNodeInParserFail,e)}function Zs(){return new J(j.stackOverFlow,"Stack over flow, cannot pop on an empty stack.")}function Gl(t){return new J(j.parserMatchError,`Cannot match target parser for node: ${dt(t)}.`)}function Jl(t){return new J(j.serializerMatchError,`Cannot match target serializer for node: ${dt(t)}.`)}function Xl(t,e){return new J(j.getAtomFromSchemaFail,`Cannot get ${t}: ${e} from schema.`)}function me(t){return new J(j.expectDomTypeError,`Expect to be a dom, but get: ${dt(t)}.`)}function Yl(){return new J(j.callCommandBeforeEditorView,"You're trying to call a command before editor view initialized, make sure to get commandManager from ctx after editor view has been initialized")}function Ql(t){return new J(j.missingNodeInSchema,`Missing node in schema, milkdown cannot find "${t}" in schema.`)}function Zl(t){return new J(j.missingMarkInSchema,`Missing mark in schema, milkdown cannot find "${t}" in schema.`)}var ei=t=>{throw TypeError(t)},ti=(t,e,n)=>e.has(t)||ei("Cannot "+n),y=(t,e,n)=>(ti(t,e,"read from private field"),n?n.call(t):e.get(t)),_=(t,e,n)=>e.has(t)?ei("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),S=(t,e,n,r)=>(ti(t,e,"write to private field"),e.set(t,n),n);let ni=class{constructor(){this.sliceMap=new Map,this.get=e=>{const n=typeof e=="string"?[...this.sliceMap.values()].find(r=>r.type.name===e):this.sliceMap.get(e.id);if(!n){const r=typeof e=="string"?e:e.name;throw Vl(r)}return n},this.remove=e=>{const n=typeof e=="string"?[...this.sliceMap.values()].find(r=>r.type.name===e):this.sliceMap.get(e.id);n&&this.sliceMap.delete(n.type.id)},this.has=e=>typeof e=="string"?[...this.sliceMap.values()].some(n=>n.type.name===e):this.sliceMap.has(e.id)}};var le,Ce,bt;let ec=class{constructor(e,n,r){_(this,le),_(this,Ce),_(this,bt),S(this,le,[]),S(this,bt,()=>{y(this,le).forEach(o=>o(y(this,Ce)))}),this.set=o=>{S(this,Ce,o),y(this,bt).call(this)},this.get=()=>y(this,Ce),this.update=o=>{S(this,Ce,o(y(this,Ce))),y(this,bt).call(this)},this.type=r,S(this,Ce,n),e.set(r.id,this)}on(e){return y(this,le).push(e),()=>{S(this,le,y(this,le).filter(n=>n!==e))}}once(e){const n=this.on(r=>{e(r),n()});return n}off(e){S(this,le,y(this,le).filter(n=>n!==e))}offAll(){S(this,le,[])}};le=new WeakMap,Ce=new WeakMap,bt=new WeakMap;let tc=class{constructor(e,n){this.id=Symbol(`Context-${n}`),this.name=n,this._defaultValue=e,this._typeInfo=()=>{throw to()}}create(e,n=this._defaultValue){return new ec(e,n,this)}};const N=(t,e)=>new tc(t,e);var bn,Cn,xn,Ge,Ct,Fe,xt,Mt,Nt;let nc=class{constructor(e,n,r){_(this,bn),_(this,Cn),_(this,xn),_(this,Ge),_(this,Ct),_(this,Fe),_(this,xt),_(this,Mt),_(this,Nt),S(this,Ge,new Set),S(this,Ct,new Set),S(this,Fe,new Map),S(this,xt,new Map),this.read=()=>({metadata:y(this,bn),injectedSlices:[...y(this,Ge)].map(o=>({name:typeof o=="string"?o:o.name,value:y(this,Mt).call(this,o)})),consumedSlices:[...y(this,Ct)].map(o=>({name:typeof o=="string"?o:o.name,value:y(this,Mt).call(this,o)})),recordedTimers:[...y(this,Fe)].map(([o,{duration:s}])=>({name:o.name,duration:s,status:y(this,Nt).call(this,o)})),waitTimers:[...y(this,xt)].map(([o,{duration:s}])=>({name:o.name,duration:s,status:y(this,Nt).call(this,o)}))}),this.onRecord=o=>{y(this,Fe).set(o,{start:Date.now(),duration:0})},this.onClear=o=>{y(this,Fe).delete(o)},this.onDone=o=>{const s=y(this,Fe).get(o);s&&(s.duration=Date.now()-s.start)},this.onWait=(o,s)=>{const i=Date.now();s.finally(()=>{y(this,xt).set(o,{duration:Date.now()-i})})},this.onInject=o=>{y(this,Ge).add(o)},this.onRemove=o=>{y(this,Ge).delete(o)},this.onUse=o=>{y(this,Ct).add(o)},S(this,Mt,o=>y(this,Cn).get(o).get()),S(this,Nt,o=>y(this,xn).get(o).status),S(this,Cn,e),S(this,xn,n),S(this,bn,r)}};bn=new WeakMap,Cn=new WeakMap,xn=new WeakMap,Ge=new WeakMap,Ct=new WeakMap,Fe=new WeakMap,xt=new WeakMap,Mt=new WeakMap,Nt=new WeakMap;var xe,Me,Mn,ne;const rc=class ri{constructor(e,n,r){_(this,xe),_(this,Me),_(this,Mn),_(this,ne),this.produce=o=>o&&Object.keys(o).length?new ri(y(this,xe),y(this,Me),{...o}):this,this.inject=(o,s)=>{var i;const a=o.create(y(this,xe).sliceMap);return s!=null&&a.set(s),(i=y(this,ne))==null||i.onInject(o),this},this.remove=o=>{var s;return y(this,xe).remove(o),(s=y(this,ne))==null||s.onRemove(o),this},this.record=o=>{var s;return o.create(y(this,Me).store),(s=y(this,ne))==null||s.onRecord(o),this},this.clearTimer=o=>{var s;return y(this,Me).remove(o),(s=y(this,ne))==null||s.onClear(o),this},this.isInjected=o=>y(this,xe).has(o),this.isRecorded=o=>y(this,Me).has(o),this.use=o=>{var s;return(s=y(this,ne))==null||s.onUse(o),y(this,xe).get(o)},this.get=o=>this.use(o).get(),this.set=(o,s)=>this.use(o).set(s),this.update=(o,s)=>this.use(o).update(s),this.timer=o=>y(this,Me).get(o),this.done=o=>{var s;this.timer(o).done(),(s=y(this,ne))==null||s.onDone(o)},this.wait=o=>{var s;const i=this.timer(o).start();return(s=y(this,ne))==null||s.onWait(o,i),i},this.waitTimers=async o=>{await Promise.all(this.get(o).map(s=>this.wait(s)))},S(this,xe,e),S(this,Me,n),S(this,Mn,r),r&&S(this,ne,new nc(e,n,r))}get meta(){return y(this,Mn)}get inspector(){return y(this,ne)}};xe=new WeakMap,Me=new WeakMap,Mn=new WeakMap,ne=new WeakMap;let oc=rc,sc=class{constructor(){this.store=new Map,this.get=e=>{const n=this.store.get(e.id);if(!n)throw ql(e.name);return n},this.remove=e=>{this.store.delete(e.id)},this.has=e=>this.store.has(e.id)}};var Je,ze,St,Ne,At,Nn;let ic=class{constructor(e,n){_(this,Je),_(this,ze),_(this,St),_(this,Ne),_(this,At),_(this,Nn),S(this,Je,null),S(this,ze,null),S(this,Ne,"pending"),this.start=()=>(y(this,Je)??S(this,Je,new Promise((r,o)=>{S(this,ze,s=>{s instanceof CustomEvent&&s.detail.id===y(this,St)&&(S(this,Ne,"resolved"),y(this,At).call(this),s.stopImmediatePropagation(),r())}),y(this,Nn).call(this,()=>{y(this,Ne)==="pending"&&S(this,Ne,"rejected"),y(this,At).call(this),o(new Error(`Timing ${this.type.name} timeout.`))}),S(this,Ne,"pending"),addEventListener(this.type.name,y(this,ze))})),y(this,Je)),this.done=()=>{const r=new CustomEvent(this.type.name,{detail:{id:y(this,St)}});dispatchEvent(r)},S(this,At,()=>{y(this,ze)&&removeEventListener(this.type.name,y(this,ze))}),S(this,Nn,r=>{setTimeout(()=>{r()},this.type.timeout)}),S(this,St,Symbol(n.name)),this.type=n,e.set(n.id,this)}get status(){return y(this,Ne)}};Je=new WeakMap,ze=new WeakMap,St=new WeakMap,Ne=new WeakMap,At=new WeakMap,Nn=new WeakMap;let ac=class{constructor(e,n=3e3){this.create=r=>new ic(r,this),this.id=Symbol(`Timer-${e}`),this.name=e,this.timeout=n}};const Re=(t,e=3e3)=>new ac(t,e);function Tr(t){const e=this;e.parser=n;function n(r){return Ml(r,{...e.data("settings"),...t,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function Er(t){const e=this;e.compiler=n;function n(r){return Nl(r,{...e.data("settings"),...t,extensions:e.data("toMarkdownExtensions")||[]})}}function Cs(t){if(t)throw t}var ar,xs;function lc(){if(xs)return ar;xs=1;var t=Object.prototype.hasOwnProperty,e=Object.prototype.toString,n=Object.defineProperty,r=Object.getOwnPropertyDescriptor,o=function(c){return typeof Array.isArray=="function"?Array.isArray(c):e.call(c)==="[object Array]"},s=function(c){if(!c||e.call(c)!=="[object Object]")return!1;var d=t.call(c,"constructor"),u=c.constructor&&c.constructor.prototype&&t.call(c.constructor.prototype,"isPrototypeOf");if(c.constructor&&!d&&!u)return!1;var p;for(p in c);return typeof p>"u"||t.call(c,p)},i=function(c,d){n&&d.name==="__proto__"?n(c,d.name,{enumerable:!0,configurable:!0,value:d.newValue,writable:!0}):c[d.name]=d.newValue},a=function(c,d){if(d==="__proto__")if(t.call(c,d)){if(r)return r(c,d).value}else return;return c[d]};return ar=function l(){var c,d,u,p,f,h,g=arguments[0],b=1,k=arguments.length,v=!1;for(typeof g=="boolean"&&(v=g,g=arguments[1]||{},b=2),(g==null||typeof g!="object"&&typeof g!="function")&&(g={});b<k;++b)if(c=arguments[b],c!=null)for(d in c)u=a(g,d),p=a(c,d),g!==p&&(v&&p&&(s(p)||(f=o(p)))?(f?(f=!1,h=u&&o(u)?u:[]):h=u&&s(u)?u:{},i(g,{name:d,newValue:l(v,h,p)})):typeof p<"u"&&i(g,{name:d,newValue:p}));return g},ar}var cc=lc();const lr=Za(cc);function Rr(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function uc(){const t=[],e={run:n,use:r};return e;function n(...o){let s=-1;const i=o.pop();if(typeof i!="function")throw new TypeError("Expected function as last argument, not "+i);a(null,...o);function a(l,...c){const d=t[++s];let u=-1;if(l){i(l);return}for(;++u<o.length;)(c[u]===null||c[u]===void 0)&&(c[u]=o[u]);o=c,d?dc(d,a)(...c):i(null,...c)}}function r(o){if(typeof o!="function")throw new TypeError("Expected `middelware` to be a function, not "+o);return t.push(o),e}}function dc(t,e){let n;return r;function r(...i){const a=t.length>i.length;let l;a&&i.push(o);try{l=t.apply(this,i)}catch(c){const d=c;if(a&&n)throw d;return o(d)}a||(l&&l.then&&typeof l.then=="function"?l.then(s,o):l instanceof Error?o(l):s(l))}function o(i,...a){n||(n=!0,e(i,...a))}function s(i){o(null,i)}}const ue={basename:pc,dirname:hc,extname:fc,join:mc,sep:"/"};function pc(t,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');Qt(t);let n=0,r=-1,o=t.length,s;if(e===void 0||e.length===0||e.length>t.length){for(;o--;)if(t.codePointAt(o)===47){if(s){n=o+1;break}}else r<0&&(s=!0,r=o+1);return r<0?"":t.slice(n,r)}if(e===t)return"";let i=-1,a=e.length-1;for(;o--;)if(t.codePointAt(o)===47){if(s){n=o+1;break}}else i<0&&(s=!0,i=o+1),a>-1&&(t.codePointAt(o)===e.codePointAt(a--)?a<0&&(r=o):(a=-1,r=i));return n===r?r=i:r<0&&(r=t.length),t.slice(n,r)}function hc(t){if(Qt(t),t.length===0)return".";let e=-1,n=t.length,r;for(;--n;)if(t.codePointAt(n)===47){if(r){e=n;break}}else r||(r=!0);return e<0?t.codePointAt(0)===47?"/":".":e===1&&t.codePointAt(0)===47?"//":t.slice(0,e)}function fc(t){Qt(t);let e=t.length,n=-1,r=0,o=-1,s=0,i;for(;e--;){const a=t.codePointAt(e);if(a===47){if(i){r=e+1;break}continue}n<0&&(i=!0,n=e+1),a===46?o<0?o=e:s!==1&&(s=1):o>-1&&(s=-1)}return o<0||n<0||s===0||s===1&&o===n-1&&o===r+1?"":t.slice(o,n)}function mc(...t){let e=-1,n;for(;++e<t.length;)Qt(t[e]),t[e]&&(n=n===void 0?t[e]:n+"/"+t[e]);return n===void 0?".":gc(n)}function gc(t){Qt(t);const e=t.codePointAt(0)===47;let n=yc(t,!e);return n.length===0&&!e&&(n="."),n.length>0&&t.codePointAt(t.length-1)===47&&(n+="/"),e?"/"+n:n}function yc(t,e){let n="",r=0,o=-1,s=0,i=-1,a,l;for(;++i<=t.length;){if(i<t.length)a=t.codePointAt(i);else{if(a===47)break;a=47}if(a===47){if(!(o===i-1||s===1))if(o!==i-1&&s===2){if(n.length<2||r!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(l=n.lastIndexOf("/"),l!==n.length-1){l<0?(n="",r=0):(n=n.slice(0,l),r=n.length-1-n.lastIndexOf("/")),o=i,s=0;continue}}else if(n.length>0){n="",r=0,o=i,s=0;continue}}e&&(n=n.length>0?n+"/..":"..",r=2)}else n.length>0?n+="/"+t.slice(o+1,i):n=t.slice(o+1,i),r=i-o-1;o=i,s=0}else a===46&&s>-1?s++:s=-1}return n}function Qt(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const wc={cwd:kc};function kc(){return"/"}function _r(t){return!!(t!==null&&typeof t=="object"&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&t.auth===void 0)}function bc(t){if(typeof t=="string")t=new URL(t);else if(!_r(t)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(t.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return Cc(t)}function Cc(t){if(t.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const e=t.pathname;let n=-1;for(;++n<e.length;)if(e.codePointAt(n)===37&&e.codePointAt(n+1)===50){const r=e.codePointAt(n+2);if(r===70||r===102){const o=new TypeError("File URL path must not include encoded / characters");throw o.code="ERR_INVALID_FILE_URL_PATH",o}}return decodeURIComponent(e)}const cr=["history","path","basename","stem","extname","dirname"];class xc{constructor(e){let n;e?_r(e)?n={path:e}:typeof e=="string"||Mc(e)?n={value:e}:n=e:n={},this.cwd="cwd"in n?"":wc.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<cr.length;){const s=cr[r];s in n&&n[s]!==void 0&&n[s]!==null&&(this[s]=s==="history"?[...n[s]]:n[s])}let o;for(o in n)cr.includes(o)||(this[o]=n[o])}get basename(){return typeof this.path=="string"?ue.basename(this.path):void 0}set basename(e){dr(e,"basename"),ur(e,"basename"),this.path=ue.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?ue.dirname(this.path):void 0}set dirname(e){Ms(this.basename,"dirname"),this.path=ue.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?ue.extname(this.path):void 0}set extname(e){if(ur(e,"extname"),Ms(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=ue.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){_r(e)&&(e=bc(e)),dr(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?ue.basename(this.path,this.extname):void 0}set stem(e){dr(e,"stem"),ur(e,"stem"),this.path=ue.join(this.dirname||"",e+(this.extname||""))}fail(e,n,r){const o=this.message(e,n,r);throw o.fatal=!0,o}info(e,n,r){const o=this.message(e,n,r);return o.fatal=void 0,o}message(e,n,r){const o=new Sl(e,n,r);return this.path&&(o.name=this.path+":"+o.name,o.file=this.path),o.fatal=!1,this.messages.push(o),o}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function ur(t,e){if(t&&t.includes(ue.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+ue.sep+"`")}function dr(t,e){if(!t)throw new Error("`"+e+"` cannot be empty")}function Ms(t,e){if(!t)throw new Error("Setting `"+e+"` requires `path` to be set too")}function Mc(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const Nc=function(t){const r=this.constructor.prototype,o=r[t],s=function(){return o.apply(s,arguments)};return Object.setPrototypeOf(s,r),s},Sc={}.hasOwnProperty;class no extends Nc{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=uc()}copy(){const e=new no;let n=-1;for(;++n<this.attachers.length;){const r=this.attachers[n];e.use(...r)}return e.data(lr(!0,{},this.namespace)),e}data(e,n){return typeof e=="string"?arguments.length===2?(fr("data",this.frozen),this.namespace[e]=n,this):Sc.call(this.namespace,e)&&this.namespace[e]||void 0:e?(fr("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const o=n.call(e,...r);typeof o=="function"&&this.transformers.use(o)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const n=hn(e),r=this.parser||this.Parser;return pr("parse",r),r(String(n),n)}process(e,n){const r=this;return this.freeze(),pr("process",this.parser||this.Parser),hr("process",this.compiler||this.Compiler),n?o(void 0,n):new Promise(o);function o(s,i){const a=hn(e),l=r.parse(a);r.run(l,a,function(d,u,p){if(d||!u||!p)return c(d);const f=u,h=r.stringify(f,p);$c(h)?p.value=h:p.result=h,c(d,p)});function c(d,u){d||!u?i(d):s?s(u):n(void 0,u)}}}processSync(e){let n=!1,r;return this.freeze(),pr("processSync",this.parser||this.Parser),hr("processSync",this.compiler||this.Compiler),this.process(e,o),Ss("processSync","process",n),r;function o(s,i){n=!0,Cs(s),r=i}}run(e,n,r){Ns(e),this.freeze();const o=this.transformers;return!r&&typeof n=="function"&&(r=n,n=void 0),r?s(void 0,r):new Promise(s);function s(i,a){const l=hn(n);o.run(e,l,c);function c(d,u,p){const f=u||e;d?a(d):i?i(f):r(void 0,f,p)}}}runSync(e,n){let r=!1,o;return this.run(e,n,s),Ss("runSync","run",r),o;function s(i,a){Cs(i),o=a,r=!0}}stringify(e,n){this.freeze();const r=hn(n),o=this.compiler||this.Compiler;return hr("stringify",o),Ns(e),o(e,r)}use(e,...n){const r=this.attachers,o=this.namespace;if(fr("use",this.frozen),e!=null)if(typeof e=="function")l(e,n);else if(typeof e=="object")Array.isArray(e)?a(e):i(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function s(c){if(typeof c=="function")l(c,[]);else if(typeof c=="object")if(Array.isArray(c)){const[d,...u]=c;l(d,u)}else i(c);else throw new TypeError("Expected usable value, not `"+c+"`")}function i(c){if(!("plugins"in c)&&!("settings"in c))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");a(c.plugins),c.settings&&(o.settings=lr(!0,o.settings,c.settings))}function a(c){let d=-1;if(c!=null)if(Array.isArray(c))for(;++d<c.length;){const u=c[d];s(u)}else throw new TypeError("Expected a list of plugins, not `"+c+"`")}function l(c,d){let u=-1,p=-1;for(;++u<r.length;)if(r[u][0]===c){p=u;break}if(p===-1)r.push([c,...d]);else if(d.length>0){let[f,...h]=d;const g=r[p][1];Rr(g)&&Rr(f)&&(f=lr(!0,g,f)),r[p]=[c,f,...h]}}}}const Lr=new no().freeze();function pr(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `parser`")}function hr(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `compiler`")}function fr(t,e){if(e)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function Ns(t){if(!Rr(t)||typeof t.type!="string")throw new TypeError("Expected node, got `"+t+"`")}function Ss(t,e,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+e+"` instead")}function hn(t){return Ac(t)?t:new xc(t)}function Ac(t){return!!(t&&typeof t=="object"&&"message"in t&&"messages"in t)}function $c(t){return typeof t=="string"||vc(t)}function vc(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}var oi=t=>{throw TypeError(t)},si=(t,e,n)=>e.has(t)||oi("Cannot "+n),M=(t,e,n)=>(si(t,e,"read from private field"),n?n.call(t):e.get(t)),L=(t,e,n)=>e.has(t)?oi("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),T=(t,e,n,r)=>(si(t,e,"write to private field"),e.set(t,n),n);let ii=class{},ai=class{constructor(){this.elements=[],this.size=()=>this.elements.length,this.top=()=>this.elements.at(-1),this.push=e=>{var n;(n=this.top())==null||n.push(e)},this.open=e=>{this.elements.push(e)},this.close=()=>{const e=this.elements.pop();if(!e)throw Zs();return e}}},Ic=class li extends ii{constructor(e,n,r){super(),this.type=e,this.content=n,this.attrs=r}push(e,...n){this.content.push(e,...n)}pop(){return this.content.pop()}static create(e,n,r){return new li(e,n,r)}};var ce,$t,Sn,An,$n,vt,It;const Dr=class extends ai{constructor(e){super(),L(this,ce),L(this,$t),L(this,Sn),L(this,An),L(this,$n),L(this,vt),L(this,It),T(this,ce,kn.none),T(this,$t,n=>n.isText),T(this,Sn,(n,r)=>{if(M(this,$t).call(this,n)&&M(this,$t).call(this,r)&&kn.sameSet(n.marks,r.marks))return this.schema.text(n.text+r.text,n.marks)}),T(this,An,n=>{const r=Object.values({...this.schema.nodes,...this.schema.marks}).find(o=>o.spec.parseMarkdown.match(n));if(!r)throw Gl(n);return r}),T(this,$n,n=>{const r=M(this,An).call(this,n);r.spec.parseMarkdown.runner(this,n,r)}),this.injectRoot=(n,r,o)=>(this.openNode(r,o),this.next(n.children),this),this.openNode=(n,r)=>(this.open(Ic.create(n,[],r)),this),T(this,vt,()=>{T(this,ce,kn.none);const n=this.close();return M(this,It).call(this,n.type,n.attrs,n.content)}),this.closeNode=()=>(M(this,vt).call(this),this),T(this,It,(n,r,o)=>{const s=n.createAndFill(r,o,M(this,ce));if(!s)throw Ul(n,r,o);return this.push(s),s}),this.addNode=(n,r,o)=>(M(this,It).call(this,n,r,o),this),this.openMark=(n,r)=>{const o=n.create(r);return T(this,ce,o.addToSet(M(this,ce))),this},this.closeMark=n=>(T(this,ce,n.removeFromSet(M(this,ce))),this),this.addText=n=>{const r=this.top();if(!r)throw Zs();const o=r.pop(),s=this.schema.text(n,M(this,ce));if(!o)return r.push(s),this;const i=M(this,Sn).call(this,o,s);return i?(r.push(i),this):(r.push(o,s),this)},this.build=()=>{let n;do n=M(this,vt).call(this);while(this.size());return n},this.next=(n=[])=>([n].flat().forEach(r=>M(this,$n).call(this,r)),this),this.toDoc=()=>this.build(),this.run=(n,r)=>{const o=n.runSync(n.parse(r),r);return this.next(o),this},this.schema=e}};ce=new WeakMap,$t=new WeakMap,Sn=new WeakMap,An=new WeakMap,$n=new WeakMap,vt=new WeakMap,It=new WeakMap,Dr.create=(t,e)=>{const n=new Dr(t);return r=>(n.run(e,r),n.toDoc())};let Tc=Dr;const Or=class extends ii{constructor(e,n,r,o={}){super(),this.type=e,this.children=n,this.value=r,this.props=o,this.push=(s,...i)=>{this.children||(this.children=[]),this.children.push(s,...i)},this.pop=()=>{var s;return(s=this.children)==null?void 0:s.pop()}}};Or.create=(t,e,n,r={})=>new Or(t,e,n,r);let As=Or;const Ec=t=>Object.prototype.hasOwnProperty.call(t,"size");var ye,Tt,vn,In,Et,Tn,Rt,En,Rn,Xe,We,_n,_t;const Pr=class extends ai{constructor(e){super(),L(this,ye),L(this,Tt),L(this,vn),L(this,In),L(this,Et),L(this,Tn),L(this,Rt),L(this,En),L(this,Rn),L(this,Xe),L(this,We),L(this,_n),L(this,_t),T(this,ye,kn.none),T(this,Tt,n=>{const r=Object.values({...this.schema.nodes,...this.schema.marks}).find(o=>o.spec.toMarkdown.match(n));if(!r)throw Jl(n.type);return r}),T(this,vn,n=>M(this,Tt).call(this,n).spec.toMarkdown.runner(this,n)),T(this,In,(n,r)=>M(this,Tt).call(this,n).spec.toMarkdown.runner(this,n,r)),T(this,Et,n=>{const{marks:r}=n,o=s=>s.type.spec.priority??50;[...r].sort((s,i)=>o(s)-o(i)).every(s=>!M(this,In).call(this,s,n))&&M(this,vn).call(this,n),r.forEach(s=>M(this,_t).call(this,s))}),T(this,Tn,(n,r)=>{var o;if(n.type===r||((o=n.children)==null?void 0:o.length)!==1)return n;const s=c=>{var d;if(c.type===r)return c;if(((d=c.children)==null?void 0:d.length)!==1)return null;const[u]=c.children;return u?s(u):null},i=s(n);if(!i)return n;const a=i.children?[...i.children]:void 0,l={...n,children:a};return l.children=a,i.children=[l],i}),T(this,Rt,n=>{const{children:r}=n;return r&&(n.children=r.reduce((o,s,i)=>{if(i===0)return[s];const a=o.at(-1);if(a&&a.isMark&&s.isMark){s=M(this,Tn).call(this,s,a.type);const{children:l,...c}=s,{children:d,...u}=a;if(s.type===a.type&&l&&d&&JSON.stringify(c)===JSON.stringify(u)){const p={...u,children:[...d,...l]};return o.slice(0,-1).concat(M(this,Rt).call(this,p))}}return o.concat(s)},[])),n}),T(this,En,n=>{const r={...n.props,type:n.type};return n.children&&(r.children=n.children),n.value&&(r.value=n.value),r}),this.openNode=(n,r,o)=>(this.open(As.create(n,void 0,r,o)),this),T(this,Rn,(n,r)=>{let o="",s="";const i=n.children;let a=-1,l=-1;const c=u=>{u&&u.forEach((p,f)=>{p.type==="text"&&p.value&&(a<0&&(a=f),l=f)})};if(i){c(i);const u=i==null?void 0:i[l],p=i==null?void 0:i[a];u&&u.value.endsWith(" ")&&(s=u.value.match(/ +$/)[0],u.value=u.value.trimEnd()),p&&p.value.startsWith(" ")&&(o=p.value.match(/^ +/)[0],p.value=p.value.trimStart())}o.length&&M(this,We).call(this,"text",void 0,o);const d=r();return s.length&&M(this,We).call(this,"text",void 0,s),d}),T(this,Xe,(n=!1)=>{const r=this.close(),o=()=>M(this,We).call(this,r.type,r.children,r.value,r.props);return n?M(this,Rn).call(this,r,o):o()}),this.closeNode=()=>(M(this,Xe).call(this),this),T(this,We,(n,r,o,s)=>{const i=As.create(n,r,o,s),a=M(this,Rt).call(this,M(this,En).call(this,i));return this.push(a),a}),this.addNode=(n,r,o,s)=>(M(this,We).call(this,n,r,o,s),this),T(this,_n,(n,r,o,s)=>n.isInSet(M(this,ye))?this:(T(this,ye,n.addToSet(M(this,ye))),this.openNode(r,o,{...s,isMark:!0}))),T(this,_t,n=>{n.isInSet(M(this,ye))&&(T(this,ye,n.type.removeFromSet(M(this,ye))),M(this,Xe).call(this,!0))}),this.withMark=(n,r,o,s)=>(M(this,_n).call(this,n,r,o,s),this),this.closeMark=n=>(M(this,_t).call(this,n),this),this.build=()=>{let n=null;do n=M(this,Xe).call(this);while(this.size());return n},this.next=n=>Ec(n)?(n.forEach(r=>{M(this,Et).call(this,r)}),this):(M(this,Et).call(this,n),this),this.toString=n=>n.stringify(this.build()),this.run=n=>(this.next(n),this),this.schema=e}};ye=new WeakMap,Tt=new WeakMap,vn=new WeakMap,In=new WeakMap,Et=new WeakMap,Tn=new WeakMap,Rt=new WeakMap,En=new WeakMap,Rn=new WeakMap,Xe=new WeakMap,We=new WeakMap,_n=new WeakMap,_t=new WeakMap,Pr.create=(t,e)=>{const n=new Pr(t);return r=>(n.run(r),n.toString(e))};let Rc=Pr;class H{constructor(e,n,r={}){this.match=e,this.match=e,this.handler=typeof n=="string"?_c(n):n,this.undoable=r.undoable!==!1,this.inCode=r.inCode||!1}}function _c(t){return function(e,n,r,o){let s=t;if(n[1]){let i=n[0].lastIndexOf(n[1]);s+=n[0].slice(i+n[1].length),r+=i;let a=r-o;a>0&&(s=n[0].slice(i-a,i)+s,r=o)}return e.tr.insertText(s,r,o)}}const Lc=(t,e)=>{let n=t.plugins;for(let r=0;r<n.length;r++){let o=n[r],s;if(o.spec.isInputRules&&(s=o.getState(t))){if(e){let i=t.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l--)i.step(a.steps[l].invert(a.docs[l]));if(s.text){let l=i.doc.resolve(s.from).marks();i.replaceWith(s.from,s.to,t.schema.text(s.text,l))}else i.delete(s.from,s.to);e(i)}return!0}}return!1};new H(/--$/,"—");new H(/\.\.\.$/,"…");new H(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"“");new H(/"$/,"”");new H(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"‘");new H(/'$/,"’");function ro(t,e,n=null,r){return new H(t,(o,s,i,a)=>{let l=n instanceof Function?n(s):n,c=o.tr.delete(i,a),d=c.doc.resolve(i),u=d.blockRange(),p=u&&el(u,e,l);if(!p)return null;c.wrap(u,p);let f=c.doc.resolve(i-1).nodeBefore;return f&&f.type==e&&tl(c.doc,i-1)&&(!r||r(s,f))&&c.join(i-1),c})}function ci(t,e,n=null){return new H(t,(r,o,s,i)=>{let a=r.doc.resolve(s),l=n instanceof Function?n(o):n;return a.node(-1).canReplaceWith(a.index(-1),a.indexAfter(-1),e)?r.tr.delete(s,i).setBlockType(s,s,e,l):null})}const Ee=typeof navigator<"u"?navigator:null,$s=typeof document<"u"?document:null,_e=Ee&&Ee.userAgent||"",Fr=/Edge\/(\d+)/.exec(_e),ui=/MSIE \d/.exec(_e),zr=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(_e),Qn=!!(ui||zr||Fr),Dc=ui?document.documentMode:zr?+zr[1]:Fr?+Fr[1]:0,di=!Qn&&/gecko\/(\d+)/i.test(_e),Oc=di&&+(/Firefox\/(\d+)/.exec(_e)||[0,0])[1],Wr=!Qn&&/Chrome\/(\d+)/.exec(_e),Pc=!!Wr,Fc=Wr?+Wr[1]:0,pi=!Qn&&!!Ee&&/Apple Computer/.test(Ee.vendor),hi=pi&&(/Mobile\/\w+/.test(_e)||!!Ee&&Ee.maxTouchPoints>2),zc=hi||(Ee?/Mac/.test(Ee.platform):!1),Wc=/Android \d/.test(_e),fi=!!$s&&"webkitFontSmoothing"in $s.documentElement.style,jc=fi?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;var Th=Object.freeze({__proto__:null,android:Wc,chrome:Pc,chrome_version:Fc,gecko:di,gecko_version:Oc,ie:Qn,ie_version:Dc,ios:hi,mac:zc,safari:pi,webkit:fi,webkit_version:jc});function mr(t,e,n,r,o,s){var i;if(t.composing)return!1;const a=t.state,l=a.doc.resolve(e);if(l.parent.type.spec.code)return!1;const c=l.parent.textBetween(Math.max(0,l.parentOffset-500),l.parentOffset,void 0,"￼")+r;for(let d=0;d<o.length;d++){const u=o[d].match.exec(c),p=u&&u[0]&&o[d].handler(a,u,e-(u[0].length-r.length),n);if(p)return((i=o[d])==null?void 0:i.undoable)!==!1&&p.setMeta(s,{transform:p,from:e,to:n,text:r}),t.dispatch(p),!0}return!1}const Hc=new F("MILKDOWN_CUSTOM_INPUTRULES");function Bc({rules:t}){const e=new z({key:Hc,isInputRules:!0,state:{init(){return null},apply(n,r){const o=n.getMeta(this);return o||(n.selectionSet||n.docChanged?null:r)}},props:{handleTextInput(n,r,o,s){return mr(n,r,o,s,t,e)},handleDOMEvents:{compositionend:n=>(setTimeout(()=>{const{$cursor:r}=n.state.selection;r&&mr(n,r.pos,r.pos,"",t,e)}),!1)},handleKeyDown(n,r){if(r.key!=="Enter")return!1;const{$cursor:o}=n.state.selection;return o?mr(n,o.pos,o.pos,`
`,t,e):!1}}});return e}function Zt(t,e,n={}){return new H(t,(r,o,s,i)=>{var a,l,c,d;const{tr:u}=r,p=o.length;let f=o[p-1],h=o[0],g=[],b=i;const k={group:f,fullMatch:h,start:s,end:i},v=(a=n.updateCaptured)==null?void 0:a.call(n,k);if(Object.assign(k,v),{group:f,fullMatch:h,start:s,end:i}=k,h===null||(f==null?void 0:f.trim())==="")return null;if(f){const I=h.search(/\S/),W=s+h.indexOf(f),X=W+f.length;g=(l=u.storedMarks)!=null?l:[],X<i&&u.delete(X,i),W>s&&u.delete(s+I,W),b=s+I+f.length;const P=(c=n.getAttr)==null?void 0:c.call(n,o);u.addMark(s,b,e.create(P)),u.setStoredMarks(g),(d=n.beforeDispatch)==null||d.call(n,{match:o,start:s,end:i,tr:u})}return u})}function Eh(t,e,n={}){return new H(t,(r,o,s,i)=>{var a,l,c;const{tr:d}=r;let u=o[1],p=o[0];const f={group:u,fullMatch:p,start:s,end:i},h=(a=n.updateCaptured)==null?void 0:a.call(n,f);if(Object.assign(f,h),{group:u,fullMatch:p,start:s,end:i}=f,p===null||!u||u.trim()==="")return null;const g=(l=n.getAttr)==null?void 0:l.call(n,o),b=e.createAndFill(g);return b&&(d.replaceRangeWith(e.isBlock?d.doc.resolve(s).before():s,i,b),(c=n.beforeDispatch)==null||c.call(n,{match:[p,u??""],start:s,end:i,tr:d})),d})}var Kc=Object.defineProperty,Vc=Object.defineProperties,qc=Object.getOwnPropertyDescriptors,vs=Object.getOwnPropertySymbols,Uc=Object.prototype.hasOwnProperty,Gc=Object.prototype.propertyIsEnumerable,Is=(t,e,n)=>e in t?Kc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Jc=(t,e)=>{for(var n in e||(e={}))Uc.call(e,n)&&Is(t,n,e[n]);if(vs)for(var n of vs(e))Gc.call(e,n)&&Is(t,n,e[n]);return t},Xc=(t,e)=>Vc(t,qc(e));function Ts(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function Rh(t,e,n){const o=t.state.doc.content.size,s=Ts(e,0,o),i=Ts(n,0,o),a=t.coordsAtPos(s),l=t.coordsAtPos(i,-1),c=Math.min(a.top,l.top),d=Math.max(a.bottom,l.bottom),u=Math.min(a.left,l.left),p=Math.max(a.right,l.right),f=p-u,h=d-c,k={top:c,bottom:d,left:u,right:p,width:f,height:h,x:u,y:c};return Xc(Jc({},k),{toJSON:()=>k})}function Zn(t){return Object.assign(Object.create(t),t).setTime(Date.now())}function Yc(t,e){return Array.isArray(t)&&t.includes(e.type)||e.type===t}function Qc(t){return e=>{for(let n=e.depth;n>0;n-=1){const r=e.node(n);if(t(r)){const o=e.before(n),s=e.after(n);return{from:o,to:s,node:r}}}}}function Zc(t,e){return Qc(n=>n.type===e)(t)}function eu(t,e){const n=e.nodes[t];if(!n)throw Xl("node",t);return n}function oo(t){return e=>{for(let n=e.depth;n>0;n--){const r=e.node(n);if(t(r))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:r}}}}function _h(t){return e=>oo(t)(e.$from)}function tu(t,e){if(!(t instanceof Gs))return;const{node:n,$from:r}=t;if(Yc(e,n))return{node:n,pos:r.pos,start:r.start(r.depth),depth:r.depth}}var mi=t=>{throw TypeError(t)},gi=(t,e,n)=>e.has(t)||mi("Cannot "+n),w=(t,e,n)=>(gi(t,e,"read from private field"),n?n.call(t):e.get(t)),O=(t,e,n)=>e.has(t)?mi("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),R=(t,e,n,r)=>(gi(t,e,"write to private field"),e.set(t,n),n);function Le(t,e){return t.meta={package:"@milkdown/core",group:"System",...e},t}const yi={strong:(t,e,n,r)=>{const o=t.marker||n.options.strong||"*",s=n.enter("strong"),i=n.createTracker(r);let a=i.move(o+o);return a+=i.move(n.containerPhrasing(t,{before:a,after:o,...i.current()})),a+=i.move(o+o),s(),a},emphasis:(t,e,n,r)=>{const o=t.marker||n.options.emphasis||"*",s=n.enter("emphasis"),i=n.createTracker(r);let a=i.move(o);return a+=i.move(n.containerPhrasing(t,{before:a,after:o,...i.current()})),a+=i.move(o),s(),a}},rt=N({},"editorView"),Lt=N({},"editorState"),gr=N([],"initTimer"),Es=N({},"editor"),qt=N([],"inputRules"),he=N([],"prosePlugins"),Ut=N([],"remarkPlugins"),Gt=N([],"nodeView"),Jt=N([],"markView"),Be=N(Lr().use(Tr).use(Er),"remark"),zt=N({handlers:yi},"remarkStringifyOptions"),Ln=Re("ConfigReady");function nu(t){const e=n=>(n.record(Ln),async()=>(await t(n),n.done(Ln),()=>{n.clearTimer(Ln)}));return Le(e,{displayName:"Config"}),e}const Ke=Re("InitReady");function ru(t){const e=n=>(n.inject(Es,t).inject(he,[]).inject(Ut,[]).inject(qt,[]).inject(Gt,[]).inject(Jt,[]).inject(zt,{handlers:yi}).inject(Be,Lr().use(Tr).use(Er)).inject(gr,[Ln]).record(Ke),async()=>{await n.waitTimers(gr);const r=n.get(zt);return n.set(Be,Lr().use(Tr).use(Er,r)),n.done(Ke),()=>{n.remove(Es).remove(he).remove(Ut).remove(qt).remove(Gt).remove(Jt).remove(zt).remove(Be).remove(gr).clearTimer(Ke)}});return Le(e,{displayName:"Init"}),e}const oe=Re("SchemaReady"),yr=N([],"schemaTimer"),ke=N({},"schema"),ot=N([],"nodes"),st=N([],"marks");function Rs(t){var e;return{...t,parseDOM:(e=t.parseDOM)==null?void 0:e.map(n=>({priority:t.priority,...n}))}}const wi=t=>(t.inject(ke,{}).inject(ot,[]).inject(st,[]).inject(yr,[Ke]).record(oe),async()=>{await t.waitTimers(yr);const e=t.get(Be),n=t.get(Ut).reduce((i,a)=>i.use(a.plugin,a.options),e);t.set(Be,n);const r=Object.fromEntries(t.get(ot).map(([i,a])=>[i,Rs(a)])),o=Object.fromEntries(t.get(st).map(([i,a])=>[i,Rs(a)])),s=new nl({nodes:r,marks:o});return t.set(ke,s),t.done(oe),()=>{t.remove(ke).remove(ot).remove(st).remove(yr).clearTimer(oe)}});Le(wi,{displayName:"Schema"});var Ye,je;let ki=class{constructor(){O(this,Ye),O(this,je),R(this,Ye,new ni),R(this,je,null),this.setCtx=e=>{R(this,je,e)}}get ctx(){return w(this,je)}create(e,n){const r=e.create(w(this,Ye).sliceMap);return r.set(n),r}get(e){return w(this,Ye).get(e).get()}remove(e){return w(this,Ye).remove(e)}call(e,n){if(w(this,je)==null)throw Yl();const r=this.get(e)(n),o=w(this,je).get(rt);return r(o.state,o.dispatch,o)}};Ye=new WeakMap,je=new WeakMap;function ou(t="cmdKey"){return N(()=>()=>!1,t)}const A=N(new ki,"commands"),wr=N([oe],"commandsTimer"),Wt=Re("CommandsReady"),bi=t=>{const e=new ki;return e.setCtx(t),t.inject(A,e).inject(wr,[oe]).record(Wt),async()=>(await t.waitTimers(wr),t.done(Wt),()=>{t.remove(A).remove(wr).clearTimer(Wt)})};Le(bi,{displayName:"Commands"});const Dn=Re("ParserReady"),Ci=()=>{throw to()},jt=N(Ci,"parser"),kr=N([],"parserTimer"),xi=t=>(t.inject(jt,Ci).inject(kr,[oe]).record(Dn),async()=>{await t.waitTimers(kr);const e=t.get(Be),n=t.get(ke);return t.set(jt,Tc.create(n,e)),t.done(Dn),()=>{t.remove(jt).remove(kr).clearTimer(Dn)}});Le(xi,{displayName:"Parser"});const Ht=Re("SerializerReady"),br=N([],"serializerTimer"),Mi=()=>{throw to()},it=N(Mi,"serializer"),Ni=t=>(t.inject(it,Mi).inject(br,[oe]).record(Ht),async()=>{await t.waitTimers(br);const e=t.get(Be),n=t.get(ke);return t.set(it,Rc.create(n,e)),t.done(Ht),()=>{t.remove(it).remove(br).clearTimer(Ht)}});Le(Ni,{displayName:"Serializer"});const On=N("","defaultValue"),Cr=N(t=>t,"stateOptions"),xr=N([],"editorStateTimer"),Pn=Re("EditorStateReady");function su(t,e,n){if(typeof t=="string")return e(t);if(t.type==="html")return Xs.fromSchema(n).parse(t.dom);if(t.type==="json")return sl.fromJSON(n,t.value);throw Kl(t)}const iu=new F("MILKDOWN_STATE_TRACKER");function au(t){const e=il(Lc,ul,cl,ll);return t.Backspace=e,t}const Si=t=>(t.inject(On,"").inject(Lt,{}).inject(Cr,e=>e).inject(xr,[Dn,Ht,Wt]).record(Pn),async()=>{await t.waitTimers(xr);const e=t.get(ke),n=t.get(jt),r=t.get(qt),o=t.get(Cr),s=t.get(he),i=t.get(On),a=su(i,n,e),l=[...s,new z({key:iu,state:{init:()=>{},apply:(u,p,f,h)=>{t.set(Lt,h)}}}),Bc({rules:r}),Js(au(al))];t.set(he,l);const c=o({schema:e,doc:a,plugins:l}),d=rl.create(c);return t.set(Lt,d),t.done(Pn),()=>{t.remove(On).remove(Lt).remove(Cr).remove(xr).clearTimer(Pn)}});Le(Si,{displayName:"EditorState"});const Fn=Re("EditorViewReady"),Mr=N([],"editorViewTimer"),Bt=N({},"editorViewOptions"),zn=N(null,"root"),jr=N(null,"rootDOM"),Hr=N({},"rootAttrs");function lu(t,e){const n=document.createElement("div");n.className="milkdown",t.appendChild(n),e.set(jr,n);const r=e.get(Hr);return Object.entries(r).forEach(([o,s])=>n.setAttribute(o,s)),n}function cu(t){t.classList.add("editor"),t.setAttribute("role","textbox")}const uu=new F("MILKDOWN_VIEW_CLEAR"),Ai=t=>(t.inject(zn,document.body).inject(rt,{}).inject(Bt,{}).inject(jr,null).inject(Hr,{}).inject(Mr,[Pn]).record(Fn),async()=>{await t.wait(Ke);const e=t.get(zn)||document.body,n=typeof e=="string"?document.querySelector(e):e;t.update(he,l=>[new z({key:uu,view:c=>{const d=n?lu(n,t):void 0;return(()=>{if(d&&n){const u=c.dom;n.replaceChild(d,u),d.appendChild(u)}})(),{destroy:()=>{d!=null&&d.parentNode&&(d==null||d.parentNode.replaceChild(c.dom,d)),d==null||d.remove()}}}}),...l]),await t.waitTimers(Mr);const r=t.get(Lt),o=t.get(Bt),s=Object.fromEntries(t.get(Gt)),i=Object.fromEntries(t.get(Jt)),a=new ol(n,{state:r,nodeViews:s,markViews:i,...o});return cu(a.dom),t.set(rt,a),t.done(Fn),()=>{a==null||a.destroy(),t.remove(zn).remove(rt).remove(Bt).remove(jr).remove(Hr).remove(Mr).clearTimer(Fn)}});Le(Ai,{displayName:"EditorView"});var $i=(t=>(t.Idle="Idle",t.OnCreate="OnCreate",t.Created="Created",t.OnDestroy="OnDestroy",t.Destroyed="Destroyed",t))($i||{}),Qe,Q,Se,Dt,Wn,jn,V,Ae,Ze,Hn,et,Ot,Bn,He,Pt;const du=class vi{constructor(){O(this,Qe),O(this,Q),O(this,Se),O(this,Dt),O(this,Wn),O(this,jn),O(this,V),O(this,Ae),O(this,Ze),O(this,Hn),O(this,et),O(this,Ot),O(this,Bn),O(this,He),O(this,Pt),R(this,Qe,!1),R(this,Q,"Idle"),R(this,Se,[]),R(this,Dt,()=>{}),R(this,Wn,new ni),R(this,jn,new sc),R(this,V,new Map),R(this,Ae,new Map),R(this,Ze,new oc(w(this,Wn),w(this,jn))),R(this,Hn,()=>{const e=nu(async r=>{await Promise.all(w(this,Se).map(o=>o(r)))}),n=[wi,xi,Ni,bi,Si,Ai,ru(this),e];w(this,et).call(this,n,w(this,Ae))}),R(this,et,(e,n)=>{e.forEach(r=>{const o=w(this,Ze).produce(w(this,Qe)?r.meta:void 0),s=r(o);n.set(r,{ctx:o,handler:s,cleanup:void 0})})}),R(this,Ot,(e,n=!1)=>Promise.all([e].flat().map(r=>{const o=w(this,V).get(r),s=o==null?void 0:o.cleanup;return n?w(this,V).delete(r):w(this,V).set(r,{ctx:void 0,handler:void 0,cleanup:void 0}),typeof s=="function"?s():s}))),R(this,Bn,async()=>{await Promise.all([...w(this,Ae).entries()].map(([e,{cleanup:n}])=>typeof n=="function"?n():n)),w(this,Ae).clear()}),R(this,He,e=>{R(this,Q,e),w(this,Dt).call(this,e)}),R(this,Pt,e=>[...e.entries()].map(async([n,r])=>{const{ctx:o,handler:s}=r;if(!s)return;const i=await s();e.set(n,{ctx:o,handler:s,cleanup:i})})),this.enableInspector=(e=!0)=>(R(this,Qe,e),this),this.onStatusChange=e=>(R(this,Dt,e),this),this.config=e=>(w(this,Se).push(e),this),this.removeConfig=e=>(R(this,Se,w(this,Se).filter(n=>n!==e)),this),this.use=e=>{const n=[e].flat();return n.flat().forEach(r=>{w(this,V).set(r,{ctx:void 0,handler:void 0,cleanup:void 0})}),w(this,Q)==="Created"&&w(this,et).call(this,n,w(this,V)),this},this.remove=async e=>w(this,Q)==="OnCreate"?(console.warn("[Milkdown]: You are trying to remove plugins when the editor is creating, this is not recommended, please check your code."),new Promise(n=>{setTimeout(()=>{n(this.remove(e))},50)})):(await w(this,Ot).call(this,[e].flat(),!0),this),this.create=async()=>w(this,Q)==="OnCreate"?this:(w(this,Q)==="Created"&&await this.destroy(),w(this,He).call(this,"OnCreate"),w(this,Hn).call(this),w(this,et).call(this,[...w(this,V).keys()],w(this,V)),await Promise.all([w(this,Pt).call(this,w(this,Ae)),w(this,Pt).call(this,w(this,V))].flat()),w(this,He).call(this,"Created"),this),this.destroy=async(e=!1)=>w(this,Q)==="Destroyed"||w(this,Q)==="OnDestroy"?this:w(this,Q)==="OnCreate"?new Promise(n=>{setTimeout(()=>{n(this.destroy(e))},50)}):(e&&R(this,Se,[]),w(this,He).call(this,"OnDestroy"),await w(this,Ot).call(this,[...w(this,V).keys()],e),await w(this,Bn).call(this),w(this,He).call(this,"Destroyed"),this),this.action=e=>e(w(this,Ze)),this.inspect=()=>w(this,Qe)?[...w(this,Ae).values(),...w(this,V).values()].map(({ctx:e})=>{var n;return(n=e==null?void 0:e.inspector)==null?void 0:n.read()}).filter(e=>!!e):(console.warn("[Milkdown]: You are trying to collect inspection when inspector is disabled, please enable inspector by `editor.enableInspector()` first."),[])}static make(){return new vi}get ctx(){return w(this,Ze)}get status(){return w(this,Q)}};Qe=new WeakMap,Q=new WeakMap,Se=new WeakMap,Dt=new WeakMap,Wn=new WeakMap,jn=new WeakMap,V=new WeakMap,Ae=new WeakMap,Ze=new WeakMap,Hn=new WeakMap,et=new WeakMap,Ot=new WeakMap,Bn=new WeakMap,He=new WeakMap,Pt=new WeakMap;let pu=du;Wl("abcedfghicklmn",10);function x(t,e){const n=ou(t),r=o=>async()=>{r.key=n,await o.wait(Wt);const s=e(o);return o.get(A).create(n,s),r.run=i=>o.get(A).call(t,i),()=>{o.get(A).remove(n)}};return r}function B(t){const e=n=>async()=>{await n.wait(oe);const r=t(n);return n.update(qt,o=>[...o,r]),e.inputRule=r,()=>{n.update(qt,o=>o.filter(s=>s!==r))}};return e}function hu(t,e){const n=r=>async()=>{const o=e(r);return r.update(st,s=>[...s.filter(i=>i[0]!==t),[t,o]]),n.id=t,n.schema=o,()=>{r.update(st,s=>s.filter(([i])=>i!==t))}};return n.type=r=>{const o=r.get(ke).marks[t];if(!o)throw Zl(t);return o},n}function so(t,e){const n=r=>async()=>{const o=e(r);return r.update(ot,s=>[...s.filter(i=>i[0]!==t),[t,o]]),n.id=t,n.schema=o,()=>{r.update(ot,s=>s.filter(([i])=>i!==t))}};return n.type=r=>{const o=r.get(ke).nodes[t];if(!o)throw Ql(t);return o},n}function ee(t){let e;const n=r=>async()=>(await r.wait(oe),e=t(r),r.update(he,o=>[...o,e]),()=>{r.update(he,o=>o.filter(s=>s!==e))});return n.plugin=()=>e,n.key=()=>e.spec.key,n}function Ii(t){const e=n=>async()=>{await n.wait(oe);const r=t(n),o=Js(r);return n.update(he,s=>[...s,o]),e.keymap=r,()=>{n.update(he,s=>s.filter(i=>i!==o))}};return e}function Dh(t,e){const n=r=>async()=>{await r.wait(oe);const o=e(r);return t.type(r)instanceof ws?r.update(Gt,s=>[...s,[t.id,o]]):r.update(Jt,s=>[...s,[t.id,o]]),n.view=o,n.type=t,()=>{t.type(r)instanceof ws?r.update(Gt,s=>s.filter(i=>i[0]!==t.id)):r.update(Jt,s=>s.filter(i=>i[0]!==t.id))}};return n}function se(t,e){const n=N(t,e),r=o=>(o.inject(n),()=>()=>{o.remove(n)});return r.key=n,r}function D(t,e){const n=se(e,t),r=so(t,s=>s.get(n.key)(s)),o=[n,r];return o.id=r.id,o.node=r,o.type=s=>r.type(s),o.schema=r.schema,o.ctx=n,o.key=n.key,o.extendSchema=s=>i=>()=>{const a=i.get(n.key),l=s(a)(i);i.update(ot,c=>[...c.filter(d=>d[0]!==t),[t,l]]),o.schema=l},o}function en(t,e){const n=se(e,t),r=hu(t,s=>s.get(n.key)(s)),o=[n,r];return o.id=r.id,o.mark=r,o.type=r.type,o.schema=r.schema,o.ctx=n,o.key=n.key,o.extendSchema=s=>i=>()=>{const a=i.get(n.key),l=s(a)(i);i.update(st,c=>[...c.filter(d=>d[0]!==t),[t,l]]),o.schema=l},o}function K(t,e){const n=Object.fromEntries(Object.entries(e).map(([i,{shortcuts:a}])=>[i,a])),r=se(n,`${t}Keymap`),o=Ii(i=>{const a=i.get(r.key),l=Object.entries(e).flatMap(([c,{command:d}])=>[a[c]].flat().map(u=>[u,d(i)]));return Object.fromEntries(l)}),s=[r,o];return s.ctx=r,s.shortcuts=o,s.key=r.key,s.keymap=o.keymap,s}const ie=(t,e=()=>({}))=>se(e,`${t}Attr`),tn=(t,e=()=>({}))=>se(e,`${t}Attr`);function pt(t,e,n){const r=se({},t),o=i=>async()=>{await i.wait(Ke);const a={plugin:e(i),options:i.get(r.key)};return i.update(Ut,l=>[...l,a]),()=>{i.update(Ut,l=>l.filter(c=>c!==a))}},s=[r,o];return s.id=t,s.plugin=o,s.options=r,s}function fu(){return t=>{const e=t.get(rt);return t.get(it)(e.state.doc)}}function mu(t){const e=new Map;if(!t||!t.type)throw new Error("mdast-util-definitions expected node");return Xt(t,"definition",function(r){const o=_s(r.identifier);o&&!e.get(o)&&e.set(o,r)}),n;function n(r){const o=_s(r);return e.get(o)}}function _s(t){return String(t||"").toUpperCase()}function gu(){return function(t){const e=mu(t);Xt(t,function(n,r,o){if(n.type==="definition"&&o!==void 0&&typeof r=="number")return o.children.splice(r,1),[ks,r];if(n.type==="imageReference"||n.type==="linkReference"){const s=e(n.identifier);if(s&&o&&typeof r=="number")return o.children[r]=n.type==="imageReference"?{type:"image",url:s.url,title:s.title,alt:n.alt}:{type:"link",url:s.url,title:s.title,children:n.children},[ks,r]}})}}function Ti(t,e){var n;if(!(e.childCount>=1&&((n=e.lastChild)==null?void 0:n.type.name)==="hardbreak")){t.next(e.content);return}const r=[];e.content.forEach((o,s,i)=>{i!==e.childCount-1&&r.push(o)}),t.next(de.fromArray(r))}function m(t,e){return Object.assign(t,{meta:{package:"@milkdown/preset-commonmark",...e}}),t}const io=tn("emphasis");m(io,{displayName:"Attr<emphasis>",group:"Emphasis"});const ht=en("emphasis",t=>({attrs:{marker:{default:t.get(zt).emphasis||"*"}},parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style",getAttrs:e=>e==="italic"}],toDOM:e=>["em",t.get(io.key)(e)],parseMarkdown:{match:e=>e.type==="emphasis",runner:(e,n,r)=>{e.openMark(r,{marker:n.marker}),e.next(n.children),e.closeMark(r)}},toMarkdown:{match:e=>e.type.name==="emphasis",runner:(e,n)=>{e.withMark(n,"emphasis",void 0,{marker:n.attrs.marker})}}}));m(ht.mark,{displayName:"MarkSchema<emphasis>",group:"Emphasis"});m(ht.ctx,{displayName:"MarkSchemaCtx<emphasis>",group:"Emphasis"});const ao=x("ToggleEmphasis",t=>()=>Yn(ht.type(t)));m(ao,{displayName:"Command<toggleEmphasisCommand>",group:"Emphasis"});const Ei=B(t=>Zt(/(?:^|[^*])\*([^*]+)\*$/,ht.type(t),{getAttr:()=>({marker:"*"}),updateCaptured:({fullMatch:e,start:n})=>e.startsWith("*")?{}:{fullMatch:e.slice(1),start:n+1}}));m(Ei,{displayName:"InputRule<emphasis>|Star",group:"Emphasis"});const Ri=B(t=>Zt(/(?:^|[^_])_([^_]+)_$/,ht.type(t),{getAttr:()=>({marker:"_"}),updateCaptured:({fullMatch:e,start:n})=>e.startsWith("_")?{}:{fullMatch:e.slice(1),start:n+1}}));m(Ri,{displayName:"InputRule<emphasis>|Underscore",group:"Emphasis"});const lo=K("emphasisKeymap",{ToggleEmphasis:{shortcuts:"Mod-i",command:t=>{const e=t.get(A);return()=>e.call(ao.key)}}});m(lo.ctx,{displayName:"KeymapCtx<emphasis>",group:"Emphasis"});m(lo.shortcuts,{displayName:"Keymap<emphasis>",group:"Emphasis"});const co=tn("strong");m(co,{displayName:"Attr<strong>",group:"Strong"});const nn=en("strong",t=>({attrs:{marker:{default:t.get(zt).strong||"*"}},parseDOM:[{tag:"b"},{tag:"strong"},{style:"font-style",getAttrs:e=>e==="bold"}],toDOM:e=>["strong",t.get(co.key)(e)],parseMarkdown:{match:e=>e.type==="strong",runner:(e,n,r)=>{e.openMark(r,{marker:n.marker}),e.next(n.children),e.closeMark(r)}},toMarkdown:{match:e=>e.type.name==="strong",runner:(e,n)=>{e.withMark(n,"strong",void 0,{marker:n.attrs.marker})}}}));m(nn.mark,{displayName:"MarkSchema<strong>",group:"Strong"});m(nn.ctx,{displayName:"MarkSchemaCtx<strong>",group:"Strong"});const uo=x("ToggleStrong",t=>()=>Yn(nn.type(t)));m(uo,{displayName:"Command<toggleStrongCommand>",group:"Strong"});const _i=B(t=>Zt(/(?:\*\*|__)([^*_]+)(?:\*\*|__)$/,nn.type(t),{getAttr:e=>({marker:e[0].startsWith("*")?"*":"_"})}));m(_i,{displayName:"InputRule<strong>",group:"Strong"});const po=K("strongKeymap",{ToggleBold:{shortcuts:["Mod-b"],command:t=>{const e=t.get(A);return()=>e.call(uo.key)}}});m(po.ctx,{displayName:"KeymapCtx<strong>",group:"Strong"});m(po.shortcuts,{displayName:"Keymap<strong>",group:"Strong"});const ho=tn("inlineCode");m(ho,{displayName:"Attr<inlineCode>",group:"InlineCode"});const Te=en("inlineCode",t=>({priority:100,code:!0,inclusive:!1,parseDOM:[{tag:"code"}],toDOM:e=>["code",t.get(ho.key)(e)],parseMarkdown:{match:e=>e.type==="inlineCode",runner:(e,n,r)=>{e.openMark(r),e.addText(n.value),e.closeMark(r)}},toMarkdown:{match:e=>e.type.name==="inlineCode",runner:(e,n,r)=>{e.withMark(n,"inlineCode",r.text||"")}}}));m(Te.mark,{displayName:"MarkSchema<inlineCode>",group:"InlineCode"});m(Te.ctx,{displayName:"MarkSchemaCtx<inlineCode>",group:"InlineCode"});const fo=x("ToggleInlineCode",t=>()=>(e,n)=>{const{selection:r,tr:o}=e;if(r.empty)return!1;const{from:s,to:i}=r;return e.doc.rangeHasMark(s,i,Te.type(t))?(n==null||n(o.removeMark(s,i,Te.type(t))),!0):(Object.keys(e.schema.marks).filter(a=>a!==Te.type.name).map(a=>e.schema.marks[a]).forEach(a=>{o.removeMark(s,i,a)}),n==null||n(o.addMark(s,i,Te.type(t).create())),!0)});m(fo,{displayName:"Command<toggleInlineCodeCommand>",group:"InlineCode"});const Li=B(t=>Zt(/(?:`)([^`]+)(?:`)$/,Te.type(t)));m(Li,{displayName:"InputRule<inlineCodeInputRule>",group:"InlineCode"});const mo=K("inlineCodeKeymap",{ToggleInlineCode:{shortcuts:"Mod-e",command:t=>{const e=t.get(A);return()=>e.call(fo.key)}}});m(mo.ctx,{displayName:"KeymapCtx<inlineCode>",group:"InlineCode"});m(mo.shortcuts,{displayName:"Keymap<inlineCode>",group:"InlineCode"});const go=tn("link");m(go,{displayName:"Attr<link>",group:"Link"});const at=en("link",t=>({attrs:{href:{},title:{default:null}},parseDOM:[{tag:"a[href]",getAttrs:e=>{if(!(e instanceof HTMLElement))throw me(e);return{href:e.getAttribute("href"),title:e.getAttribute("title")}}}],toDOM:e=>["a",{...t.get(go.key)(e),...e.attrs}],parseMarkdown:{match:e=>e.type==="link",runner:(e,n,r)=>{const o=n.url,s=n.title;e.openMark(r,{href:o,title:s}),e.next(n.children),e.closeMark(r)}},toMarkdown:{match:e=>e.type.name==="link",runner:(e,n)=>{e.withMark(n,"link",void 0,{title:n.attrs.title,url:n.attrs.href})}}}));m(at.mark,{displayName:"MarkSchema<link>",group:"Link"});const Di=x("ToggleLink",t=>(e={})=>Yn(at.type(t),e));m(Di,{displayName:"Command<toggleLinkCommand>",group:"Link"});const Oi=x("UpdateLink",t=>(e={})=>(n,r)=>{if(!r)return!1;let o,s=-1;const{selection:i}=n,{from:a,to:l}=i;if(n.doc.nodesBetween(a,a===l?l+1:l,(h,g)=>{if(at.type(t).isInSet(h.marks))return o=h,s=g,!1}),!o)return!1;const c=o.marks.find(({type:h})=>h===at.type(t));if(!c)return!1;const d=s,u=s+o.nodeSize,{tr:p}=n,f=at.type(t).create({...c.attrs,...e});return f?(r(p.removeMark(d,u,c).addMark(d,u,f).setSelection(new G(p.selection.$anchor)).scrollIntoView()),!0):!1});m(Oi,{displayName:"Command<updateLinkCommand>",group:"Link"});const Pi=so("doc",()=>({content:"block+",parseMarkdown:{match:({type:t})=>t==="root",runner:(t,e,n)=>{t.injectRoot(e,n)}},toMarkdown:{match:t=>t.type.name==="doc",runner:(t,e)=>{t.openNode("root"),t.next(e.content)}}}));m(Pi,{displayName:"NodeSchema<doc>",group:"Doc"});const yo=ie("paragraph");m(yo,{displayName:"Attr<paragraph>",group:"Paragraph"});const De=D("paragraph",t=>({content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:e=>["p",t.get(yo.key)(e),0],parseMarkdown:{match:e=>e.type==="paragraph",runner:(e,n,r)=>{e.openNode(r),n.children?e.next(n.children):e.addText(n.value||""),e.closeNode()}},toMarkdown:{match:e=>e.type.name==="paragraph",runner:(e,n)=>{e.openNode("paragraph"),Ti(e,n),e.closeNode()}}}));m(De.node,{displayName:"NodeSchema<paragraph>",group:"Paragraph"});m(De.ctx,{displayName:"NodeSchemaCtx<paragraph>",group:"Paragraph"});const wo=x("TurnIntoText",t=>()=>Kt(De.type(t)));m(wo,{displayName:"Command<turnIntoTextCommand>",group:"Paragraph"});const ko=K("paragraphKeymap",{TurnIntoText:{shortcuts:"Mod-Alt-0",command:t=>{const e=t.get(A);return()=>e.call(wo.key)}}});m(ko.ctx,{displayName:"KeymapCtx<paragraph>",group:"Paragraph"});m(ko.shortcuts,{displayName:"Keymap<paragraph>",group:"Paragraph"});const yu=Array(6).fill(0).map((t,e)=>e+1);function wu(t){return t.textContent.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-")}const er=se(wu,"headingIdGenerator");m(er,{displayName:"Ctx<HeadingIdGenerator>",group:"Heading"});const bo=ie("heading");m(bo,{displayName:"Attr<heading>",group:"Heading"});const Ue=D("heading",t=>{const e=t.get(er.key);return{content:"inline*",group:"block",defining:!0,attrs:{id:{default:""},level:{default:1}},parseDOM:yu.map(n=>({tag:`h${n}`,getAttrs:r=>{if(!(r instanceof HTMLElement))throw me(r);return{level:n,id:r.id}}})),toDOM:n=>[`h${n.attrs.level}`,{...t.get(bo.key)(n),id:n.attrs.id||e(n)},0],parseMarkdown:{match:({type:n})=>n==="heading",runner:(n,r,o)=>{const s=r.depth;n.openNode(o,{level:s}),n.next(r.children),n.closeNode()}},toMarkdown:{match:n=>n.type.name==="heading",runner:(n,r)=>{n.openNode("heading",void 0,{depth:r.attrs.level}),Ti(n,r),n.closeNode()}}}});m(Ue.node,{displayName:"NodeSchema<heading>",group:"Heading"});m(Ue.ctx,{displayName:"NodeSchemaCtx<heading>",group:"Heading"});const Fi=B(t=>ci(/^(?<hashes>#+)\s$/,Ue.type(t),e=>{var n,r;const o=((r=(n=e.groups)==null?void 0:n.hashes)==null?void 0:r.length)||0,s=t.get(rt),{$from:i}=s.state.selection,a=i.node();if(a.type.name==="heading"){let l=Number(a.attrs.level)+Number(o);return l>6&&(l=6),{level:l}}return{level:o}}));m(Fi,{displayName:"InputRule<wrapInHeadingInputRule>",group:"Heading"});const $e=x("WrapInHeading",t=>e=>(e??(e=1),e<1?Kt(De.type(t)):Kt(Ue.type(t),{level:e})));m($e,{displayName:"Command<wrapInHeadingCommand>",group:"Heading"});const Co=x("DowngradeHeading",t=>()=>(e,n,r)=>{const{$from:o}=e.selection,s=o.node();if(s.type!==Ue.type(t)||!e.selection.empty||o.parentOffset!==0)return!1;const i=s.attrs.level-1;return i?(n==null||n(e.tr.setNodeMarkup(e.selection.$from.before(),void 0,{...s.attrs,level:i})),!0):Kt(De.type(t))(e,n,r)});m(Co,{displayName:"Command<downgradeHeadingCommand>",group:"Heading"});const xo=K("headingKeymap",{TurnIntoH1:{shortcuts:"Mod-Alt-1",command:t=>{const e=t.get(A);return()=>e.call($e.key,1)}},TurnIntoH2:{shortcuts:"Mod-Alt-2",command:t=>{const e=t.get(A);return()=>e.call($e.key,2)}},TurnIntoH3:{shortcuts:"Mod-Alt-3",command:t=>{const e=t.get(A);return()=>e.call($e.key,3)}},TurnIntoH4:{shortcuts:"Mod-Alt-4",command:t=>{const e=t.get(A);return()=>e.call($e.key,4)}},TurnIntoH5:{shortcuts:"Mod-Alt-5",command:t=>{const e=t.get(A);return()=>e.call($e.key,5)}},TurnIntoH6:{shortcuts:"Mod-Alt-6",command:t=>{const e=t.get(A);return()=>e.call($e.key,6)}},DowngradeHeading:{shortcuts:["Delete","Backspace"],command:t=>{const e=t.get(A);return()=>e.call(Co.key)}}});m(xo.ctx,{displayName:"KeymapCtx<heading>",group:"Heading"});m(xo.shortcuts,{displayName:"Keymap<heading>",group:"Heading"});const Mo=ie("blockquote");m(Mo,{displayName:"Attr<blockquote>",group:"Blockquote"});const rn=D("blockquote",t=>({content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:e=>["blockquote",t.get(Mo.key)(e),0],parseMarkdown:{match:({type:e})=>e==="blockquote",runner:(e,n,r)=>{e.openNode(r).next(n.children).closeNode()}},toMarkdown:{match:e=>e.type.name==="blockquote",runner:(e,n)=>{e.openNode("blockquote").next(n.content).closeNode()}}}));m(rn.node,{displayName:"NodeSchema<blockquote>",group:"Blockquote"});m(rn.ctx,{displayName:"NodeSchemaCtx<blockquote>",group:"Blockquote"});const zi=B(t=>ro(/^\s*>\s$/,rn.type(t)));m(zi,{displayName:"InputRule<wrapInBlockquoteInputRule>",group:"Blockquote"});const No=x("WrapInBlockquote",t=>()=>Yr(rn.type(t)));m(No,{displayName:"Command<wrapInBlockquoteCommand>",group:"Blockquote"});const So=K("blockquoteKeymap",{WrapInBlockquote:{shortcuts:"Mod-Shift-b",command:t=>{const e=t.get(A);return()=>e.call(No.key)}}});m(So.ctx,{displayName:"KeymapCtx<blockquote>",group:"Blockquote"});m(So.shortcuts,{displayName:"Keymap<blockquote>",group:"Blockquote"});const Ao=ie("codeBlock",()=>({pre:{},code:{}}));m(Ao,{displayName:"Attr<codeBlock>",group:"CodeBlock"});const on=D("code_block",t=>({content:"text*",group:"block",marks:"",defining:!0,code:!0,attrs:{language:{default:""}},parseDOM:[{tag:"pre",preserveWhitespace:"full",getAttrs:e=>{if(!(e instanceof HTMLElement))throw me(e);return{language:e.dataset.language}}}],toDOM:e=>{const n=t.get(Ao.key)(e);return["pre",{...n.pre,"data-language":e.attrs.language},["code",n.code,0]]},parseMarkdown:{match:({type:e})=>e==="code",runner:(e,n,r)=>{const o=n.lang,s=n.value;e.openNode(r,{language:o}),s&&e.addText(s),e.closeNode()}},toMarkdown:{match:e=>e.type.name==="code_block",runner:(e,n)=>{var r;e.addNode("code",void 0,((r=n.content.firstChild)==null?void 0:r.text)||"",{lang:n.attrs.language})}}}));m(on.node,{displayName:"NodeSchema<codeBlock>",group:"CodeBlock"});m(on.ctx,{displayName:"NodeSchemaCtx<codeBlock>",group:"CodeBlock"});const Wi=B(t=>ci(/^```(?<language>[a-z]*)?[\s\n]$/,on.type(t),e=>{var n;return{language:((n=e.groups)==null?void 0:n.language)??""}}));m(Wi,{displayName:"InputRule<createCodeBlockInputRule>",group:"CodeBlock"});const $o=x("CreateCodeBlock",t=>(e="")=>Kt(on.type(t),{language:e}));m($o,{displayName:"Command<createCodeBlockCommand>",group:"CodeBlock"});const ku=x("UpdateCodeBlockLanguage",()=>({pos:t,language:e}={pos:-1,language:""})=>(n,r)=>t>=0?(r==null||r(n.tr.setNodeAttribute(t,"language",e)),!0):!1);m(ku,{displayName:"Command<updateCodeBlockLanguageCommand>",group:"CodeBlock"});const vo=K("codeBlockKeymap",{CreateCodeBlock:{shortcuts:"Mod-Alt-c",command:t=>{const e=t.get(A);return()=>e.call($o.key)}}});m(vo.ctx,{displayName:"KeymapCtx<codeBlock>",group:"CodeBlock"});m(vo.shortcuts,{displayName:"Keymap<codeBlock>",group:"CodeBlock"});const Io=ie("image");m(Io,{displayName:"Attr<image>",group:"Image"});const ft=D("image",t=>({inline:!0,group:"inline",selectable:!0,draggable:!0,marks:"",atom:!0,defining:!0,isolating:!0,attrs:{src:{default:""},alt:{default:""},title:{default:""}},parseDOM:[{tag:"img[src]",getAttrs:e=>{if(!(e instanceof HTMLElement))throw me(e);return{src:e.getAttribute("src")||"",alt:e.getAttribute("alt")||"",title:e.getAttribute("title")||e.getAttribute("alt")||""}}}],toDOM:e=>["img",{...t.get(Io.key)(e),...e.attrs}],parseMarkdown:{match:({type:e})=>e==="image",runner:(e,n,r)=>{const o=n.url,s=n.alt,i=n.title;e.addNode(r,{src:o,alt:s,title:i})}},toMarkdown:{match:e=>e.type.name==="image",runner:(e,n)=>{e.addNode("image",void 0,void 0,{title:n.attrs.title,url:n.attrs.src,alt:n.attrs.alt})}}}));m(ft.node,{displayName:"NodeSchema<image>",group:"Image"});m(ft.ctx,{displayName:"NodeSchemaCtx<image>",group:"Image"});const ji=x("InsertImage",t=>(e={})=>(n,r)=>{if(!r)return!0;const{src:o="",alt:s="",title:i=""}=e,a=ft.type(t).create({src:o,alt:s,title:i});return a&&r(n.tr.replaceSelectionWith(a).scrollIntoView()),!0});m(ji,{displayName:"Command<insertImageCommand>",group:"Image"});const Hi=x("UpdateImage",t=>(e={})=>(n,r)=>{const o=tu(n.selection,ft.type(t));if(!o)return!1;const{node:s,pos:i}=o,a={...s.attrs},{src:l,alt:c,title:d}=e;return l!==void 0&&(a.src=l),c!==void 0&&(a.alt=c),d!==void 0&&(a.title=d),r==null||r(n.tr.setNodeMarkup(i,void 0,a).scrollIntoView()),!0});m(Hi,{displayName:"Command<updateImageCommand>",group:"Image"});const bu=B(t=>new H(/!\[(?<alt>.*?)]\((?<filename>.*?)\s*(?="|\))"?(?<title>[^"]+)?"?\)/,(e,n,r,o)=>{const[s,i,a="",l]=n;return s?e.tr.replaceWith(r,o,ft.type(t).create({src:a,alt:i,title:l})):null}));m(bu,{displayName:"InputRule<insertImageInputRule>",group:"Image"});const Gn=ie("hardbreak",t=>({"data-type":"hardbreak","data-is-inline":t.attrs.isInline}));m(Gn,{displayName:"Attr<hardbreak>",group:"Hardbreak"});const Ve=D("hardbreak",t=>({inline:!0,group:"inline",attrs:{isInline:{default:!1}},selectable:!1,parseDOM:[{tag:"br"},{tag:'span[data-type="hardbreak"]',getAttrs:()=>({isInline:!0})}],toDOM:e=>e.attrs.isInline?["span",t.get(Gn.key)(e)," "]:["br",t.get(Gn.key)(e)],parseMarkdown:{match:({type:e})=>e==="break",runner:(e,n,r)=>{var o;e.addNode(r,{isInline:!!((o=n.data)!=null&&o.isInline)})}},leafText:()=>`
`,toMarkdown:{match:e=>e.type.name==="hardbreak",runner:(e,n)=>{n.attrs.isInline?e.addNode("text",void 0,`
`):e.addNode("break")}}}));m(Ve.node,{displayName:"NodeSchema<hardbreak>",group:"Hardbreak"});m(Ve.ctx,{displayName:"NodeSchemaCtx<hardbreak>",group:"Hardbreak"});const To=x("InsertHardbreak",t=>()=>(e,n)=>{var r;const{selection:o,tr:s}=e;if(!(o instanceof G))return!1;if(o.empty){const i=o.$from.node();if(i.childCount>0&&((r=i.lastChild)==null?void 0:r.type.name)==="hardbreak")return n==null||n(s.replaceRangeWith(o.to-1,o.to,e.schema.node("paragraph")).setSelection(q.near(s.doc.resolve(o.to))).scrollIntoView()),!0}return n==null||n(s.setMeta("hardbreak",!0).replaceSelectionWith(Ve.type(t).create()).scrollIntoView()),!0});m(To,{displayName:"Command<insertHardbreakCommand>",group:"Hardbreak"});const Eo=K("hardbreakKeymap",{InsertHardbreak:{shortcuts:"Shift-Enter",command:t=>{const e=t.get(A);return()=>e.call(To.key)}}});m(Eo.ctx,{displayName:"KeymapCtx<hardbreak>",group:"Hardbreak"});m(Eo.shortcuts,{displayName:"Keymap<hardbreak>",group:"Hardbreak"});const Ro=ie("hr");m(Ro,{displayName:"Attr<hr>",group:"Hr"});const sn=D("hr",t=>({group:"block",parseDOM:[{tag:"hr"}],toDOM:e=>["hr",t.get(Ro.key)(e)],parseMarkdown:{match:({type:e})=>e==="thematicBreak",runner:(e,n,r)=>{e.addNode(r)}},toMarkdown:{match:e=>e.type.name==="hr",runner:e=>{e.addNode("thematicBreak")}}}));m(sn.node,{displayName:"NodeSchema<hr>",group:"Hr"});m(sn.ctx,{displayName:"NodeSchemaCtx<hr>",group:"Hr"});const Bi=B(t=>new H(/^(?:---|___\s|\*\*\*\s)$/,(e,n,r,o)=>{const{tr:s}=e;return n[0]&&s.replaceWith(r-1,o,sn.type(t).create()),s}));m(Bi,{displayName:"InputRule<insertHrInputRule>",group:"Hr"});const Ki=x("InsertHr",t=>()=>(e,n)=>{if(!n)return!0;const r=De.node.type(t).create(),{tr:o,selection:s}=e,{from:i}=s,a=sn.type(t).create();if(!a)return!0;const l=o.replaceSelectionWith(a).insert(i,r),c=q.findFrom(l.doc.resolve(i),1,!0);return c&&n(l.setSelection(c).scrollIntoView()),!0});m(Ki,{displayName:"Command<insertHrCommand>",group:"Hr"});const _o=ie("bulletList");m(_o,{displayName:"Attr<bulletList>",group:"BulletList"});const mt=D("bullet_list",t=>({content:"listItem+",group:"block",attrs:{spread:{default:!1}},parseDOM:[{tag:"ul",getAttrs:e=>{if(!(e instanceof HTMLElement))throw me(e);return{spread:e.dataset.spread}}}],toDOM:e=>["ul",{...t.get(_o.key)(e),"data-spread":e.attrs.spread},0],parseMarkdown:{match:({type:e,ordered:n})=>e==="list"&&!n,runner:(e,n,r)=>{const o=n.spread!=null?`${n.spread}`:"false";e.openNode(r,{spread:o}).next(n.children).closeNode()}},toMarkdown:{match:e=>e.type.name==="bullet_list",runner:(e,n)=>{e.openNode("list",void 0,{ordered:!1,spread:n.attrs.spread==="true"}).next(n.content).closeNode()}}}));m(mt.node,{displayName:"NodeSchema<bulletList>",group:"BulletList"});m(mt.ctx,{displayName:"NodeSchemaCtx<bulletList>",group:"BulletList"});const Vi=B(t=>ro(/^\s*([-+*])\s$/,mt.type(t)));m(Vi,{displayName:"InputRule<wrapInBulletListInputRule>",group:"BulletList"});const Lo=x("WrapInBulletList",t=>()=>Yr(mt.type(t)));m(Lo,{displayName:"Command<wrapInBulletListCommand>",group:"BulletList"});const Do=K("bulletListKeymap",{WrapInBulletList:{shortcuts:"Mod-Alt-8",command:t=>{const e=t.get(A);return()=>e.call(Lo.key)}}});m(Do.ctx,{displayName:"KeymapCtx<bulletListKeymap>",group:"BulletList"});m(Do.shortcuts,{displayName:"Keymap<bulletListKeymap>",group:"BulletList"});const Oo=ie("orderedList");m(Oo,{displayName:"Attr<orderedList>",group:"OrderedList"});const gt=D("ordered_list",t=>({content:"listItem+",group:"block",attrs:{order:{default:1},spread:{default:!1}},parseDOM:[{tag:"ol",getAttrs:e=>{if(!(e instanceof HTMLElement))throw me(e);return{spread:e.dataset.spread,order:e.hasAttribute("start")?Number(e.getAttribute("start")):1}}}],toDOM:e=>["ol",{...t.get(Oo.key)(e),...e.attrs.order===1?{}:e.attrs.order,"data-spread":e.attrs.spread},0],parseMarkdown:{match:({type:e,ordered:n})=>e==="list"&&!!n,runner:(e,n,r)=>{const o=n.spread!=null?`${n.spread}`:"true";e.openNode(r,{spread:o}).next(n.children).closeNode()}},toMarkdown:{match:e=>e.type.name==="ordered_list",runner:(e,n)=>{e.openNode("list",void 0,{ordered:!0,start:1,spread:n.attrs.spread==="true"}),e.next(n.content),e.closeNode()}}}));m(gt.node,{displayName:"NodeSchema<orderedList>",group:"OrderedList"});m(gt.ctx,{displayName:"NodeSchemaCtx<orderedList>",group:"OrderedList"});const qi=B(t=>ro(/^\s*(\d+)\.\s$/,gt.type(t),e=>({order:Number(e[1])}),(e,n)=>n.childCount+n.attrs.order===Number(e[1])));m(qi,{displayName:"InputRule<wrapInOrderedListInputRule>",group:"OrderedList"});const Po=x("WrapInOrderedList",t=>()=>Yr(gt.type(t)));m(Po,{displayName:"Command<wrapInOrderedListCommand>",group:"OrderedList"});const Fo=K("orderedListKeymap",{WrapInOrderedList:{shortcuts:"Mod-Alt-7",command:t=>{const e=t.get(A);return()=>e.call(Po.key)}}});m(Fo.ctx,{displayName:"KeymapCtx<orderedList>",group:"OrderedList"});m(Fo.shortcuts,{displayName:"Keymap<orderedList>",group:"OrderedList"});const zo=ie("listItem");m(zo,{displayName:"Attr<listItem>",group:"ListItem"});const fe=D("list_item",t=>({group:"listItem",content:"(paragraph|blockquote) block*",attrs:{label:{default:"•"},listType:{default:"bullet"},spread:{default:"true"}},defining:!0,parseDOM:[{tag:"li",getAttrs:e=>{if(!(e instanceof HTMLElement))throw me(e);return{label:e.dataset.label,listType:e.dataset.listType,spread:e.dataset.spread}}}],toDOM:e=>["li",{...t.get(zo.key)(e),"data-label":e.attrs.label,"data-list-type":e.attrs.listType,"data-spread":e.attrs.spread},0],parseMarkdown:{match:({type:e})=>e==="listItem",runner:(e,n,r)=>{const o=n.label!=null?`${n.label}.`:"•",s=n.label!=null?"ordered":"bullet",i=n.spread!=null?`${n.spread}`:"true";e.openNode(r,{label:o,listType:s,spread:i}),e.next(n.children),e.closeNode()}},toMarkdown:{match:e=>e.type.name==="list_item",runner:(e,n)=>{e.openNode("listItem",void 0,{spread:n.attrs.spread==="true"}),e.next(n.content),e.closeNode()}}}));m(fe.node,{displayName:"NodeSchema<listItem>",group:"ListItem"});m(fe.ctx,{displayName:"NodeSchemaCtx<listItem>",group:"ListItem"});const Wo=x("SinkListItem",t=>()=>dl(fe.type(t)));m(Wo,{displayName:"Command<sinkListItemCommand>",group:"ListItem"});const jo=x("LiftListItem",t=>()=>Ys(fe.type(t)));m(jo,{displayName:"Command<liftListItemCommand>",group:"ListItem"});const Ho=x("SplitListItem",t=>()=>pl(fe.type(t)));m(Ho,{displayName:"Command<splitListItemCommand>",group:"ListItem"});function Cu(t){return(e,n,r)=>{const{selection:o}=e;if(!(o instanceof G))return!1;const{empty:s,$from:i}=o;if(!s||i.parentOffset!==0)return!1;const a=i.node(-1);return a.type!==fe.type(t)||a.firstChild!==i.node()||i.node(-2).childCount>1?!1:Ys(fe.type(t))(e,n,r)}}const Bo=x("LiftFirstListItem",t=>()=>Cu(t));m(Bo,{displayName:"Command<liftFirstListItemCommand>",group:"ListItem"});const Ko=K("listItemKeymap",{NextListItem:{shortcuts:"Enter",command:t=>{const e=t.get(A);return()=>e.call(Ho.key)}},SinkListItem:{shortcuts:["Tab","Mod-]"],command:t=>{const e=t.get(A);return()=>e.call(Wo.key)}},LiftListItem:{shortcuts:["Shift-Tab","Mod-["],command:t=>{const e=t.get(A);return()=>e.call(jo.key)}},LiftFirstListItem:{shortcuts:["Backspace","Delete"],command:t=>{const e=t.get(A);return()=>e.call(Bo.key)}}});m(Ko.ctx,{displayName:"KeymapCtx<listItem>",group:"ListItem"});m(Ko.shortcuts,{displayName:"Keymap<listItem>",group:"ListItem"});const Ui=so("text",()=>({group:"inline",parseMarkdown:{match:({type:t})=>t==="text",runner:(t,e)=>{t.addText(e.value)}},toMarkdown:{match:t=>t.type.name==="text",runner:(t,e)=>{t.addNode("text",void 0,e.text)}}}));m(Ui,{displayName:"NodeSchema<text>",group:"Text"});const Vo=ie("html");m(Vo,{displayName:"Attr<html>",group:"Html"});const qo=D("html",t=>({atom:!0,group:"inline",inline:!0,attrs:{value:{default:""}},toDOM:e=>{const n=document.createElement("span"),r={...t.get(Vo.key)(e),"data-value":e.attrs.value,"data-type":"html"};return n.textContent=e.attrs.value,["span",r,e.attrs.value]},parseDOM:[{tag:'span[data-type="html"]',getAttrs:e=>({value:e.dataset.value??""})}],parseMarkdown:{match:({type:e})=>e==="html",runner:(e,n,r)=>{e.addNode(r,{value:n.value})}},toMarkdown:{match:e=>e.type.name==="html",runner:(e,n)=>{e.addNode("html",void 0,n.attrs.value)}}}));m(qo.node,{displayName:"NodeSchema<html>",group:"Html"});m(qo.ctx,{displayName:"NodeSchemaCtx<html>",group:"Html"});const xu=[Pi,yo,De,er,bo,Ue,Gn,Ve,Mo,rn,Ao,on,Ro,sn,Io,ft,_o,mt,Oo,gt,zo,fe,io,ht,co,nn,ho,Te,go,at,Vo,qo,Ui].flat(),Mu=[zi,Vi,qi,Wi,Bi,Fi].flat(),Nu=[Ei,Ri,Li,_i],Su=[wo,No,$e,Co,$o,To,Ki,ji,Hi,Po,Lo,Wo,Ho,jo,Bo,ao,fo,uo,Di,Oi],Au=[So,vo,Eo,xo,Ko,Fo,Do,ko,lo,mo,po].flat(),Uo=pt("remarkAddOrderInList",()=>()=>t=>{Xt(t,"list",e=>{if(e.ordered){const n=e.start??1;e.children.forEach((r,o)=>{r.label=o+n})}})});m(Uo.plugin,{displayName:"Remark<remarkAddOrderInListPlugin>",group:"Remark"});m(Uo.options,{displayName:"RemarkConfig<remarkAddOrderInListPlugin>",group:"Remark"});const Go=pt("remarkLineBreak",()=>()=>t=>{const e=/[\t ]*(?:\r?\n|\r)/g;Xt(t,"text",(n,r,o)=>{if(!n.value||typeof n.value!="string")return;const s=[];let i=0;e.lastIndex=0;let a=e.exec(n.value);for(;a;){const l=a.index;i!==l&&s.push({type:"text",value:n.value.slice(i,l)}),s.push({type:"break",data:{isInline:!0}}),i=l+a[0].length,a=e.exec(n.value)}if(s.length>0&&o&&typeof r=="number")return i<n.value.length&&s.push({type:"text",value:n.value.slice(i)}),o.children.splice(r,1,...s),r+s.length})});m(Go.plugin,{displayName:"Remark<remarkLineBreak>",group:"Remark"});m(Go.options,{displayName:"RemarkConfig<remarkLineBreak>",group:"Remark"});const Jo=pt("remarkInlineLink",()=>gu);m(Jo.plugin,{displayName:"Remark<remarkInlineLinkPlugin>",group:"Remark"});m(Jo.options,{displayName:"RemarkConfig<remarkInlineLinkPlugin>",group:"Remark"});const $u=t=>!!t.children,vu=t=>t.type==="html";function Iu(t,e){return n(t,0,null)[0];function n(r,o,s){if($u(r)){const i=[];for(let a=0,l=r.children.length;a<l;a++){const c=r.children[a];if(c){const d=n(c,a,r);if(d)for(let u=0,p=d.length;u<p;u++){const f=d[u];f&&i.push(f)}}}r.children=i}return e(r,o,s)}}const Xo=pt("remarkHTMLTransformer",()=>()=>t=>{Iu(t,(e,n,r)=>vu(e)?((r==null?void 0:r.type)==="root"&&(e.children=[{...e}],delete e.value,e.type="paragraph"),[e]):[e])});m(Xo.plugin,{displayName:"Remark<remarkHtmlTransformer>",group:"Remark"});m(Xo.options,{displayName:"RemarkConfig<remarkHtmlTransformer>",group:"Remark"});const Yo=pt("remarkMarker",()=>()=>(t,e)=>{const n=r=>e.value.charAt(r.position.start.offset);Xt(t,r=>["strong","emphasis"].includes(r.type),r=>{r.marker=n(r)})});m(Yo.plugin,{displayName:"Remark<remarkMarker>",group:"Remark"});m(Yo.options,{displayName:"RemarkConfig<remarkMarker>",group:"Remark"});const Gi=ee(()=>{let t=!1;const e=new F("MILKDOWN_INLINE_NODES_CURSOR"),n=new z({key:e,state:{init(){return!1},apply(r){if(!r.selection.empty)return!1;const o=r.selection.$from,s=o.nodeBefore,i=o.nodeAfter;return!!(s&&i&&s.isInline&&!s.isText&&i.isInline&&!i.isText)}},props:{handleDOMEvents:{compositionend:(r,o)=>t?(t=!1,requestAnimationFrame(()=>{if(n.getState(r.state)){const s=r.state.selection.from;o.preventDefault(),r.dispatch(r.state.tr.insertText(o.data||"",s))}}),!0):!1,compositionstart:r=>(n.getState(r.state)&&(t=!0),!1),beforeinput:(r,o)=>{if(n.getState(r.state)&&o instanceof InputEvent&&o.data&&!t){const s=r.state.selection.from;return o.preventDefault(),r.dispatch(r.state.tr.insertText(o.data||"",s)),!0}return!1}},decorations(r){if(n.getState(r)){const o=r.selection.$from.pos,s=document.createElement("span"),i=lt.widget(o,s,{side:-1}),a=document.createElement("span"),l=lt.widget(o,a);return setTimeout(()=>{s.contentEditable="true",a.contentEditable="true"}),ct.create(r.doc,[i,l])}return ct.empty}}});return n});m(Gi,{displayName:"Prose<inlineNodesCursorPlugin>",group:"Prose"});const Ji=ee(t=>new z({key:new F("MILKDOWN_HARDBREAK_MARKS"),appendTransaction:(e,n,r)=>{if(!e.length)return;const[o]=e;if(!o)return;const[s]=o.steps;if(o.getMeta("hardbreak")){if(!(s instanceof hl))return;const{from:i}=s;return r.tr.setNodeMarkup(i,Ve.type(t),void 0,[])}if(s instanceof fl){let i=r.tr;const{from:a,to:l}=s;return r.doc.nodesBetween(a,l,(c,d)=>{c.type===Ve.type(t)&&(i=i.setNodeMarkup(d,Ve.type(t),void 0,[]))}),i}}}));m(Ji,{displayName:"Prose<hardbreakClearMarkPlugin>",group:"Prose"});const Qo=se(["table","code_block"],"hardbreakFilterNodes");m(Qo,{displayName:"Ctx<hardbreakFilterNodes>",group:"Prose"});const Xi=ee(t=>{const e=t.get(Qo.key);return new z({key:new F("MILKDOWN_HARDBREAK_FILTER"),filterTransaction:(n,r)=>{const o=n.getMeta("hardbreak"),[s]=n.steps;if(o&&s){const{from:i}=s,a=r.doc.resolve(i);let l=a.depth,c=!0;for(;l>0;)e.includes(a.node(l).type.name)&&(c=!1),l--;return c}return!0}})});m(Xi,{displayName:"Prose<hardbreakFilterPlugin>",group:"Prose"});const Yi=ee(t=>{const e=new F("MILKDOWN_HEADING_ID"),n=r=>{if(r.composing)return;const o=t.get(er.key),s=r.state.tr.setMeta("addToHistory",!1);let i=!1;const a={};r.state.doc.descendants((l,c)=>{if(l.type===Ue.type(t)){if(l.textContent.trim().length===0)return;const d=l.attrs;let u=o(l);a[u]?(a[u]+=1,u+=`-#${a[u]}`):a[u]=1,d.id!==u&&(i=!0,s.setMeta(e,!0).setNodeMarkup(c,void 0,{...d,id:u}))}}),i&&r.dispatch(s)};return new z({key:e,view:r=>(n(r),{update:(o,s)=>{o.state.doc.eq(s.doc)||n(o)}})})});m(Yi,{displayName:"Prose<syncHeadingIdPlugin>",group:"Prose"});const Qi=ee(t=>{const e=n=>{if(n.composing||!n.editable)return;const r=gt.type(t),o=mt.type(t),s=fe.type(t),i=n.state,a=(d,u)=>{let p=!1;const f=`${u+1}.`;return d.label!==f&&(d.label=f,p=!0),p};let l=i.tr,c=!1;i.doc.descendants((d,u,p,f)=>{if(d.type===o){const h=d.maybeChild(0);(h==null?void 0:h.type)===s&&h.attrs.listType==="ordered"&&(c=!0,l.setNodeMarkup(u,r,{spread:"true"}),d.descendants((g,b,k,v)=>{if(g.type===s){const I={...g.attrs};a(I,v)&&(l=l.setNodeMarkup(b,void 0,I))}return!1}))}else if(d.type===s&&(p==null?void 0:p.type)===r){const h={...d.attrs};let g=!1;h.listType!=="ordered"&&(h.listType="ordered",g=!0),p!=null&&p.maybeChild(0)&&(g=a(h,f)),g&&(l=l.setNodeMarkup(u,void 0,h),c=!0)}}),c&&n.dispatch(l.setMeta("addToHistory",!1))};return new z({key:new F("MILKDOWN_KEEP_LIST_ORDER"),view:n=>(e(n),{update:r=>{e(r)}})})});m(Qi,{displayName:"Prose<syncListOrderPlugin>",group:"Prose"});const Tu=[Ji,Qo,Xi,Gi,Uo,Jo,Go,Xo,Yo,Yi,Qi].flat(),Eu=[xu,Mu,Nu,Su,Au,Tu].flat();var Br,Kr;if(typeof WeakMap<"u"){let t=new WeakMap;Br=e=>t.get(e),Kr=(e,n)=>(t.set(e,n),n)}else{const t=[];let n=0;Br=r=>{for(let o=0;o<t.length;o+=2)if(t[o]==r)return t[o+1]},Kr=(r,o)=>(n==10&&(n=0),t[n++]=r,t[n++]=o)}var $=class{constructor(t,e,n,r){this.width=t,this.height=e,this.map=n,this.problems=r}findCell(t){for(let e=0;e<this.map.length;e++){const n=this.map[e];if(n!=t)continue;const r=e%this.width,o=e/this.width|0;let s=r+1,i=o+1;for(let a=1;s<this.width&&this.map[e+a]==n;a++)s++;for(let a=1;i<this.height&&this.map[e+this.width*a]==n;a++)i++;return{left:r,top:o,right:s,bottom:i}}throw new RangeError(`No cell with offset ${t} found`)}colCount(t){for(let e=0;e<this.map.length;e++)if(this.map[e]==t)return e%this.width;throw new RangeError(`No cell with offset ${t} found`)}nextCell(t,e,n){const{left:r,right:o,top:s,bottom:i}=this.findCell(t);return e=="horiz"?(n<0?r==0:o==this.width)?null:this.map[s*this.width+(n<0?r-1:o)]:(n<0?s==0:i==this.height)?null:this.map[r+this.width*(n<0?s-1:i)]}rectBetween(t,e){const{left:n,right:r,top:o,bottom:s}=this.findCell(t),{left:i,right:a,top:l,bottom:c}=this.findCell(e);return{left:Math.min(n,i),top:Math.min(o,l),right:Math.max(r,a),bottom:Math.max(s,c)}}cellsInRect(t){const e=[],n={};for(let r=t.top;r<t.bottom;r++)for(let o=t.left;o<t.right;o++){const s=r*this.width+o,i=this.map[s];n[i]||(n[i]=!0,!(o==t.left&&o&&this.map[s-1]==i||r==t.top&&r&&this.map[s-this.width]==i)&&e.push(i))}return e}positionAt(t,e,n){for(let r=0,o=0;;r++){const s=o+n.child(r).nodeSize;if(r==t){let i=e+t*this.width;const a=(t+1)*this.width;for(;i<a&&this.map[i]<o;)i++;return i==a?s-1:this.map[i]}o=s}}static get(t){return Br(t)||Kr(t,Ru(t))}};function Ru(t){if(t.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+t.type.name);const e=_u(t),n=t.childCount,r=[];let o=0,s=null;const i=[];for(let c=0,d=e*n;c<d;c++)r[c]=0;for(let c=0,d=0;c<n;c++){const u=t.child(c);d++;for(let h=0;;h++){for(;o<r.length&&r[o]!=0;)o++;if(h==u.childCount)break;const g=u.child(h),{colspan:b,rowspan:k,colwidth:v}=g.attrs;for(let I=0;I<k;I++){if(I+c>=n){(s||(s=[])).push({type:"overlong_rowspan",pos:d,n:k-I});break}const W=o+I*e;for(let X=0;X<b;X++){r[W+X]==0?r[W+X]=d:(s||(s=[])).push({type:"collision",row:c,pos:d,n:b-X});const P=v&&v[X];if(P){const kt=(W+X)%e*2,sr=i[kt];sr==null||sr!=P&&i[kt+1]==1?(i[kt]=P,i[kt+1]=1):sr==P&&i[kt+1]++}}}o+=b,d+=g.nodeSize}const p=(c+1)*e;let f=0;for(;o<p;)r[o++]==0&&f++;f&&(s||(s=[])).push({type:"missing",row:c,n:f}),d++}const a=new $(e,n,r,s);let l=!1;for(let c=0;!l&&c<i.length;c+=2)i[c]!=null&&i[c+1]<n&&(l=!0);return l&&Lu(a,i,t),a}function _u(t){let e=-1,n=!1;for(let r=0;r<t.childCount;r++){const o=t.child(r);let s=0;if(n)for(let i=0;i<r;i++){const a=t.child(i);for(let l=0;l<a.childCount;l++){const c=a.child(l);i+c.attrs.rowspan>r&&(s+=c.attrs.colspan)}}for(let i=0;i<o.childCount;i++){const a=o.child(i);s+=a.attrs.colspan,a.attrs.rowspan>1&&(n=!0)}e==-1?e=s:e!=s&&(e=Math.max(e,s))}return e}function Lu(t,e,n){t.problems||(t.problems=[]);const r={};for(let o=0;o<t.map.length;o++){const s=t.map[o];if(r[s])continue;r[s]=!0;const i=n.nodeAt(s);if(!i)throw new RangeError(`No cell with offset ${s} found`);let a=null;const l=i.attrs;for(let c=0;c<l.colspan;c++){const d=(o+c)%t.width,u=e[d*2];u!=null&&(!l.colwidth||l.colwidth[c]!=u)&&((a||(a=Du(l)))[c]=u)}a&&t.problems.unshift({type:"colwidth mismatch",pos:s,colwidth:a})}}function Du(t){if(t.colwidth)return t.colwidth.slice();const e=[];for(let n=0;n<t.colspan;n++)e.push(0);return e}function Ls(t,e){if(typeof t=="string")return{};const n=t.getAttribute("data-colwidth"),r=n&&/^\d+(,\d+)*$/.test(n)?n.split(",").map(i=>Number(i)):null,o=Number(t.getAttribute("colspan")||1),s={colspan:o,rowspan:Number(t.getAttribute("rowspan")||1),colwidth:r&&r.length==o?r:null};for(const i in e){const a=e[i].getFromDOM,l=a&&a(t);l!=null&&(s[i]=l)}return s}function Ds(t,e){const n={};t.attrs.colspan!=1&&(n.colspan=t.attrs.colspan),t.attrs.rowspan!=1&&(n.rowspan=t.attrs.rowspan),t.attrs.colwidth&&(n["data-colwidth"]=t.attrs.colwidth.join(","));for(const r in e){const o=e[r].setDOMAttr;o&&o(t.attrs[r],n)}return n}function Ou(t){const e=t.cellAttributes||{},n={colspan:{default:1},rowspan:{default:1},colwidth:{default:null}};for(const r in e)n[r]={default:e[r].default};return{table:{content:"table_row+",tableRole:"table",isolating:!0,group:t.tableGroup,parseDOM:[{tag:"table"}],toDOM(){return["table",["tbody",0]]}},table_row:{content:"(table_cell | table_header)*",tableRole:"row",parseDOM:[{tag:"tr"}],toDOM(){return["tr",0]}},table_cell:{content:t.cellContent,attrs:n,tableRole:"cell",isolating:!0,parseDOM:[{tag:"td",getAttrs:r=>Ls(r,e)}],toDOM(r){return["td",Ds(r,e),0]}},table_header:{content:t.cellContent,attrs:n,tableRole:"header_cell",isolating:!0,parseDOM:[{tag:"th",getAttrs:r=>Ls(r,e)}],toDOM(r){return["th",Ds(r,e),0]}}}}function Z(t){let e=t.cached.tableNodeTypes;if(!e){e=t.cached.tableNodeTypes={};for(const n in t.nodes){const r=t.nodes[n],o=r.spec.tableRole;o&&(e[o]=r)}}return e}var ve=new F("selectingCells");function an(t){for(let e=t.depth-1;e>0;e--)if(t.node(e).type.spec.tableRole=="row")return t.node(0).resolve(t.before(e+1));return null}function te(t){const e=t.selection.$head;for(let n=e.depth;n>0;n--)if(e.node(n).type.spec.tableRole=="row")return!0;return!1}function tr(t){const e=t.selection;if("$anchorCell"in e&&e.$anchorCell)return e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell;if("node"in e&&e.node&&e.node.type.spec.tableRole=="cell")return e.$anchor;const n=an(e.$head)||Pu(e.$head);if(n)return n;throw new RangeError(`No cell found around position ${e.head}`)}function Pu(t){for(let e=t.nodeAfter,n=t.pos;e;e=e.firstChild,n++){const r=e.type.spec.tableRole;if(r=="cell"||r=="header_cell")return t.doc.resolve(n)}for(let e=t.nodeBefore,n=t.pos;e;e=e.lastChild,n--){const r=e.type.spec.tableRole;if(r=="cell"||r=="header_cell")return t.doc.resolve(n-e.nodeSize)}}function Vr(t){return t.parent.type.spec.tableRole=="row"&&!!t.nodeAfter}function Fu(t){return t.node(0).resolve(t.pos+t.nodeAfter.nodeSize)}function Zo(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function Zi(t,e,n){const r=t.node(-1),o=$.get(r),s=t.start(-1),i=o.nextCell(t.pos-s,e,n);return i==null?null:t.node(0).resolve(s+i)}function qe(t,e,n=1){const r={...t,colspan:t.colspan-n};return r.colwidth&&(r.colwidth=r.colwidth.slice(),r.colwidth.splice(e,n),r.colwidth.some(o=>o>0)||(r.colwidth=null)),r}function zu(t,e,n=1){const r={...t,colspan:t.colspan+n};if(r.colwidth){r.colwidth=r.colwidth.slice();for(let o=0;o<n;o++)r.colwidth.splice(e,0,0)}return r}function Wu(t,e,n){const r=Z(e.type.schema).header_cell;for(let o=0;o<t.height;o++)if(e.nodeAt(t.map[n+o*t.width]).type!=r)return!1;return!0}var E=class we extends q{constructor(e,n=e){const r=e.node(-1),o=$.get(r),s=e.start(-1),i=o.rectBetween(e.pos-s,n.pos-s),a=e.node(0),l=o.cellsInRect(i).filter(d=>d!=n.pos-s);l.unshift(n.pos-s);const c=l.map(d=>{const u=r.nodeAt(d);if(!u)throw RangeError(`No cell with offset ${d} found`);const p=s+d+1;return new ml(a.resolve(p),a.resolve(p+u.content.size))});super(c[0].$from,c[0].$to,c),this.$anchorCell=e,this.$headCell=n}map(e,n){const r=e.resolve(n.map(this.$anchorCell.pos)),o=e.resolve(n.map(this.$headCell.pos));if(Vr(r)&&Vr(o)&&Zo(r,o)){const s=this.$anchorCell.node(-1)!=r.node(-1);return s&&this.isRowSelection()?we.rowSelection(r,o):s&&this.isColSelection()?we.colSelection(r,o):new we(r,o)}return G.between(r,o)}content(){const e=this.$anchorCell.node(-1),n=$.get(e),r=this.$anchorCell.start(-1),o=n.rectBetween(this.$anchorCell.pos-r,this.$headCell.pos-r),s={},i=[];for(let l=o.top;l<o.bottom;l++){const c=[];for(let d=l*n.width+o.left,u=o.left;u<o.right;u++,d++){const p=n.map[d];if(s[p])continue;s[p]=!0;const f=n.findCell(p);let h=e.nodeAt(p);if(!h)throw RangeError(`No cell with offset ${p} found`);const g=o.left-f.left,b=f.right-o.right;if(g>0||b>0){let k=h.attrs;if(g>0&&(k=qe(k,0,g)),b>0&&(k=qe(k,k.colspan-b,b)),f.left<o.left){if(h=h.type.createAndFill(k),!h)throw RangeError(`Could not create cell with attrs ${JSON.stringify(k)}`)}else h=h.type.create(k,h.content)}if(f.top<o.top||f.bottom>o.bottom){const k={...h.attrs,rowspan:Math.min(f.bottom,o.bottom)-Math.max(f.top,o.top)};f.top<o.top?h=h.type.createAndFill(k):h=h.type.create(k,h.content)}c.push(h)}i.push(e.child(l).copy(de.from(c)))}const a=this.isColSelection()&&this.isRowSelection()?e:i;return new Ie(de.from(a),1,1)}replace(e,n=Ie.empty){const r=e.steps.length,o=this.ranges;for(let i=0;i<o.length;i++){const{$from:a,$to:l}=o[i],c=e.mapping.slice(r);e.replace(c.map(a.pos),c.map(l.pos),i?Ie.empty:n)}const s=q.findFrom(e.doc.resolve(e.mapping.slice(r).map(this.to)),-1);s&&e.setSelection(s)}replaceWith(e,n){this.replace(e,new Ie(de.from(n),0,0))}forEachCell(e){const n=this.$anchorCell.node(-1),r=$.get(n),o=this.$anchorCell.start(-1),s=r.cellsInRect(r.rectBetween(this.$anchorCell.pos-o,this.$headCell.pos-o));for(let i=0;i<s.length;i++)e(n.nodeAt(s[i]),o+s[i])}isColSelection(){const e=this.$anchorCell.index(-1),n=this.$headCell.index(-1);if(Math.min(e,n)>0)return!1;const r=e+this.$anchorCell.nodeAfter.attrs.rowspan,o=n+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(r,o)==this.$headCell.node(-1).childCount}static colSelection(e,n=e){const r=e.node(-1),o=$.get(r),s=e.start(-1),i=o.findCell(e.pos-s),a=o.findCell(n.pos-s),l=e.node(0);return i.top<=a.top?(i.top>0&&(e=l.resolve(s+o.map[i.left])),a.bottom<o.height&&(n=l.resolve(s+o.map[o.width*(o.height-1)+a.right-1]))):(a.top>0&&(n=l.resolve(s+o.map[a.left])),i.bottom<o.height&&(e=l.resolve(s+o.map[o.width*(o.height-1)+i.right-1]))),new we(e,n)}isRowSelection(){const e=this.$anchorCell.node(-1),n=$.get(e),r=this.$anchorCell.start(-1),o=n.colCount(this.$anchorCell.pos-r),s=n.colCount(this.$headCell.pos-r);if(Math.min(o,s)>0)return!1;const i=o+this.$anchorCell.nodeAfter.attrs.colspan,a=s+this.$headCell.nodeAfter.attrs.colspan;return Math.max(i,a)==n.width}eq(e){return e instanceof we&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos}static rowSelection(e,n=e){const r=e.node(-1),o=$.get(r),s=e.start(-1),i=o.findCell(e.pos-s),a=o.findCell(n.pos-s),l=e.node(0);return i.left<=a.left?(i.left>0&&(e=l.resolve(s+o.map[i.top*o.width])),a.right<o.width&&(n=l.resolve(s+o.map[o.width*(a.top+1)-1]))):(a.left>0&&(n=l.resolve(s+o.map[a.top*o.width])),i.right<o.width&&(e=l.resolve(s+o.map[o.width*(i.top+1)-1]))),new we(e,n)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(e,n){return new we(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){return new we(e.resolve(n),e.resolve(r))}getBookmark(){return new ju(this.$anchorCell.pos,this.$headCell.pos)}};E.prototype.visible=!1;q.jsonID("cell",E);var ju=class ea{constructor(e,n){this.anchor=e,this.head=n}map(e){return new ea(e.map(this.anchor),e.map(this.head))}resolve(e){const n=e.resolve(this.anchor),r=e.resolve(this.head);return n.parent.type.spec.tableRole=="row"&&r.parent.type.spec.tableRole=="row"&&n.index()<n.parent.childCount&&r.index()<r.parent.childCount&&Zo(n,r)?new E(n,r):q.near(r,1)}};function Hu(t){if(!(t.selection instanceof E))return null;const e=[];return t.selection.forEachCell((n,r)=>{e.push(lt.node(r,r+n.nodeSize,{class:"selectedCell"}))}),ct.create(t.doc,e)}function Bu({$from:t,$to:e}){if(t.pos==e.pos||t.pos<e.pos-6)return!1;let n=t.pos,r=e.pos,o=t.depth;for(;o>=0&&!(t.after(o+1)<t.end(o));o--,n++);for(let s=e.depth;s>=0&&!(e.before(s+1)>e.start(s));s--,r--);return n==r&&/row|table/.test(t.node(o).type.spec.tableRole)}function Ku({$from:t,$to:e}){let n,r;for(let o=t.depth;o>0;o--){const s=t.node(o);if(s.type.spec.tableRole==="cell"||s.type.spec.tableRole==="header_cell"){n=s;break}}for(let o=e.depth;o>0;o--){const s=e.node(o);if(s.type.spec.tableRole==="cell"||s.type.spec.tableRole==="header_cell"){r=s;break}}return n!==r&&e.parentOffset===0}function Vu(t,e,n){const r=(e||t).selection,o=(e||t).doc;let s,i;if(r instanceof Gs&&(i=r.node.type.spec.tableRole)){if(i=="cell"||i=="header_cell")s=E.create(o,r.from);else if(i=="row"){const a=o.resolve(r.from+1);s=E.rowSelection(a,a)}else if(!n){const a=$.get(r.node),l=r.from+1,c=l+a.map[a.width*a.height-1];s=E.create(o,l+1,c)}}else r instanceof G&&Bu(r)?s=G.create(o,r.from):r instanceof G&&Ku(r)&&(s=G.create(o,r.$from.start(),r.$from.end()));return s&&(e||(e=t.tr)).setSelection(s),e}var qu=new F("fix-tables");function ta(t,e,n,r){const o=t.childCount,s=e.childCount;e:for(let i=0,a=0;i<s;i++){const l=e.child(i);for(let c=a,d=Math.min(o,i+3);c<d;c++)if(t.child(c)==l){a=c+1,n+=l.nodeSize;continue e}r(l,n),a<o&&t.child(a).sameMarkup(l)?ta(t.child(a),l,n+1,r):l.nodesBetween(0,l.content.size,r,n+1),n+=l.nodeSize}}function Uu(t,e){let n;const r=(o,s)=>{o.type.spec.tableRole=="table"&&(n=Gu(t,o,s,n))};return e?e.doc!=t.doc&&ta(e.doc,t.doc,0,r):t.doc.descendants(r),n}function Gu(t,e,n,r){const o=$.get(e);if(!o.problems)return r;r||(r=t.tr);const s=[];for(let l=0;l<o.height;l++)s.push(0);for(let l=0;l<o.problems.length;l++){const c=o.problems[l];if(c.type=="collision"){const d=e.nodeAt(c.pos);if(!d)continue;const u=d.attrs;for(let p=0;p<u.rowspan;p++)s[c.row+p]+=c.n;r.setNodeMarkup(r.mapping.map(n+1+c.pos),null,qe(u,u.colspan-c.n,c.n))}else if(c.type=="missing")s[c.row]+=c.n;else if(c.type=="overlong_rowspan"){const d=e.nodeAt(c.pos);if(!d)continue;r.setNodeMarkup(r.mapping.map(n+1+c.pos),null,{...d.attrs,rowspan:d.attrs.rowspan-c.n})}else if(c.type=="colwidth mismatch"){const d=e.nodeAt(c.pos);if(!d)continue;r.setNodeMarkup(r.mapping.map(n+1+c.pos),null,{...d.attrs,colwidth:c.colwidth})}}let i,a;for(let l=0;l<s.length;l++)s[l]&&(i==null&&(i=l),a=l);for(let l=0,c=n+1;l<o.height;l++){const d=e.child(l),u=c+d.nodeSize,p=s[l];if(p>0){let f="cell";d.firstChild&&(f=d.firstChild.type.spec.tableRole);const h=[];for(let b=0;b<p;b++){const k=Z(t.schema)[f].createAndFill();k&&h.push(k)}const g=(l==0||i==l-1)&&a==l?c+1:u-1;r.insert(r.mapping.map(g),h)}c=u}return r.setMeta(qu,{fixTables:!0})}function Oe(t){const e=t.selection,n=tr(t),r=n.node(-1),o=n.start(-1),s=$.get(r);return{...e instanceof E?s.rectBetween(e.$anchorCell.pos-o,e.$headCell.pos-o):s.findCell(n.pos-o),tableStart:o,map:s,table:r}}function na(t,{map:e,tableStart:n,table:r},o){let s=o>0?-1:0;Wu(e,r,o+s)&&(s=o==0||o==e.width?null:0);for(let i=0;i<e.height;i++){const a=i*e.width+o;if(o>0&&o<e.width&&e.map[a-1]==e.map[a]){const l=e.map[a],c=r.nodeAt(l);t.setNodeMarkup(t.mapping.map(n+l),null,zu(c.attrs,o-e.colCount(l))),i+=c.attrs.rowspan-1}else{const l=s==null?Z(r.type.schema).cell:r.nodeAt(e.map[a+s]).type,c=e.positionAt(i,o,r);t.insert(t.mapping.map(n+c),l.createAndFill())}}return t}function Ju(t,e){if(!te(t))return!1;if(e){const n=Oe(t);e(na(t.tr,n,n.left))}return!0}function Xu(t,e){if(!te(t))return!1;if(e){const n=Oe(t);e(na(t.tr,n,n.right))}return!0}function Yu(t,{map:e,table:n,tableStart:r},o){const s=t.mapping.maps.length;for(let i=0;i<e.height;){const a=i*e.width+o,l=e.map[a],c=n.nodeAt(l),d=c.attrs;if(o>0&&e.map[a-1]==l||o<e.width-1&&e.map[a+1]==l)t.setNodeMarkup(t.mapping.slice(s).map(r+l),null,qe(d,o-e.colCount(l)));else{const u=t.mapping.slice(s).map(r+l);t.delete(u,u+c.nodeSize)}i+=d.rowspan}}function Qu(t,e){if(!te(t))return!1;if(e){const n=Oe(t),r=t.tr;if(n.left==0&&n.right==n.map.width)return!1;for(let o=n.right-1;Yu(r,n,o),o!=n.left;o--){const s=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc;if(!s)throw RangeError("No table found");n.table=s,n.map=$.get(s)}e(r)}return!0}function Zu(t,{map:e,table:n,tableStart:r},o){let s=0;for(let c=0;c<o;c++)s+=n.child(c).nodeSize;const i=s+n.child(o).nodeSize,a=t.mapping.maps.length;t.delete(s+r,i+r);const l=new Set;for(let c=0,d=o*e.width;c<e.width;c++,d++){const u=e.map[d];if(!l.has(u)){if(l.add(u),o>0&&u==e.map[d-e.width]){const p=n.nodeAt(u).attrs;t.setNodeMarkup(t.mapping.slice(a).map(u+r),null,{...p,rowspan:p.rowspan-1}),c+=p.colspan-1}else if(o<e.height&&u==e.map[d+e.width]){const p=n.nodeAt(u),f=p.attrs,h=p.type.create({...f,rowspan:p.attrs.rowspan-1},p.content),g=e.positionAt(o+1,c,n);t.insert(t.mapping.slice(a).map(r+g),h),c+=f.colspan-1}}}}function ed(t,e){if(!te(t))return!1;if(e){const n=Oe(t),r=t.tr;if(n.top==0&&n.bottom==n.map.height)return!1;for(let o=n.bottom-1;Zu(r,n,o),o!=n.top;o--){const s=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc;if(!s)throw RangeError("No table found");n.table=s,n.map=$.get(n.table)}e(r)}return!0}function td(t,e){return function(n,r){if(!te(n))return!1;const o=tr(n);if(o.nodeAfter.attrs[t]===e)return!1;if(r){const s=n.tr;n.selection instanceof E?n.selection.forEachCell((i,a)=>{i.attrs[t]!==e&&s.setNodeMarkup(a,null,{...i.attrs,[t]:e})}):s.setNodeMarkup(o.pos,null,{...o.nodeAfter.attrs,[t]:e}),r(s)}return!0}}function nd(t){return function(e,n){if(!te(e))return!1;if(n){const r=Z(e.schema),o=Oe(e),s=e.tr,i=o.map.cellsInRect(t=="column"?{left:o.left,top:0,right:o.right,bottom:o.map.height}:t=="row"?{left:0,top:o.top,right:o.map.width,bottom:o.bottom}:o),a=i.map(l=>o.table.nodeAt(l));for(let l=0;l<i.length;l++)a[l].type==r.header_cell&&s.setNodeMarkup(o.tableStart+i[l],r.cell,a[l].attrs);if(s.steps.length==0)for(let l=0;l<i.length;l++)s.setNodeMarkup(o.tableStart+i[l],r.header_cell,a[l].attrs);n(s)}return!0}}function Os(t,e,n){const r=e.map.cellsInRect({left:0,top:0,right:t=="row"?e.map.width:1,bottom:t=="column"?e.map.height:1});for(let o=0;o<r.length;o++){const s=e.table.nodeAt(r[o]);if(s&&s.type!==n.header_cell)return!1}return!0}function es(t,e){return e=e||{useDeprecatedLogic:!1},e.useDeprecatedLogic?nd(t):function(n,r){if(!te(n))return!1;if(r){const o=Z(n.schema),s=Oe(n),i=n.tr,a=Os("row",s,o),l=Os("column",s,o),d=(t==="column"?a:t==="row"?l:!1)?1:0,u=t=="column"?{left:0,top:d,right:1,bottom:s.map.height}:t=="row"?{left:d,top:0,right:s.map.width,bottom:1}:s,p=t=="column"?l?o.cell:o.header_cell:t=="row"?a?o.cell:o.header_cell:o.cell;s.map.cellsInRect(u).forEach(f=>{const h=f+s.tableStart,g=i.doc.nodeAt(h);g&&i.setNodeMarkup(h,p,g.attrs)}),r(i)}return!0}}es("row",{useDeprecatedLogic:!0});es("column",{useDeprecatedLogic:!0});es("cell",{useDeprecatedLogic:!0});function rd(t,e){if(e<0){const n=t.nodeBefore;if(n)return t.pos-n.nodeSize;for(let r=t.index(-1)-1,o=t.before();r>=0;r--){const s=t.node(-1).child(r),i=s.lastChild;if(i)return o-1-i.nodeSize;o-=s.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;const n=t.node(-1);for(let r=t.indexAfter(-1),o=t.after();r<n.childCount;r++){const s=n.child(r);if(s.childCount)return o+1;o+=s.nodeSize}}return null}function ra(t){return function(e,n){if(!te(e))return!1;const r=rd(tr(e),t);if(r==null)return!1;if(n){const o=e.doc.resolve(r);n(e.tr.setSelection(G.between(o,Fu(o))).scrollIntoView())}return!0}}function od(t,e){const n=t.selection.$anchor;for(let r=n.depth;r>0;r--)if(n.node(r).type.spec.tableRole=="table")return e&&e(t.tr.delete(n.before(r),n.after(r)).scrollIntoView()),!0;return!1}function fn(t,e){const n=t.selection;if(!(n instanceof E))return!1;if(e){const r=t.tr,o=Z(t.schema).cell.createAndFill().content;n.forEachCell((s,i)=>{s.content.eq(o)||r.replace(r.mapping.map(i+1),r.mapping.map(i+s.nodeSize-1),new Ie(o,0,0))}),r.docChanged&&e(r)}return!0}function sd(t){if(!t.size)return null;let{content:e,openStart:n,openEnd:r}=t;for(;e.childCount==1&&(n>0&&r>0||e.child(0).type.spec.tableRole=="table");)n--,r--,e=e.child(0).content;const o=e.child(0),s=o.type.spec.tableRole,i=o.type.schema,a=[];if(s=="row")for(let l=0;l<e.childCount;l++){let c=e.child(l).content;const d=l?0:Math.max(0,n-1),u=l<e.childCount-1?0:Math.max(0,r-1);(d||u)&&(c=qr(Z(i).row,new Ie(c,d,u)).content),a.push(c)}else if(s=="cell"||s=="header_cell")a.push(n||r?qr(Z(i).row,new Ie(e,n,r)).content:e);else return null;return id(i,a)}function id(t,e){const n=[];for(let o=0;o<e.length;o++){const s=e[o];for(let i=s.childCount-1;i>=0;i--){const{rowspan:a,colspan:l}=s.child(i).attrs;for(let c=o;c<o+a;c++)n[c]=(n[c]||0)+l}}let r=0;for(let o=0;o<n.length;o++)r=Math.max(r,n[o]);for(let o=0;o<n.length;o++)if(o>=e.length&&e.push(de.empty),n[o]<r){const s=Z(t).cell.createAndFill(),i=[];for(let a=n[o];a<r;a++)i.push(s);e[o]=e[o].append(de.from(i))}return{height:e.length,width:r,rows:e}}function qr(t,e){const n=t.createAndFill();return new yl(n).replace(0,n.content.size,e).doc}function ad({width:t,height:e,rows:n},r,o){if(t!=r){const s=[],i=[];for(let a=0;a<n.length;a++){const l=n[a],c=[];for(let d=s[a]||0,u=0;d<r;u++){let p=l.child(u%l.childCount);d+p.attrs.colspan>r&&(p=p.type.createChecked(qe(p.attrs,p.attrs.colspan,d+p.attrs.colspan-r),p.content)),c.push(p),d+=p.attrs.colspan;for(let f=1;f<p.attrs.rowspan;f++)s[a+f]=(s[a+f]||0)+p.attrs.colspan}i.push(de.from(c))}n=i,t=r}if(e!=o){const s=[];for(let i=0,a=0;i<o;i++,a++){const l=[],c=n[a%e];for(let d=0;d<c.childCount;d++){let u=c.child(d);i+u.attrs.rowspan>o&&(u=u.type.create({...u.attrs,rowspan:Math.max(1,o-u.attrs.rowspan)},u.content)),l.push(u)}s.push(de.from(l))}n=s,e=o}return{width:t,height:e,rows:n}}function ld(t,e,n,r,o,s,i){const a=t.doc.type.schema,l=Z(a);let c,d;if(o>e.width)for(let u=0,p=0;u<e.height;u++){const f=n.child(u);p+=f.nodeSize;const h=[];let g;f.lastChild==null||f.lastChild.type==l.cell?g=c||(c=l.cell.createAndFill()):g=d||(d=l.header_cell.createAndFill());for(let b=e.width;b<o;b++)h.push(g);t.insert(t.mapping.slice(i).map(p-1+r),h)}if(s>e.height){const u=[];for(let h=0,g=(e.height-1)*e.width;h<Math.max(e.width,o);h++){const b=h>=e.width?!1:n.nodeAt(e.map[g+h]).type==l.header_cell;u.push(b?d||(d=l.header_cell.createAndFill()):c||(c=l.cell.createAndFill()))}const p=l.row.create(null,de.from(u)),f=[];for(let h=e.height;h<s;h++)f.push(p);t.insert(t.mapping.slice(i).map(r+n.nodeSize-2),f)}return!!(c||d)}function Ps(t,e,n,r,o,s,i,a){if(i==0||i==e.height)return!1;let l=!1;for(let c=o;c<s;c++){const d=i*e.width+c,u=e.map[d];if(e.map[d-e.width]==u){l=!0;const p=n.nodeAt(u),{top:f,left:h}=e.findCell(u);t.setNodeMarkup(t.mapping.slice(a).map(u+r),null,{...p.attrs,rowspan:i-f}),t.insert(t.mapping.slice(a).map(e.positionAt(i,h,n)),p.type.createAndFill({...p.attrs,rowspan:f+p.attrs.rowspan-i})),c+=p.attrs.colspan-1}}return l}function Fs(t,e,n,r,o,s,i,a){if(i==0||i==e.width)return!1;let l=!1;for(let c=o;c<s;c++){const d=c*e.width+i,u=e.map[d];if(e.map[d-1]==u){l=!0;const p=n.nodeAt(u),f=e.colCount(u),h=t.mapping.slice(a).map(u+r);t.setNodeMarkup(h,null,qe(p.attrs,i-f,p.attrs.colspan-(i-f))),t.insert(h+p.nodeSize,p.type.createAndFill(qe(p.attrs,0,i-f))),c+=p.attrs.rowspan-1}}return l}function zs(t,e,n,r,o){let s=n?t.doc.nodeAt(n-1):t.doc;if(!s)throw new Error("No table found");let i=$.get(s);const{top:a,left:l}=r,c=l+o.width,d=a+o.height,u=t.tr;let p=0;function f(){if(s=n?u.doc.nodeAt(n-1):u.doc,!s)throw new Error("No table found");i=$.get(s),p=u.mapping.maps.length}ld(u,i,s,n,c,d,p)&&f(),Ps(u,i,s,n,l,c,a,p)&&f(),Ps(u,i,s,n,l,c,d,p)&&f(),Fs(u,i,s,n,a,d,l,p)&&f(),Fs(u,i,s,n,a,d,c,p)&&f();for(let h=a;h<d;h++){const g=i.positionAt(h,l,s),b=i.positionAt(h,c,s);u.replace(u.mapping.slice(p).map(g+n),u.mapping.slice(p).map(b+n),new Ie(o.rows[h-a],0,0))}f(),u.setSelection(new E(u.doc.resolve(n+i.positionAt(a,l,s)),u.doc.resolve(n+i.positionAt(d-1,c-1,s)))),e(u)}var cd=gl({ArrowLeft:mn("horiz",-1),ArrowRight:mn("horiz",1),ArrowUp:mn("vert",-1),ArrowDown:mn("vert",1),"Shift-ArrowLeft":gn("horiz",-1),"Shift-ArrowRight":gn("horiz",1),"Shift-ArrowUp":gn("vert",-1),"Shift-ArrowDown":gn("vert",1),Backspace:fn,"Mod-Backspace":fn,Delete:fn,"Mod-Delete":fn});function Kn(t,e,n){return n.eq(t.selection)?!1:(e&&e(t.tr.setSelection(n).scrollIntoView()),!0)}function mn(t,e){return(n,r,o)=>{if(!o)return!1;const s=n.selection;if(s instanceof E)return Kn(n,r,q.near(s.$headCell,e));if(t!="horiz"&&!s.empty)return!1;const i=oa(o,t,e);if(i==null)return!1;if(t=="horiz")return Kn(n,r,q.near(n.doc.resolve(s.head+e),e));{const a=n.doc.resolve(i),l=Zi(a,t,e);let c;return l?c=q.near(l,1):e<0?c=q.near(n.doc.resolve(a.before(-1)),-1):c=q.near(n.doc.resolve(a.after(-1)),1),Kn(n,r,c)}}}function gn(t,e){return(n,r,o)=>{if(!o)return!1;const s=n.selection;let i;if(s instanceof E)i=s;else{const l=oa(o,t,e);if(l==null)return!1;i=new E(n.doc.resolve(l))}const a=Zi(i.$headCell,t,e);return a?Kn(n,r,new E(i.$anchorCell,a)):!1}}function ud(t,e){const n=t.state.doc,r=an(n.resolve(e));return r?(t.dispatch(t.state.tr.setSelection(new E(r))),!0):!1}function dd(t,e,n){if(!te(t.state))return!1;let r=sd(n);const o=t.state.selection;if(o instanceof E){r||(r={width:1,height:1,rows:[de.from(qr(Z(t.state.schema).cell,n))]});const s=o.$anchorCell.node(-1),i=o.$anchorCell.start(-1),a=$.get(s).rectBetween(o.$anchorCell.pos-i,o.$headCell.pos-i);return r=ad(r,a.right-a.left,a.bottom-a.top),zs(t.state,t.dispatch,i,a,r),!0}else if(r){const s=tr(t.state),i=s.start(-1);return zs(t.state,t.dispatch,i,$.get(s.node(-1)).findCell(s.pos-i),r),!0}else return!1}function pd(t,e){var n;if(e.ctrlKey||e.metaKey)return;const r=Ws(t,e.target);let o;if(e.shiftKey&&t.state.selection instanceof E)s(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&r&&(o=an(t.state.selection.$anchor))!=null&&((n=Nr(t,e))==null?void 0:n.pos)!=o.pos)s(o,e),e.preventDefault();else if(!r)return;function s(l,c){let d=Nr(t,c);const u=ve.getState(t.state)==null;if(!d||!Zo(l,d))if(u)d=l;else return;const p=new E(l,d);if(u||!t.state.selection.eq(p)){const f=t.state.tr.setSelection(p);u&&f.setMeta(ve,l.pos),t.dispatch(f)}}function i(){t.root.removeEventListener("mouseup",i),t.root.removeEventListener("dragstart",i),t.root.removeEventListener("mousemove",a),ve.getState(t.state)!=null&&t.dispatch(t.state.tr.setMeta(ve,-1))}function a(l){const c=l,d=ve.getState(t.state);let u;if(d!=null)u=t.state.doc.resolve(d);else if(Ws(t,c.target)!=r&&(u=Nr(t,e),!u))return i();u&&s(u,c)}t.root.addEventListener("mouseup",i),t.root.addEventListener("dragstart",i),t.root.addEventListener("mousemove",a)}function oa(t,e,n){if(!(t.state.selection instanceof G))return null;const{$head:r}=t.state.selection;for(let o=r.depth-1;o>=0;o--){const s=r.node(o);if((n<0?r.index(o):r.indexAfter(o))!=(n<0?0:s.childCount))return null;if(s.type.spec.tableRole=="cell"||s.type.spec.tableRole=="header_cell"){const a=r.before(o),l=e=="vert"?n>0?"down":"up":n>0?"right":"left";return t.endOfTextblock(l)?a:null}}return null}function Ws(t,e){for(;e&&e!=t.dom;e=e.parentNode)if(e.nodeName=="TD"||e.nodeName=="TH")return e;return null}function Nr(t,e){const n=t.posAtCoords({left:e.clientX,top:e.clientY});return n&&n?an(t.state.doc.resolve(n.pos)):null}var hd=class{constructor(t,e){this.node=t,this.defaultCellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.table.style.setProperty("--default-cell-min-width",`${e}px`),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Ur(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type!=this.node.type?!1:(this.node=t,Ur(t,this.colgroup,this.table,this.defaultCellMinWidth),!0)}ignoreMutation(t){return t.type=="attributes"&&(t.target==this.table||this.colgroup.contains(t.target))}};function Ur(t,e,n,r,o,s){var i;let a=0,l=!0,c=e.firstChild;const d=t.firstChild;if(d){for(let u=0,p=0;u<d.childCount;u++){const{colspan:f,colwidth:h}=d.child(u).attrs;for(let g=0;g<f;g++,p++){const b=o==p?s:h&&h[g],k=b?b+"px":"";if(a+=b||r,b||(l=!1),c)c.style.width!=k&&(c.style.width=k),c=c.nextSibling;else{const v=document.createElement("col");v.style.width=k,e.appendChild(v)}}}for(;c;){const u=c.nextSibling;(i=c.parentNode)==null||i.removeChild(c),c=u}l?(n.style.width=a+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=a+"px")}}var U=new F("tableColumnResizing");function fd({handleWidth:t=5,cellMinWidth:e=25,defaultCellMinWidth:n=100,View:r=hd,lastColumnResizable:o=!0}={}){const s=new z({key:U,state:{init(i,a){var l,c;const d=(c=(l=s.spec)==null?void 0:l.props)==null?void 0:c.nodeViews,u=Z(a.schema).table.name;return r&&d&&(d[u]=(p,f)=>new r(p,n,f)),new md(-1,!1)},apply(i,a){return a.apply(i)}},props:{attributes:i=>{const a=U.getState(i);return a&&a.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(i,a)=>{gd(i,a,t,o)},mouseleave:i=>{yd(i)},mousedown:(i,a)=>{wd(i,a,e,n)}},decorations:i=>{const a=U.getState(i);if(a&&a.activeHandle>-1)return Md(i,a.activeHandle)},nodeViews:{}}});return s}var md=class Vn{constructor(e,n){this.activeHandle=e,this.dragging=n}apply(e){const n=this,r=e.getMeta(U);if(r&&r.setHandle!=null)return new Vn(r.setHandle,!1);if(r&&r.setDragging!==void 0)return new Vn(n.activeHandle,r.setDragging);if(n.activeHandle>-1&&e.docChanged){let o=e.mapping.map(n.activeHandle,-1);return Vr(e.doc.resolve(o))||(o=-1),new Vn(o,n.dragging)}return n}};function gd(t,e,n,r){if(!t.editable)return;const o=U.getState(t.state);if(o&&!o.dragging){const s=bd(e.target);let i=-1;if(s){const{left:a,right:l}=s.getBoundingClientRect();e.clientX-a<=n?i=js(t,e,"left",n):l-e.clientX<=n&&(i=js(t,e,"right",n))}if(i!=o.activeHandle){if(!r&&i!==-1){const a=t.state.doc.resolve(i),l=a.node(-1),c=$.get(l),d=a.start(-1);if(c.colCount(a.pos-d)+a.nodeAfter.attrs.colspan-1==c.width-1)return}sa(t,i)}}}function yd(t){if(!t.editable)return;const e=U.getState(t.state);e&&e.activeHandle>-1&&!e.dragging&&sa(t,-1)}function wd(t,e,n,r){var o;if(!t.editable)return!1;const s=(o=t.dom.ownerDocument.defaultView)!=null?o:window,i=U.getState(t.state);if(!i||i.activeHandle==-1||i.dragging)return!1;const a=t.state.doc.nodeAt(i.activeHandle),l=kd(t,i.activeHandle,a.attrs);t.dispatch(t.state.tr.setMeta(U,{setDragging:{startX:e.clientX,startWidth:l}}));function c(u){s.removeEventListener("mouseup",c),s.removeEventListener("mousemove",d);const p=U.getState(t.state);p!=null&&p.dragging&&(Cd(t,p.activeHandle,Hs(p.dragging,u,n)),t.dispatch(t.state.tr.setMeta(U,{setDragging:null})))}function d(u){if(!u.which)return c(u);const p=U.getState(t.state);if(p&&p.dragging){const f=Hs(p.dragging,u,n);Bs(t,p.activeHandle,f,r)}}return Bs(t,i.activeHandle,l,r),s.addEventListener("mouseup",c),s.addEventListener("mousemove",d),e.preventDefault(),!0}function kd(t,e,{colspan:n,colwidth:r}){const o=r&&r[r.length-1];if(o)return o;const s=t.domAtPos(e);let a=s.node.childNodes[s.offset].offsetWidth,l=n;if(r)for(let c=0;c<n;c++)r[c]&&(a-=r[c],l--);return a/l}function bd(t){for(;t&&t.nodeName!="TD"&&t.nodeName!="TH";)t=t.classList&&t.classList.contains("ProseMirror")?null:t.parentNode;return t}function js(t,e,n,r){const o=n=="right"?-r:r,s=t.posAtCoords({left:e.clientX+o,top:e.clientY});if(!s)return-1;const{pos:i}=s,a=an(t.state.doc.resolve(i));if(!a)return-1;if(n=="right")return a.pos;const l=$.get(a.node(-1)),c=a.start(-1),d=l.map.indexOf(a.pos-c);return d%l.width==0?-1:c+l.map[d-1]}function Hs(t,e,n){const r=e.clientX-t.startX;return Math.max(n,t.startWidth+r)}function sa(t,e){t.dispatch(t.state.tr.setMeta(U,{setHandle:e}))}function Cd(t,e,n){const r=t.state.doc.resolve(e),o=r.node(-1),s=$.get(o),i=r.start(-1),a=s.colCount(r.pos-i)+r.nodeAfter.attrs.colspan-1,l=t.state.tr;for(let c=0;c<s.height;c++){const d=c*s.width+a;if(c&&s.map[d]==s.map[d-s.width])continue;const u=s.map[d],p=o.nodeAt(u).attrs,f=p.colspan==1?0:a-s.colCount(u);if(p.colwidth&&p.colwidth[f]==n)continue;const h=p.colwidth?p.colwidth.slice():xd(p.colspan);h[f]=n,l.setNodeMarkup(i+u,null,{...p,colwidth:h})}l.docChanged&&t.dispatch(l)}function Bs(t,e,n,r){const o=t.state.doc.resolve(e),s=o.node(-1),i=o.start(-1),a=$.get(s).colCount(o.pos-i)+o.nodeAfter.attrs.colspan-1;let l=t.domAtPos(o.start(-1)).node;for(;l&&l.nodeName!="TABLE";)l=l.parentNode;l&&Ur(s,l.firstChild,l,r,a,n)}function xd(t){return Array(t).fill(0)}function Md(t,e){var n;const r=[],o=t.doc.resolve(e),s=o.node(-1);if(!s)return ct.empty;const i=$.get(s),a=o.start(-1),l=i.colCount(o.pos-a)+o.nodeAfter.attrs.colspan-1;for(let c=0;c<i.height;c++){const d=l+c*i.width;if((l==i.width-1||i.map[d]!=i.map[d+1])&&(c==0||i.map[d]!=i.map[d-i.width])){const u=i.map[d],p=a+u+s.nodeAt(u).nodeSize-1,f=document.createElement("div");f.className="column-resize-handle",(n=U.getState(t))!=null&&n.dragging&&r.push(lt.node(a+u,a+u+s.nodeAt(u).nodeSize,{class:"column-resize-dragging"})),r.push(lt.widget(p,f))}}return ct.create(t.doc,r)}function Nd({allowTableNodeSelection:t=!1}={}){return new z({key:ve,state:{init(){return null},apply(e,n){const r=e.getMeta(ve);if(r!=null)return r==-1?null:r;if(n==null||!e.docChanged)return n;const{deleted:o,pos:s}=e.mapping.mapResult(n);return o?null:s}},props:{decorations:Hu,handleDOMEvents:{mousedown:pd},createSelectionBetween(e){return ve.getState(e.state)!=null?e.state.selection:null},handleTripleClick:ud,handleKeyDown:cd,handlePaste:dd},appendTransaction(e,n,r){return Vu(r,Uu(r,n),t)}})}var Jn=typeof navigator<"u"?navigator:null,ts=Jn&&Jn.userAgent||"",Sd=/Edge\/(\d+)/.exec(ts),Ad=/MSIE \d/.exec(ts),$d=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ts),vd=!!(Ad||$d||Sd),Id=!vd&&!!Jn&&/Apple Computer/.test(Jn.vendor),ia=new F("safari-ime-span"),Gr=!1,Td={key:ia,props:{decorations:Ed,handleDOMEvents:{compositionstart:()=>{Gr=!0},compositionend:()=>{Gr=!1}}}};function Ed(t){const{$from:e,$to:n,to:r}=t.selection;if(Gr&&e.sameParent(n)){const o=lt.widget(r,Rd,{ignoreSelection:!0,key:"safari-ime-span"});return ct.create(t.doc,[o])}}function Rd(t){const e=t.dom.ownerDocument.createElement("span");return e.className="ProseMirror-safari-ime-span",e}var _d=new z(Id?Td:{key:ia});function Ld(t,e,n){const o=Al((n||{}).ignore||[]),s=Dd(e);let i=-1;for(;++i<s.length;)$l(t,"text",a);function a(c,d){let u=-1,p;for(;++u<d.length;){const f=d[u],h=p?p.children:void 0;if(o(f,h?h.indexOf(f):void 0,p))return;p=f}if(p)return l(c,d)}function l(c,d){const u=d[d.length-1],p=s[i][0],f=s[i][1];let h=0;const b=u.children.indexOf(c);let k=!1,v=[];p.lastIndex=0;let I=p.exec(c.value);for(;I;){const W=I.index,X={index:I.index,input:I.input,stack:[...d,c]};let P=f(...I,X);if(typeof P=="string"&&(P=P.length>0?{type:"text",value:P}:void 0),P===!1?p.lastIndex=W+1:(h!==W&&v.push({type:"text",value:c.value.slice(h,W)}),Array.isArray(P)?v.push(...P):P&&v.push(P),h=W+I[0].length,k=!0),!p.global)break;I=p.exec(c.value)}return k?(h<c.value.length&&v.push({type:"text",value:c.value.slice(h)}),u.children.splice(b,1,...v)):v=[c],b+v.length}}function Dd(t){const e=[];if(!Array.isArray(t))throw new TypeError("Expected find and replace tuple or list of tuples");const n=!t[0]||Array.isArray(t[0])?t:[t];let r=-1;for(;++r<n.length;){const o=n[r];e.push([Od(o[0]),Pd(o[1])])}return e}function Od(t){return typeof t=="string"?new RegExp(Hl(t),"g"):t}function Pd(t){return typeof t=="function"?t:function(){return t}}const Sr="phrasing",Ar=["autolink","link","image","label"];function Fd(){return{transforms:[Vd],enter:{literalAutolink:Wd,literalAutolinkEmail:$r,literalAutolinkHttp:$r,literalAutolinkWww:$r},exit:{literalAutolink:Kd,literalAutolinkEmail:Bd,literalAutolinkHttp:jd,literalAutolinkWww:Hd}}}function zd(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:Sr,notInConstruct:Ar},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:Sr,notInConstruct:Ar},{character:":",before:"[ps]",after:"\\/",inConstruct:Sr,notInConstruct:Ar}]}}function Wd(t){this.enter({type:"link",title:null,url:"",children:[]},t)}function $r(t){this.config.enter.autolinkProtocol.call(this,t)}function jd(t){this.config.exit.autolinkProtocol.call(this,t)}function Hd(t){this.config.exit.data.call(this,t);const e=this.stack[this.stack.length-1];Qr(e.type==="link"),e.url="http://"+this.sliceSerialize(t)}function Bd(t){this.config.exit.autolinkEmail.call(this,t)}function Kd(t){this.exit(t)}function Vd(t){Ld(t,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,qd],[new RegExp("(?<=^|\\s|\\p{P}|\\p{S})([-.\\w+]+)@([-\\w]+(?:\\.[-\\w]+)+)","gu"),Ud]],{ignore:["link","linkReference"]})}function qd(t,e,n,r,o){let s="";if(!aa(o)||(/^w/i.test(e)&&(n=e+n,e="",s="http://"),!Gd(n)))return!1;const i=Jd(n+r);if(!i[0])return!1;const a={type:"link",title:null,url:s+e+i[0],children:[{type:"text",value:e+i[0]}]};return i[1]?[a,{type:"text",value:i[1]}]:a}function Ud(t,e,n,r){return!aa(r,!0)||/[-\d_]$/.test(n)?!1:{type:"link",title:null,url:"mailto:"+e+"@"+n,children:[{type:"text",value:e+"@"+n}]}}function Gd(t){const e=t.split(".");return!(e.length<2||e[e.length-1]&&(/_/.test(e[e.length-1])||!/[a-zA-Z\d]/.test(e[e.length-1]))||e[e.length-2]&&(/_/.test(e[e.length-2])||!/[a-zA-Z\d]/.test(e[e.length-2])))}function Jd(t){const e=/[!"&'),.:;<>?\]}]+$/.exec(t);if(!e)return[t,void 0];t=t.slice(0,e.index);let n=e[0],r=n.indexOf(")");const o=bs(t,"(");let s=bs(t,")");for(;r!==-1&&o>s;)t+=n.slice(0,r+1),n=n.slice(r+1),r=n.indexOf(")"),s++;return[t,n]}function aa(t,e){const n=t.input.charCodeAt(t.index-1);return(t.index===0||ut(n)||Zr(n))&&(!e||n!==47)}la.peek=ip;function Xd(){return{enter:{gfmFootnoteDefinition:Qd,gfmFootnoteDefinitionLabelString:Zd,gfmFootnoteCall:np,gfmFootnoteCallString:rp},exit:{gfmFootnoteDefinition:tp,gfmFootnoteDefinitionLabelString:ep,gfmFootnoteCall:sp,gfmFootnoteCallString:op}}}function Yd(){return{unsafe:[{character:"[",inConstruct:["phrasing","label","reference"]}],handlers:{footnoteDefinition:ap,footnoteReference:la}}}function Qd(t){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},t)}function Zd(){this.buffer()}function ep(t){const e=this.resume(),n=this.stack[this.stack.length-1];Qr(n.type==="footnoteDefinition"),n.label=e,n.identifier=Yt(this.sliceSerialize(t)).toLowerCase()}function tp(t){this.exit(t)}function np(t){this.enter({type:"footnoteReference",identifier:"",label:""},t)}function rp(){this.buffer()}function op(t){const e=this.resume(),n=this.stack[this.stack.length-1];Qr(n.type==="footnoteReference"),n.label=e,n.identifier=Yt(this.sliceSerialize(t)).toLowerCase()}function sp(t){this.exit(t)}function la(t,e,n,r){const o=n.createTracker(r);let s=o.move("[^");const i=n.enter("footnoteReference"),a=n.enter("reference");return s+=o.move(n.safe(n.associationId(t),{...o.current(),before:s,after:"]"})),a(),i(),s+=o.move("]"),s}function ip(){return"["}function ap(t,e,n,r){const o=n.createTracker(r);let s=o.move("[^");const i=n.enter("footnoteDefinition"),a=n.enter("label");return s+=o.move(n.safe(n.associationId(t),{...o.current(),before:s,after:"]"})),a(),s+=o.move("]:"+(t.children&&t.children.length>0?" ":"")),o.shift(4),s+=o.move(n.indentLines(n.containerFlow(t,o.current()),lp)),i(),s}function lp(t,e,n){return e===0?t:(n?"":"    ")+t}function cp(){return[Fd(),Xd(),vl(),Il(),Tl()]}function up(t){return{extensions:[zd(),Yd(),El(),Rl(t),_l()]}}const dp={tokenize:yp,partial:!0},ca={tokenize:wp,partial:!0},ua={tokenize:kp,partial:!0},da={tokenize:bp,partial:!0},pp={tokenize:Cp,partial:!0},pa={name:"wwwAutolink",tokenize:mp,previous:fa},ha={name:"protocolAutolink",tokenize:gp,previous:ma},be={name:"emailAutolink",tokenize:fp,previous:ga},ge={};function hp(){return{text:ge}}let Pe=48;for(;Pe<123;)ge[Pe]=be,Pe++,Pe===58?Pe=65:Pe===91&&(Pe=97);ge[43]=be;ge[45]=be;ge[46]=be;ge[95]=be;ge[72]=[be,ha];ge[104]=[be,ha];ge[87]=[be,pa];ge[119]=[be,pa];function fp(t,e,n){const r=this;let o,s;return i;function i(u){return!Jr(u)||!ga.call(r,r.previous)||ns(r.events)?n(u):(t.enter("literalAutolink"),t.enter("literalAutolinkEmail"),a(u))}function a(u){return Jr(u)?(t.consume(u),a):u===64?(t.consume(u),l):n(u)}function l(u){return u===46?t.check(pp,d,c)(u):u===45||u===95||eo(u)?(s=!0,t.consume(u),l):d(u)}function c(u){return t.consume(u),o=!0,l}function d(u){return s&&o&&Vt(r.previous)?(t.exit("literalAutolinkEmail"),t.exit("literalAutolink"),e(u)):n(u)}}function mp(t,e,n){const r=this;return o;function o(i){return i!==87&&i!==119||!fa.call(r,r.previous)||ns(r.events)?n(i):(t.enter("literalAutolink"),t.enter("literalAutolinkWww"),t.check(dp,t.attempt(ca,t.attempt(ua,s),n),n)(i))}function s(i){return t.exit("literalAutolinkWww"),t.exit("literalAutolink"),e(i)}}function gp(t,e,n){const r=this;let o="",s=!1;return i;function i(u){return(u===72||u===104)&&ma.call(r,r.previous)&&!ns(r.events)?(t.enter("literalAutolink"),t.enter("literalAutolinkHttp"),o+=String.fromCodePoint(u),t.consume(u),a):n(u)}function a(u){if(Vt(u)&&o.length<5)return o+=String.fromCodePoint(u),t.consume(u),a;if(u===58){const p=o.toLowerCase();if(p==="http"||p==="https")return t.consume(u),l}return n(u)}function l(u){return u===47?(t.consume(u),s?c:(s=!0,l)):n(u)}function c(u){return u===null||Ll(u)||pe(u)||ut(u)||Zr(u)?n(u):t.attempt(ca,t.attempt(ua,d),n)(u)}function d(u){return t.exit("literalAutolinkHttp"),t.exit("literalAutolink"),e(u)}}function yp(t,e,n){let r=0;return o;function o(i){return(i===87||i===119)&&r<3?(r++,t.consume(i),o):i===46&&r===3?(t.consume(i),s):n(i)}function s(i){return i===null?n(i):e(i)}}function wp(t,e,n){let r,o,s;return i;function i(c){return c===46||c===95?t.check(da,l,a)(c):c===null||pe(c)||ut(c)||c!==45&&Zr(c)?l(c):(s=!0,t.consume(c),i)}function a(c){return c===95?r=!0:(o=r,r=void 0),t.consume(c),i}function l(c){return o||r||!s?n(c):e(c)}}function kp(t,e){let n=0,r=0;return o;function o(i){return i===40?(n++,t.consume(i),o):i===41&&r<n?s(i):i===33||i===34||i===38||i===39||i===41||i===42||i===44||i===46||i===58||i===59||i===60||i===63||i===93||i===95||i===126?t.check(da,e,s)(i):i===null||pe(i)||ut(i)?e(i):(t.consume(i),o)}function s(i){return i===41&&r++,t.consume(i),o}}function bp(t,e,n){return r;function r(a){return a===33||a===34||a===39||a===41||a===42||a===44||a===46||a===58||a===59||a===63||a===95||a===126?(t.consume(a),r):a===38?(t.consume(a),s):a===93?(t.consume(a),o):a===60||a===null||pe(a)||ut(a)?e(a):n(a)}function o(a){return a===null||a===40||a===91||pe(a)||ut(a)?e(a):r(a)}function s(a){return Vt(a)?i(a):n(a)}function i(a){return a===59?(t.consume(a),r):Vt(a)?(t.consume(a),i):n(a)}}function Cp(t,e,n){return r;function r(s){return t.consume(s),o}function o(s){return eo(s)?n(s):e(s)}}function fa(t){return t===null||t===40||t===42||t===95||t===91||t===93||t===126||pe(t)}function ma(t){return!Vt(t)}function ga(t){return!(t===47||Jr(t))}function Jr(t){return t===43||t===45||t===46||t===95||eo(t)}function ns(t){let e=t.length,n=!1;for(;e--;){const r=t[e][1];if((r.type==="labelLink"||r.type==="labelImage")&&!r._balanced){n=!0;break}if(r._gfmAutolinkLiteralWalkedInto){n=!1;break}}return t.length>0&&!n&&(t[t.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),n}const xp={tokenize:Tp,partial:!0};function Mp(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:$p,continuation:{tokenize:vp},exit:Ip}},text:{91:{name:"gfmFootnoteCall",tokenize:Ap},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:Np,resolveTo:Sp}}}}function Np(t,e,n){const r=this;let o=r.events.length;const s=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let i;for(;o--;){const l=r.events[o][1];if(l.type==="labelImage"){i=l;break}if(l.type==="gfmFootnoteCall"||l.type==="labelLink"||l.type==="label"||l.type==="image"||l.type==="link")break}return a;function a(l){if(!i||!i._balanced)return n(l);const c=Yt(r.sliceSerialize({start:i.end,end:r.now()}));return c.codePointAt(0)!==94||!s.includes(c.slice(1))?n(l):(t.enter("gfmFootnoteCallLabelMarker"),t.consume(l),t.exit("gfmFootnoteCallLabelMarker"),e(l))}}function Sp(t,e){let n=t.length;for(;n--;)if(t[n][1].type==="labelImage"&&t[n][0]==="enter"){t[n][1];break}t[n+1][1].type="data",t[n+3][1].type="gfmFootnoteCallLabelMarker";const r={type:"gfmFootnoteCall",start:Object.assign({},t[n+3][1].start),end:Object.assign({},t[t.length-1][1].end)},o={type:"gfmFootnoteCallMarker",start:Object.assign({},t[n+3][1].end),end:Object.assign({},t[n+3][1].end)};o.end.column++,o.end.offset++,o.end._bufferIndex++;const s={type:"gfmFootnoteCallString",start:Object.assign({},o.end),end:Object.assign({},t[t.length-1][1].start)},i={type:"chunkString",contentType:"string",start:Object.assign({},s.start),end:Object.assign({},s.end)},a=[t[n+1],t[n+2],["enter",r,e],t[n+3],t[n+4],["enter",o,e],["exit",o,e],["enter",s,e],["enter",i,e],["exit",i,e],["exit",s,e],t[t.length-2],t[t.length-1],["exit",r,e]];return t.splice(n,t.length-n+1,...a),t}function Ap(t,e,n){const r=this,o=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let s=0,i;return a;function a(u){return t.enter("gfmFootnoteCall"),t.enter("gfmFootnoteCallLabelMarker"),t.consume(u),t.exit("gfmFootnoteCallLabelMarker"),l}function l(u){return u!==94?n(u):(t.enter("gfmFootnoteCallMarker"),t.consume(u),t.exit("gfmFootnoteCallMarker"),t.enter("gfmFootnoteCallString"),t.enter("chunkString").contentType="string",c)}function c(u){if(s>999||u===93&&!i||u===null||u===91||pe(u))return n(u);if(u===93){t.exit("chunkString");const p=t.exit("gfmFootnoteCallString");return o.includes(Yt(r.sliceSerialize(p)))?(t.enter("gfmFootnoteCallLabelMarker"),t.consume(u),t.exit("gfmFootnoteCallLabelMarker"),t.exit("gfmFootnoteCall"),e):n(u)}return pe(u)||(i=!0),s++,t.consume(u),u===92?d:c}function d(u){return u===91||u===92||u===93?(t.consume(u),s++,c):c(u)}}function $p(t,e,n){const r=this,o=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let s,i=0,a;return l;function l(h){return t.enter("gfmFootnoteDefinition")._container=!0,t.enter("gfmFootnoteDefinitionLabel"),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(h),t.exit("gfmFootnoteDefinitionLabelMarker"),c}function c(h){return h===94?(t.enter("gfmFootnoteDefinitionMarker"),t.consume(h),t.exit("gfmFootnoteDefinitionMarker"),t.enter("gfmFootnoteDefinitionLabelString"),t.enter("chunkString").contentType="string",d):n(h)}function d(h){if(i>999||h===93&&!a||h===null||h===91||pe(h))return n(h);if(h===93){t.exit("chunkString");const g=t.exit("gfmFootnoteDefinitionLabelString");return s=Yt(r.sliceSerialize(g)),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(h),t.exit("gfmFootnoteDefinitionLabelMarker"),t.exit("gfmFootnoteDefinitionLabel"),p}return pe(h)||(a=!0),i++,t.consume(h),h===92?u:d}function u(h){return h===91||h===92||h===93?(t.consume(h),i++,d):d(h)}function p(h){return h===58?(t.enter("definitionMarker"),t.consume(h),t.exit("definitionMarker"),o.includes(s)||o.push(s),Qs(t,f,"gfmFootnoteDefinitionWhitespace")):n(h)}function f(h){return e(h)}}function vp(t,e,n){return t.check(Dl,e,t.attempt(xp,e,n))}function Ip(t){t.exit("gfmFootnoteDefinition")}function Tp(t,e,n){const r=this;return Qs(t,o,"gfmFootnoteDefinitionIndent",5);function o(s){const i=r.events[r.events.length-1];return i&&i[1].type==="gfmFootnoteDefinitionIndent"&&i[2].sliceSerialize(i[1],!0).length===4?e(s):n(s)}}function Ep(t){return Ol([hp(),Mp(),Pl(t),Fl(),zl()])}const Rp={};function _p(t){const e=this,n=t||Rp,r=e.data(),o=r.micromarkExtensions||(r.micromarkExtensions=[]),s=r.fromMarkdownExtensions||(r.fromMarkdownExtensions=[]),i=r.toMarkdownExtensions||(r.toMarkdownExtensions=[]);o.push(Ep(n)),s.push(cp()),i.push(up(n))}function C(t,e){return Object.assign(t,{meta:{package:"@milkdown/preset-gfm",...e}}),t}const rs=tn("strike_through");C(rs,{displayName:"Attr<strikethrough>",group:"Strikethrough"});const ln=en("strike_through",t=>({parseDOM:[{tag:"del"},{style:"text-decoration",getAttrs:e=>e==="line-through"}],toDOM:e=>["del",t.get(rs.key)(e)],parseMarkdown:{match:e=>e.type==="delete",runner:(e,n,r)=>{e.openMark(r),e.next(n.children),e.closeMark(r)}},toMarkdown:{match:e=>e.type.name==="strike_through",runner:(e,n)=>{e.withMark(n,"delete")}}}));C(ln.mark,{displayName:"MarkSchema<strikethrough>",group:"Strikethrough"});C(ln.ctx,{displayName:"MarkSchemaCtx<strikethrough>",group:"Strikethrough"});const os=x("ToggleStrikeThrough",t=>()=>Yn(ln.type(t)));C(os,{displayName:"Command<ToggleStrikethrough>",group:"Strikethrough"});const ya=B(t=>Zt(/~([^~]+)~$/,ln.type(t)));C(ya,{displayName:"InputRule<strikethrough>",group:"Strikethrough"});const ss=K("strikeThroughKeymap",{ToggleStrikethrough:{shortcuts:"Mod-Alt-x",command:t=>{const e=t.get(A);return()=>e.call(os.key)}}});C(ss.ctx,{displayName:"KeymapCtx<strikethrough>",group:"Strikethrough"});C(ss.shortcuts,{displayName:"Keymap<strikethrough>",group:"Strikethrough"});const cn=Ou({tableGroup:"block",cellContent:"paragraph",cellAttributes:{alignment:{default:"left",getFromDOM:t=>t.style.textAlign||"left",setDOMAttr:(t,e)=>{e.style=`text-align: ${t||"left"}`}}}}),yt=D("table",()=>({...cn.table,content:"table_header_row table_row+",disableDropCursor:!0,parseMarkdown:{match:t=>t.type==="table",runner:(t,e,n)=>{const r=e.align,o=e.children.map((s,i)=>({...s,align:r,isHeader:i===0}));t.openNode(n),t.next(o),t.closeNode()}},toMarkdown:{match:t=>t.type.name==="table",runner:(t,e)=>{var n;const r=(n=e.content.firstChild)==null?void 0:n.content;if(!r)return;const o=[];r.forEach(s=>{o.push(s.attrs.alignment)}),t.openNode("table",void 0,{align:o}),t.next(e.content),t.closeNode()}}}));C(yt.node,{displayName:"NodeSchema<table>",group:"Table"});C(yt.ctx,{displayName:"NodeSchemaCtx<table>",group:"Table"});const nr=D("table_header_row",()=>({...cn.table_row,disableDropCursor:!0,content:"(table_header)*",parseDOM:[{tag:"tr[data-is-header]"}],toDOM(){return["tr",{"data-is-header":!0},0]},parseMarkdown:{match:t=>!!(t.type==="tableRow"&&t.isHeader),runner:(t,e,n)=>{const r=e.align,o=e.children.map((s,i)=>({...s,align:r[i],isHeader:e.isHeader}));t.openNode(n),t.next(o),t.closeNode()}},toMarkdown:{match:t=>t.type.name==="table_header_row",runner:(t,e)=>{t.openNode("tableRow",void 0,{isHeader:!0}),t.next(e.content),t.closeNode()}}}));C(nr.node,{displayName:"NodeSchema<tableHeaderRow>",group:"Table"});C(nr.ctx,{displayName:"NodeSchemaCtx<tableHeaderRow>",group:"Table"});const un=D("table_row",()=>({...cn.table_row,disableDropCursor:!0,content:"(table_cell)*",parseMarkdown:{match:t=>t.type==="tableRow",runner:(t,e,n)=>{const r=e.align,o=e.children.map((s,i)=>({...s,align:r[i]}));t.openNode(n),t.next(o),t.closeNode()}},toMarkdown:{match:t=>t.type.name==="table_row",runner:(t,e)=>{t.openNode("tableRow"),t.next(e.content),t.closeNode()}}}));C(un.node,{displayName:"NodeSchema<tableRow>",group:"Table"});C(un.ctx,{displayName:"NodeSchemaCtx<tableRow>",group:"Table"});const dn=D("table_cell",()=>({...cn.table_cell,disableDropCursor:!0,parseMarkdown:{match:t=>t.type==="tableCell"&&!t.isHeader,runner:(t,e,n)=>{const r=e.align;t.openNode(n,{alignment:r}).openNode(t.schema.nodes.paragraph).next(e.children).closeNode().closeNode()}},toMarkdown:{match:t=>t.type.name==="table_cell",runner:(t,e)=>{t.openNode("tableCell").next(e.content).closeNode()}}}));C(dn.node,{displayName:"NodeSchema<tableCell>",group:"Table"});C(dn.ctx,{displayName:"NodeSchemaCtx<tableCell>",group:"Table"});const rr=D("table_header",()=>({...cn.table_header,disableDropCursor:!0,parseMarkdown:{match:t=>t.type==="tableCell"&&!!t.isHeader,runner:(t,e,n)=>{const r=e.align;t.openNode(n,{alignment:r}),t.openNode(t.schema.nodes.paragraph),t.next(e.children),t.closeNode(),t.closeNode()}},toMarkdown:{match:t=>t.type.name==="table_header",runner:(t,e)=>{t.openNode("tableCell"),t.next(e.content),t.closeNode()}}}));C(rr.node,{displayName:"NodeSchema<tableHeader>",group:"Table"});C(rr.ctx,{displayName:"NodeSchemaCtx<tableHeader>",group:"Table"});function wa(t,e=3,n=3){const r=Array(n).fill(0).map(()=>dn.type(t).createAndFill()),o=Array(n).fill(0).map(()=>rr.type(t).createAndFill()),s=Array(e).fill(0).map((i,a)=>a===0?nr.type(t).create(null,o):un.type(t).create(null,r));return yt.type(t).create(null,s)}function pn(t){return oo(e=>e.type.spec.tableRole==="table")(t)}function tt(t,e){const n=pn(e.$from);if(!n)return;const r=$.get(n.node);if(!(t<0||t>=r.width))return r.cellsInRect({left:t,right:t+1,top:0,bottom:r.height}).map(o=>{const s=n.node.nodeAt(o);if(!s)return;const i=o+n.start;return{pos:i,start:i+1,node:s}}).filter(o=>o!=null)}function nt(t,e){const n=pn(e.$from);if(!n)return;const r=$.get(n.node);if(!(t<0||t>=r.height))return r.cellsInRect({left:0,right:r.width,top:t,bottom:t+1}).map(o=>{const s=n.node.nodeAt(o);if(!s)return;const i=o+n.start;return{pos:i,start:i+1,node:s}}).filter(o=>o!=null)}function Lp(t){const e=pn(t.$from);if(!e)return;const n=$.get(e.node);return n.cellsInRect({left:0,right:n.width,top:0,bottom:n.height}).map(r=>{const o=e.node.nodeAt(r),s=r+e.start;return{pos:s,start:s+1,node:o}})}function Dp(t){const e=Lp(t.selection);if(e&&e[0]){const n=t.doc.resolve(e[0].pos),r=e[e.length-1];if(r){const o=t.doc.resolve(r.pos);return Zn(t.setSelection(new E(o,n)))}}return t}function ka(t,e,{map:n,tableStart:r,table:o},s){const i=Array(s).fill(0).reduce((l,c,d)=>l+o.child(d).nodeSize,r),a=Array(n.width).fill(0).map((l,c)=>{const d=o.nodeAt(n.map[c]);return dn.type(t).createAndFill({alignment:d==null?void 0:d.attrs.alignment})});return e.insert(i,un.type(t).create(null,a)),e}function ba(t){return(e,n)=>r=>{n=n??r.selection.from;const o=r.doc.resolve(n),s=oo(l=>l.type.name==="table")(o),i=s?{node:s.node,from:s.start}:void 0,a=t==="row";if(i){const l=$.get(i.node);if(e>=0&&e<(a?l.height:l.width)){const c=l.positionAt(a?e:l.height-1,a?l.width-1:e,i.node),d=r.doc.resolve(i.from+c),u=a?E.rowSelection:E.colSelection,p=l.positionAt(a?e:0,a?0:e,i.node),f=r.doc.resolve(i.from+p);return Zn(r.setSelection(u(d,f)))}}return r}}const Op=ba("row"),Pp=ba("col");function Ks(t){return t[0].map((e,n)=>t.map(r=>r[n]))}function Ca(t,e){const n=[],r=$.get(t);for(let o=0;o<r.height;o++){const s=t.child(o),i=[];for(let a=0;a<r.width;a++){if(!e[o][a])continue;const l=r.map[o*r.width+a],c=e[o][a],d=t.nodeAt(l).type.createChecked(Object.assign({},c.attrs),c.content,c.marks);i.push(d)}n.push(s.type.createChecked(s.attrs,i,s.marks))}return t.type.createChecked(t.attrs,n,t.marks)}function xa(t){const e=$.get(t),n=[];for(let r=0;r<e.height;r++){const o=[],s={};for(let i=0;i<e.width;i++){const a=e.map[r*e.width+i],l=t.nodeAt(a),c=e.findCell(a);if(s[a]||c.top!==r){o.push(null);continue}s[a]=!0,o.push(l)}n.push(o)}return n}function Ma(t,e,n,r){const o=e[0]>n[0]?-1:1,s=t.splice(e[0],e.length),i=s.length%2===0?1:0;let a;return a=o===-1?n[0]:n[n.length-1]-i,t.splice(a,0,...s),t}function Fp(t,e,n,r){let o=Ks(xa(t.node));return o=Ma(o,e,n),o=Ks(o),Ca(t.node,o)}function zp(t,e,n,r){let o=xa(t.node);return o=Ma(o,e,n),Ca(t.node,o)}function Vs(t,e){let n=t,r=t;for(let d=t;d>=0;d--){const u=tt(d,e.selection);u&&u.forEach(p=>{const f=p.node.attrs.colspan+d-1;f>=n&&(n=d),f>r&&(r=f)})}for(let d=t;d<=r;d++){const u=tt(d,e.selection);u&&u.forEach(p=>{const f=p.node.attrs.colspan+d-1;p.node.attrs.colspan>1&&f>r&&(r=f)})}const o=[];for(let d=n;d<=r;d++){const u=tt(d,e.selection);u&&u.length&&o.push(d)}n=o[0],r=o[o.length-1];const s=tt(n,e.selection),i=nt(0,e.selection),a=e.doc.resolve(s[s.length-1].pos);let l;for(let d=r;d>=n;d--){const u=tt(d,e.selection);if(u&&u.length){for(let p=i.length-1;p>=0;p--)if(i[p].pos===u[0].pos){l=u[0];break}if(l)break}}const c=e.doc.resolve(l.pos);return{$anchor:a,$head:c,indexes:o}}function qs(t,e){let n=t,r=t;for(let d=t;d>=0;d--)nt(d,e.selection).forEach(u=>{const p=u.node.attrs.rowspan+d-1;p>=n&&(n=d),p>r&&(r=p)});for(let d=t;d<=r;d++)nt(d,e.selection).forEach(u=>{const p=u.node.attrs.rowspan+d-1;u.node.attrs.rowspan>1&&p>r&&(r=p)});const o=[];for(let d=n;d<=r;d++){const u=nt(d,e.selection);u&&u.length&&o.push(d)}n=o[0],r=o[o.length-1];const s=nt(n,e.selection),i=tt(0,e.selection),a=e.doc.resolve(s[s.length-1].pos);let l;for(let d=r;d>=n;d--){const u=nt(d,e.selection);if(u&&u.length){for(let p=i.length-1;p>=0;p--)if(i[p].pos===u[0].pos){l=u[0];break}if(l)break}}const c=e.doc.resolve(l.pos);return{$anchor:a,$head:c,indexes:o}}function Wp(t){const{tr:e,origin:n,target:r,select:o=!0,pos:s}=t,i=s!=null?e.doc.resolve(s):e.selection.$from,a=pn(i);if(!a)return e;const{indexes:l}=Vs(n,e),{indexes:c}=Vs(r,e);if(l.includes(r))return e;const d=Fp(a,l,c),u=Zn(e).replaceWith(a.pos,a.pos+a.node.nodeSize,d);if(!o)return u;const p=$.get(d),f=a.start,h=r,g=p.positionAt(p.height-1,h,d),b=u.doc.resolve(f+g),k=E.colSelection,v=p.positionAt(0,h,d),I=u.doc.resolve(f+v);return u.setSelection(k(b,I))}function jp(t){const{tr:e,origin:n,target:r,select:o=!0,pos:s}=t,i=s!=null?e.doc.resolve(s):e.selection.$from,a=pn(i);if(!a)return e;const{indexes:l}=qs(n,e),{indexes:c}=qs(r,e);if(l.includes(r))return e;const d=zp(a,l,c),u=Zn(e).replaceWith(a.pos,a.pos+a.node.nodeSize,d);if(!o)return u;const p=$.get(d),f=a.start,h=r,g=p.positionAt(h,p.width-1,d),b=u.doc.resolve(f+g),k=E.rowSelection,v=p.positionAt(h,0,d),I=u.doc.resolve(f+v);return u.setSelection(k(b,I))}const is=x("GoToPrevTableCell",()=>()=>ra(-1));C(is,{displayName:"Command<goToPrevTableCellCommand>",group:"Table"});const as=x("GoToNextTableCell",()=>()=>ra(1));C(as,{displayName:"Command<goToNextTableCellCommand>",group:"Table"});const ls=x("ExitTable",t=>()=>(e,n)=>{if(!te(e))return!1;const{$head:r}=e.selection,o=Zc(r,yt.type(t));if(!o)return!1;const{to:s}=o,i=e.tr.replaceWith(s,s,De.type(t).createAndFill());return i.setSelection(q.near(i.doc.resolve(s),1)).scrollIntoView(),n==null||n(i),!0});C(ls,{displayName:"Command<breakTableCommand>",group:"Table"});const Na=x("InsertTable",t=>({row:e,col:n}={})=>(r,o)=>{const{selection:s,tr:i}=r,{from:a}=s,l=wa(t,e,n),c=i.replaceSelectionWith(l),d=q.findFrom(c.doc.resolve(a),1,!0);return d&&c.setSelection(d),o==null||o(c),!0});C(Na,{displayName:"Command<insertTableCommand>",group:"Table"});const Sa=x("MoveRow",()=>({from:t,to:e,pos:n}={})=>(r,o)=>{const{tr:s}=r;return!!(o!=null&&o(jp({tr:s,origin:t??0,target:e??0,pos:n,select:!0})))});C(Sa,{displayName:"Command<moveRowCommand>",group:"Table"});const Aa=x("MoveCol",()=>({from:t,to:e,pos:n}={})=>(r,o)=>{const{tr:s}=r;return!!(o!=null&&o(Wp({tr:s,origin:t??0,target:e??0,pos:n,select:!0})))});C(Aa,{displayName:"Command<moveColCommand>",group:"Table"});const $a=x("SelectRow",()=>(t={index:0})=>(e,n)=>{const{tr:r}=e;return!!(n!=null&&n(Op(t.index,t.pos)(r)))});C($a,{displayName:"Command<selectRowCommand>",group:"Table"});const va=x("SelectCol",()=>(t={index:0})=>(e,n)=>{const{tr:r}=e;return!!(n!=null&&n(Pp(t.index,t.pos)(r)))});C(va,{displayName:"Command<selectColCommand>",group:"Table"});const Ia=x("SelectTable",()=>()=>(t,e)=>{const{tr:n}=t;return!!(e!=null&&e(Dp(n)))});C(Ia,{displayName:"Command<selectTableCommand>",group:"Table"});const Ta=x("DeleteSelectedCells",()=>()=>(t,e)=>{const{selection:n}=t;if(!(n instanceof E))return!1;const r=n.isRowSelection(),o=n.isColSelection();return r&&o?od(t,e):o?Qu(t,e):ed(t,e)});C(Ta,{displayName:"Command<deleteSelectedCellsCommand>",group:"Table"});const Ea=x("AddColBefore",()=>()=>Ju);C(Ea,{displayName:"Command<addColBeforeCommand>",group:"Table"});const Ra=x("AddColAfter",()=>()=>Xu);C(Ra,{displayName:"Command<addColAfterCommand>",group:"Table"});const _a=x("AddRowBefore",t=>()=>(e,n)=>{if(!te(e))return!1;if(n){const r=Oe(e);n(ka(t,e.tr,r,r.top))}return!0});C(_a,{displayName:"Command<addRowBeforeCommand>",group:"Table"});const La=x("AddRowAfter",t=>()=>(e,n)=>{if(!te(e))return!1;if(n){const r=Oe(e);n(ka(t,e.tr,r,r.bottom))}return!0});C(La,{displayName:"Command<addRowAfterCommand>",group:"Table"});const Da=x("SetAlign",()=>(t="left")=>td("alignment",t));C(Da,{displayName:"Command<setAlignCommand>",group:"Table"});const Oa=B(t=>new H(/^\|(?<col>\d+)[xX](?<row>\d+)\|\s$/,(e,n,r,o)=>{var s,i;const a=e.doc.resolve(r);if(!a.node(-1).canReplaceWith(a.index(-1),a.indexAfter(-1),yt.type(t)))return null;const l=wa(t,Number((s=n.groups)==null?void 0:s.row),Number((i=n.groups)==null?void 0:i.col)),c=e.tr.replaceRangeWith(r,o,l);return c.setSelection(G.create(c.doc,r+3)).scrollIntoView()}));C(Oa,{displayName:"InputRule<insertTableInputRule>",group:"Table"});const cs=K("tableKeymap",{NextCell:{shortcuts:["Mod-]","Tab"],command:t=>{const e=t.get(A);return()=>e.call(as.key)}},PrevCell:{shortcuts:["Mod-[","Shift-Tab"],command:t=>{const e=t.get(A);return()=>e.call(is.key)}},ExitTable:{shortcuts:["Mod-Enter"],command:t=>{const e=t.get(A);return()=>e.call(ls.key)}}});C(cs.ctx,{displayName:"KeymapCtx<table>",group:"Table"});C(cs.shortcuts,{displayName:"Keymap<table>",group:"Table"});const vr="footnote_definition",Us="footnoteDefinition",us=D("footnote_definition",()=>({group:"block",content:"block+",defining:!0,attrs:{label:{default:""}},parseDOM:[{tag:`dl[data-type="${vr}"]`,getAttrs:t=>{if(!(t instanceof HTMLElement))throw me(t);return{label:t.dataset.label}},contentElement:"dd"}],toDOM:t=>{const e=t.attrs.label;return["dl",{"data-label":e,"data-type":vr},["dt",e],["dd",0]]},parseMarkdown:{match:({type:t})=>t===Us,runner:(t,e,n)=>{t.openNode(n,{label:e.label}).next(e.children).closeNode()}},toMarkdown:{match:t=>t.type.name===vr,runner:(t,e)=>{t.openNode(Us,void 0,{label:e.attrs.label,identifier:e.attrs.label}).next(e.content).closeNode()}}}));C(us.ctx,{displayName:"NodeSchemaCtx<footnodeDef>",group:"footnote"});C(us.node,{displayName:"NodeSchema<footnodeDef>",group:"footnote"});const Ir="footnote_reference",ds=D("footnote_reference",()=>({group:"inline",inline:!0,atom:!0,attrs:{label:{default:""}},parseDOM:[{tag:`sup[data-type="${Ir}"]`,getAttrs:t=>{if(!(t instanceof HTMLElement))throw me(t);return{label:t.dataset.label}}}],toDOM:t=>{const e=t.attrs.label;return["sup",{"data-label":e,"data-type":Ir},e]},parseMarkdown:{match:({type:t})=>t==="footnoteReference",runner:(t,e,n)=>{t.addNode(n,{label:e.label})}},toMarkdown:{match:t=>t.type.name===Ir,runner:(t,e)=>{t.addNode("footnoteReference",void 0,void 0,{label:e.attrs.label,identifier:e.attrs.label})}}}));C(ds.ctx,{displayName:"NodeSchemaCtx<footnodeRef>",group:"footnote"});C(ds.node,{displayName:"NodeSchema<footnodeRef>",group:"footnote"});const Pa=fe.extendSchema(t=>e=>{const n=t(e);return{...n,attrs:{...n.attrs,checked:{default:null}},parseDOM:[{tag:'li[data-item-type="task"]',getAttrs:r=>{if(!(r instanceof HTMLElement))throw me(r);return{label:r.dataset.label,listType:r.dataset.listType,spread:r.dataset.spread,checked:r.dataset.checked?r.dataset.checked==="true":null}}},...(n==null?void 0:n.parseDOM)||[]],toDOM:r=>n.toDOM&&r.attrs.checked==null?n.toDOM(r):["li",{"data-item-type":"task","data-label":r.attrs.label,"data-list-type":r.attrs.listType,"data-spread":r.attrs.spread,"data-checked":r.attrs.checked},0],parseMarkdown:{match:({type:r})=>r==="listItem",runner:(r,o,s)=>{if(o.checked==null){n.parseMarkdown.runner(r,o,s);return}const i=o.label!=null?`${o.label}.`:"•",a=o.checked!=null?!!o.checked:null,l=o.label!=null?"ordered":"bullet",c=o.spread!=null?`${o.spread}`:"true";r.openNode(s,{label:i,listType:l,spread:c,checked:a}),r.next(o.children),r.closeNode()}},toMarkdown:{match:r=>r.type.name==="list_item",runner:(r,o)=>{if(o.attrs.checked==null){n.toMarkdown.runner(r,o);return}const s=o.attrs.label,i=o.attrs.listType,a=o.attrs.spread==="true",l=o.attrs.checked;r.openNode("listItem",void 0,{label:s,listType:i,spread:a,checked:l}),r.next(o.content),r.closeNode()}}}});C(Pa,{displayName:"NodeSchema<listItem>",group:"ListItem"});const Fa=B(()=>new H(/^\[(?<checked>\s|x)\]\s$/,(t,e,n,r)=>{var o;const s=t.doc.resolve(n);let i=0,a=s.node(i);for(;a&&a.type.name!=="list_item";)i--,a=s.node(i);if(!a||a.attrs.checked!=null)return null;const l=((o=e.groups)==null?void 0:o.checked)==="x",c=s.before(i),d=t.tr;return d.deleteRange(n,r).setNodeMarkup(c,void 0,{...a.attrs,checked:l}),d}));C(Fa,{displayName:"InputRule<wrapInTaskListInputRule>",group:"ListItem"});const Hp=[ss,cs].flat(),Bp=[Oa,Fa],Kp=[ya],za=ee(()=>_d);C(za,{displayName:"Prose<autoInsertSpanPlugin>",group:"Prose"});const Vp=ee(()=>fd({}));C(Vp,{displayName:"Prose<columnResizingPlugin>",group:"Prose"});const Wa=ee(()=>Nd({allowTableNodeSelection:!0}));C(Wa,{displayName:"Prose<tableEditingPlugin>",group:"Prose"});const ps=pt("remarkGFM",()=>_p);C(ps.plugin,{displayName:"Remark<remarkGFMPlugin>",group:"Remark"});C(ps.options,{displayName:"RemarkConfig<remarkGFMPlugin>",group:"Remark"});const qp=new F("MILKDOWN_KEEP_TABLE_ALIGN_PLUGIN");function Up(t,e){let n=0;return e.forEach((r,o,s)=>{r===t&&(n=s)}),n}const ja=ee(()=>new z({key:qp,appendTransaction:(t,e,n)=>{let r;const o=(s,i)=>{if(r||(r=n.tr),s.type.name!=="table_cell")return;const a=n.doc.resolve(i),l=a.node(a.depth),c=a.node(a.depth-1).firstChild;if(!c)return;const d=Up(s,l),u=c.maybeChild(d);if(!u)return;const p=u.attrs.alignment,f=s.attrs.alignment;p!==f&&r.setNodeMarkup(i,void 0,{...s.attrs,alignment:p})};return e.doc!==n.doc&&n.doc.descendants(o),r}}));C(ja,{displayName:"Prose<keepTableAlignPlugin>",group:"Prose"});const Gp=[ja,za,ps,Wa].flat(),Jp=[Pa,yt,nr,un,rr,dn,us,ds,rs,ln].flat(),Xp=[as,is,ls,Na,Sa,Aa,$a,va,Ia,Ta,_a,La,Ea,Ra,Da,os],Yp=[Jp,Bp,Kp,Hp,Xp,Gp].flat();function wt(t,e){return Object.assign(t,{meta:{package:"@milkdown/plugin-history",...e}}),t}const hs=x("Undo",()=>()=>wl);wt(hs,{displayName:"Command<undo>"});const fs=x("Redo",()=>()=>kl);wt(fs,{displayName:"Command<redo>"});const ms=se({},"historyProviderConfig");wt(ms,{displayName:"Ctx<historyProviderConfig>"});const Ha=ee(t=>bl(t.get(ms.key)));wt(Ha,{displayName:"Ctx<historyProviderPlugin>"});const gs=K("historyKeymap",{Undo:{shortcuts:"Mod-z",command:t=>{const e=t.get(A);return()=>e.call(hs.key)}},Redo:{shortcuts:["Mod-y","Shift-Mod-z"],command:t=>{const e=t.get(A);return()=>e.call(fs.key)}}});wt(gs.ctx,{displayName:"KeymapCtx<history>"});wt(gs.shortcuts,{displayName:"Keymap<history>"});const Qp=[ms,Ha,gs,hs,fs].flat();function Zp(t,e){const{doc:n,selection:r}=t;if(!n||!r||!(r instanceof G||r instanceof Cl))return t;const{to:o}=r,s=e.type==="space"?Array(e.size).fill(" ").join(""):"	";return t.insertText(s,o)}const or=se({type:"space",size:2},"indentConfig");or.meta={package:"@milkdown/plugin-indent",displayName:"Ctx<indentConfig>"};const Ba=Ii(t=>({Tab:(e,n)=>{const r=t.get(or.key),{tr:o}=e,s=Zp(o,r);return s.docChanged?(n==null||n(s),!0):!1}}));Ba.meta={package:"@milkdown/plugin-indent",displayName:"Shortcut<indent>"};const eh=[or,Ba];function Xr(t){if(!t)return!1;if(Array.isArray(t))return t.length>1?!1:Xr(t[0]);const e=t.content;return e?Xr(e):t.type==="text"}function th(t){if(t.content.childCount===1){const e=t.content.firstChild;if((e==null?void 0:e.type.name)==="text"&&e.marks.length===0)return e;if((e==null?void 0:e.type.name)==="paragraph"&&e.childCount===1){const n=e.firstChild;if((n==null?void 0:n.type.name)==="text"&&n.marks.length===0)return n}}return!1}const Ka=ee(t=>{const e=t.get(ke);t.update(Bt,r=>({...r,editable:r.editable??(()=>!0)}));const n=new F("MILKDOWN_CLIPBOARD");return new z({key:n,props:{handlePaste:(r,o)=>{var s,i;const a=t.get(jt),l=(i=(s=r.props).editable)==null?void 0:i.call(s,r.state),{clipboardData:c}=o;if(!l||!c||r.state.selection.$from.node().type.spec.code)return!1;const d=c.getData("text/plain"),u=c.getData("vscode-editor-data");if(u){const k=JSON.parse(u),v=k==null?void 0:k.mode;if(d&&v){const{tr:I}=r.state,W=eu("code_block",e);return I.replaceSelectionWith(W.create({language:v})).setSelection(G.near(I.doc.resolve(Math.max(0,I.selection.from-2)))).insertText(d.replace(/\r\n?/g,`
`)),r.dispatch(I),!0}}const p=c.getData("text/html");if(p.length===0&&d.length===0)return!1;const f=Xs.fromSchema(e);let h;if(p.length===0){const k=a(d);if(!k||typeof k=="string")return!1;h=xl.fromSchema(e).serializeFragment(k.content)}else{const k=document.createElement("template");k.innerHTML=p,h=k.content.cloneNode(!0),k.remove()}const g=f.parseSlice(h),b=th(g);return b?(r.dispatch(r.state.tr.replaceSelectionWith(b,!0)),!0):(r.dispatch(r.state.tr.replaceSelection(g)),!0)},clipboardTextSerializer:r=>{const o=t.get(it);if(Xr(r.content.toJSON()))return r.content.textBetween(0,r.content.size,`

`);const s=e.topNodeType.createAndFill(void 0,r.content);return s?o(s):""}}})});Ka.meta={displayName:"Prose<clipboard>",package:"@milkdown/plugin-clipboard"};const ys=se({shouldAppend:t=>!(!t||["heading","paragraph"].includes(t.type.name)),getNode:t=>t.schema.nodes.paragraph.create()},"trailingConfig");ys.meta={package:"@milkdown/plugin-trailing",displayName:"Ctx<trailingConfig>"};const Va=ee(t=>{const e=new F("MILKDOWN_TRAILING"),{shouldAppend:n,getNode:r}=t.get(ys.key),o=new z({key:e,state:{init:(s,i)=>{const a=i.tr.doc.lastChild;return n(a,i)},apply:(s,i,a,l)=>{if(!s.docChanged)return i;const c=s.doc.lastChild;return n(c,l)}},appendTransaction:(s,i,a)=>{const{doc:l,tr:c}=a,d=r==null?void 0:r(a),u=o.getState(a),p=l.content.size;if(!(!u||!d))return c.insert(p,d)}});return o});Va.meta={package:"@milkdown/plugin-trailing",displayName:"Prose<trailing>"};const nh=[ys,Va];class qa{constructor(){this.beforeMountedListeners=[],this.mountedListeners=[],this.updatedListeners=[],this.markdownUpdatedListeners=[],this.blurListeners=[],this.focusListeners=[],this.destroyListeners=[],this.beforeMount=e=>(this.beforeMountedListeners.push(e),this),this.mounted=e=>(this.mountedListeners.push(e),this),this.updated=e=>(this.updatedListeners.push(e),this)}get listeners(){return{beforeMount:this.beforeMountedListeners,mounted:this.mountedListeners,updated:this.updatedListeners,markdownUpdated:this.markdownUpdatedListeners,blur:this.blurListeners,focus:this.focusListeners,destroy:this.destroyListeners}}markdownUpdated(e){return this.markdownUpdatedListeners.push(e),this}blur(e){return this.blurListeners.push(e),this}focus(e){return this.focusListeners.push(e),this}destroy(e){return this.destroyListeners.push(e),this}}const Xn=N(new qa,"listener"),rh=new F("MILKDOWN_LISTENER"),Ua=t=>(t.inject(Xn,new qa),async()=>{await t.wait(Ke);const e=t.get(Xn),{listeners:n}=e;n.beforeMount.forEach(a=>a(t)),await t.wait(Ht);const r=t.get(it);let o=null,s=null;const i=new z({key:rh,view:()=>({destroy:()=>{n.destroy.forEach(a=>a(t))}}),props:{handleDOMEvents:{focus:()=>(n.focus.forEach(a=>a(t)),!1),blur:()=>(n.blur.forEach(a=>a(t)),!1)}},state:{init:(a,l)=>{o=l.doc,s=r(l.doc)},apply:a=>!a.docChanged||a.getMeta("addToHistory")===!1?void 0:jl(()=>{const{doc:l}=a;if(n.updated.length>0&&o&&!o.eq(l)&&n.updated.forEach(c=>{c(t,l,o)}),n.markdownUpdated.length>0&&o&&!o.eq(l)){const c=r(l);n.markdownUpdated.forEach(d=>{d(t,c,s)}),s=c}o=l},200)()}});t.update(he,a=>a.concat(i)),await t.wait(Fn),n.mounted.forEach(a=>a(t))});Ua.meta={package:"@milkdown/plugin-listener",displayName:"Listener"};var Ga=(t=>(t.CodeMirror="code-mirror",t.ListItem="list-item",t.LinkTooltip="link-tooltip",t.Cursor="cursor",t.ImageBlock="image-block",t.BlockEdit="block-edit",t.Toolbar="toolbar",t.Placeholder="placeholder",t.Table="table",t.Latex="latex",t))(Ga||{});const oh={cursor:!0,"list-item":!0,"link-tooltip":!0,"image-block":!0,"block-edit":!0,placeholder:!0,toolbar:!0,"code-mirror":!0,table:!0,latex:!0};async function sh(t,e,n){switch(t){case"code-mirror":{const{defineFeature:r}=await ae(async()=>{const{defineFeature:o}=await import("./index-B3KiKTSt-D-0R8ytP.js");return{defineFeature:o}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]));return r(e,n)}case"list-item":{const{defineFeature:r}=await ae(async()=>{const{defineFeature:o}=await import("./index-Cuk7cL-r-DWOVfCnx.js");return{defineFeature:o}},__vite__mapDeps([15,5,9,3,2,1,10,11,12,13,14]));return r(e,n)}case"link-tooltip":{const{defineFeature:r}=await ae(async()=>{const{defineFeature:o}=await import("./index-DcRgwPLd-r494DdVH.js");return{defineFeature:o}},__vite__mapDeps([16,5,17,7,18,19,2,8,11,1,3,14,9,10,12,13]));return r(e,n)}case"image-block":{const{defineFeature:r}=await ae(async()=>{const{defineFeature:o}=await import("./index-BFsG6770-DyI06fmS.js");return{defineFeature:o}},__vite__mapDeps([20,5,7,13,9,3,2,1,10,21,12,11,14]));return r(e,n)}case"cursor":{const{defineFeature:r}=await ae(async()=>{const{defineFeature:o}=await import("./index-CxJ9fxJm-Izpfm4Xj.js");return{defineFeature:o}},__vite__mapDeps([22,23,11,1,2,3,12,13,14]));return r(e,n)}case"block-edit":{const{defineFeature:r}=await ae(async()=>{const{defineFeature:o}=await import("./index-Yr5XBaro-ChW6bAZ_.js");return{defineFeature:o}},__vite__mapDeps([24,25,5,7,19,2,8,11,1,3,14,21,13,9,10,12]));return r(e,n)}case"placeholder":{const{defineFeature:r}=await ae(async()=>{const{defineFeature:o}=await import("./index-DOrkOhki-CGtavRST.js");return{defineFeature:o}},__vite__mapDeps([26,25,11,1,2,3,12,13,14]));return r(e,n)}case"toolbar":{const{defineFeature:r}=await ae(async()=>{const{defineFeature:o}=await import("./index-COPjfgxB-DeLTiUBN.js");return{defineFeature:o}},__vite__mapDeps([27,25,5,9,3,2,1,10,28,18,19,8,11,17,7,14,12,13]));return r(e,n)}case"table":{const{defineFeature:r}=await ae(async()=>{const{defineFeature:o}=await import("./index-CBrOT1fW-BwfKVNs4.js");return{defineFeature:o}},__vite__mapDeps([29,5,7,9,3,2,1,10,19,8,11,12,13,14]));return r(e,n)}case"latex":{const{defineFeature:r}=await ae(async()=>{const{defineFeature:o}=await import("./index-DO_xaFxN-B4bO0yn7.js");return{defineFeature:o}},__vite__mapDeps([30,28,25,5,12,6,7,1,2,3,8,9,10,11,18,19,13,14]));return r(e,n)}}}const ih=N([],"FeaturesCtx"),ah=N({},"CrepeCtx");function lh(t){return e=>{e.inject(ih,t)}}var Ja=t=>{throw TypeError(t)},Xa=(t,e,n)=>e.has(t)||Ja("Cannot "+n),Y=(t,e,n)=>(Xa(t,e,"read from private field"),n?n.call(t):e.get(t)),yn=(t,e,n)=>e.has(t)?Ja("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),wn=(t,e,n,r)=>(Xa(t,e,"write to private field"),e.set(t,n),n),re,Ft,qn,Un;class Ya{constructor({root:e,features:n={},featureConfigs:r={},defaultValue:o=""}){yn(this,re),yn(this,Ft),yn(this,qn),yn(this,Un,!0);var s;const i=Object.entries({...oh,...n}).filter(([,l])=>l).map(([l])=>l);wn(this,qn,(s=typeof e=="string"?document.querySelector(e):e)!=null?s:document.body),wn(this,re,pu.make().config(l=>{l.inject(ah,this)}).config(lh(i)).config(l=>{l.set(zn,Y(this,qn)),l.set(On,o),l.set(Bt,{editable:()=>Y(this,Un)}),l.update(or.key,c=>({...c,size:4}))}).use(Eu).use(Ua).use(Qp).use(eh).use(nh).use(Ka).use(Yp));const a=[];i.forEach(l=>{const c=r[l];a.push(sh(l,Y(this,re),c))}),wn(this,Ft,Promise.all(a))}async create(){return await Y(this,Ft),Y(this,re).create()}async destroy(){return await Y(this,Ft),Y(this,re).destroy()}get editor(){return Y(this,re)}setReadonly(e){return wn(this,Un,!e),this}getMarkdown(){return Y(this,re).action(fu())}on(e){return Y(this,re).status!==$i.Created?(Y(this,re).config(n=>{const r=n.get(Xn);e(r)}),this):(Y(this,re).action(n=>{const r=n.get(Xn);e(r)}),this)}}re=new WeakMap;Ft=new WeakMap;qn=new WeakMap;Un=new WeakMap;Ya.Feature=Ga;const ch=()=>{const t=ir.useRef(null),e=ir.useRef(void 0);return ir.useEffect(()=>(e.current=new Ya({root:t.current,defaultValue:"Hello, Milkdown!"}),e.current.create().then(n=>{n.onStatusChange(r=>{console.log(r)})}),()=>{var n;(n=e.current)==null||n.destroy()}),[]),Qa.jsx("div",{ref:t,className:"h-dvh w-full"})},Oh=Object.freeze(Object.defineProperty({__proto__:null,Component:ch},Symbol.toStringTag,{value:"Module"}));export{nn as $,va as A,at as B,Ga as C,Ra as D,Ea as E,ih as F,Ta as G,Ue as H,Da as I,Aa as J,Sa as K,rt as L,fe as M,yt as N,mt as O,B as P,Eh as Q,ht as R,me as S,gt as T,ci as U,Oh as V,on as W,Qc as a,Th as b,_h as c,sn as d,wa as e,D as f,ln as g,se as h,A as i,fo as j,pt as k,Dh as l,E as m,uo as n,pn as o,Rh as p,rn as q,La as r,_a as s,ao as t,ee as u,ft as v,De as w,Te as x,$a as y,os as z};
