import{h as F,p as nt,L as A,B as N}from"./index-DwPuSZv8.js";import{b as it,h as R,d as vt,f as kt}from"./functions-Bsik6ikd-BaRT4VwH.js";import{u as mt}from"./hooks-Bj5sJKsH.js";import{W as ot,V as rt}from"./index.es-DNOfJYMK.js";import{q as _t}from"./index-08JC0wQa.js";import{b as wt}from"./index-0oxnn2GF.js";import{T as q}from"./index-i1pBeVdL.js";var yt=Object.defineProperty,G=Object.getOwnPropertySymbols,Pt=Object.prototype.hasOwnProperty,gt=Object.prototype.propertyIsEnumerable,H=(e,t,n)=>t in e?yt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Et=(e,t)=>{for(var n in t||(t={}))Pt.call(t,n)&&H(e,n,t[n]);if(G)for(var n of G(t))gt.call(t,n)&&H(e,n,t[n]);return e};function P(e,t){return Object.assign(e,{meta:Et({package:"@milkdown/components"},t)}),e}var $t=Object.defineProperty,X=Object.getOwnPropertySymbols,Ot=Object.prototype.hasOwnProperty,Lt=Object.prototype.propertyIsEnumerable,z=(e,t,n)=>t in e?$t(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,j=(e,t)=>{for(var n in t||(t={}))Ot.call(t,n)&&z(e,n,t[n]);if(X)for(var n of X(t))Lt.call(t,n)&&z(e,n,t[n]);return e};const Tt={mode:"preview"},f=F(j({},Tt),"linkTooltipStateCtx");P(f,{displayName:"State<link-tooltip>",group:"LinkTooltip"});const St={addLink:()=>{},editLink:()=>{},removeLink:()=>{}},b=F(j({},St),"linkTooltipAPICtx");P(f,{displayName:"API<link-tooltip>",group:"LinkTooltip"});const Ct={linkIcon:()=>"🔗",editButton:()=>"✎",removeButton:()=>"⌫",confirmButton:()=>R`Confirm ⏎`,onCopyLink:()=>{},inputPlaceholder:"Paste link..."},K=F(j({},Ct),"linkTooltipConfigCtx");P(f,{displayName:"Config<link-tooltip>",group:"LinkTooltip"});const T=ot("LINK_PREVIEW");P(T[0],{displayName:"PreviewTooltipSpec<link-tooltip>",group:"LinkTooltip"});P(T[1],{displayName:"PreviewTooltipPlugin<link-tooltip>",group:"LinkTooltip"});const B=ot("LINK_EDIT");P(B[0],{displayName:"EditTooltipSpec<link-tooltip>",group:"LinkTooltip"});P(B[1],{displayName:"EditTooltipPlugin<link-tooltip>",group:"LinkTooltip"});function Mt(e,t,n,i,r){let o={start:-1,end:-1};return n.nodesBetween(i,r,(l,s)=>{if(o.start>-1)return!1;o.start===-1&&e.isInSet(l.marks)&&t===l&&(o={start:s,end:s+Math.max(l.textContent.length,1)})}),o}function It(e,t,n){const i=t.posAtCoords({left:n.clientX,top:n.clientY});if(!i)return;const{pos:r}=i,o=t.state.doc.nodeAt(r);if(!o)return;const l=o.marks.find(u=>u.type===N.mark.type(e));if(!(!l||!T.pluginKey()))return{show:!0,pos:r,node:o,mark:l}}function st(e,t){const n=customElements.get(e);if(n==null){customElements.define(e,t);return}n!==t&&console.warn(`Custom element ${e} has been defined before.`)}const at=({config:e,src:t,onEdit:n,onRemove:i})=>{const r=s=>{s.stopPropagation(),s.preventDefault(),n==null||n()},o=s=>{s.stopPropagation(),s.preventDefault(),i==null||i()};return R`
    <host>
      <div class="link-preview" onmousedown=${s=>{s.preventDefault(),navigator.clipboard&&t&&navigator.clipboard.writeText(t).then(()=>{e==null||e.onCopyLink(t)}).catch(u=>{throw u})}}>
        <span class="link-icon"> ${e==null?void 0:e.linkIcon()} </span>
        <a href=${t} target="_blank" class="link-display">${t}</a>
        <span class="button link-edit-button" onmousedown=${r}>
          ${e==null?void 0:e.editButton()}
        </span>
        <span
          class="button link-remove-button"
          onmousedown=${o}
        >
          ${e==null?void 0:e.removeButton()}
        </span>
      </div>
    </host>
  `};at.props={config:Object,src:String,onEdit:Function,onRemove:Function};const lt=it(at);var pt=e=>{throw TypeError(e)},ut=(e,t,n)=>t.has(e)||pt("Cannot "+n),a=(e,t,n)=>(ut(e,t,"read from private field"),n?n.call(e):t.get(e)),k=(e,t,n)=>t.has(e)?pt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),S=(e,t,n,i)=>(ut(e,t,"write to private field"),t.set(e,n),n),m,c,$,O,I,W,x,L;class Wt{constructor(t,n){this.ctx=t,k(this,m,new lt),k(this,c),k(this,$,this.ctx.use(f.key)),k(this,O,!1),k(this,I,({mode:i})=>{i==="edit"&&a(this,L).call(this)}),k(this,W,()=>{S(this,O,!0)}),k(this,x,()=>{S(this,O,!1)}),k(this,L,()=>{a(this,c).hide(),a(this,c).element.removeEventListener("mouseenter",a(this,W)),a(this,c).element.removeEventListener("mouseleave",a(this,x))}),this.show=(i,r,o,l)=>{a(this,m).config=this.ctx.get(K.key),a(this,m).src=i.attrs.href,a(this,m).onEdit=()=>{this.ctx.get(b.key).editLink(i,r,o)},a(this,m).onRemove=()=>{this.ctx.get(b.key).removeLink(r,o),a(this,L).call(this)},a(this,c).show({getBoundingClientRect:()=>l}),a(this,c).element.addEventListener("mouseenter",a(this,W)),a(this,c).element.addEventListener("mouseleave",a(this,x))},this.hide=()=>{a(this,O)||a(this,L).call(this)},this.update=()=>{},this.destroy=()=>{a(this,$).off(a(this,I)),a(this,c).destroy(),a(this,m).remove()},S(this,c,new rt({debounce:0,content:a(this,m),shouldShow:()=>!1})),a(this,c).update(n),S(this,$,t.use(f.key)),a(this,$).on(a(this,I))}}m=new WeakMap;c=new WeakMap;$=new WeakMap;O=new WeakMap;I=new WeakMap;W=new WeakMap;x=new WeakMap;L=new WeakMap;st("milkdown-link-preview",lt);function xt(e){let t;const i=_t((o,l)=>{if(!t||!o.hasFocus()||e.get(f.key).mode==="edit")return;const u=It(e,o,l);if(u){const d=o.state.doc.resolve(u.pos),v=Mt(u.mark,u.node,o.state.doc,d.before(),d.after()),E=v.start,Y=v.end;t.show(u.mark,E,Y,nt(o,E,Y));return}t.hide()},200),r=()=>{setTimeout(()=>{t==null||t.hide()},200)};e.set(T.key,{props:{handleDOMEvents:{mousemove:i,mouseleave:r}},view:o=>(t=new Wt(e,o),t)})}const dt=({src:e,onConfirm:t,onCancel:n,config:i})=>{const r=vt(),[o,l]=mt(e);kt(()=>{l(e??"")},[e]);const s=()=>{var d,v;t==null||t((v=(d=r.current)==null?void 0:d.value)!=null?v:"")},u=d=>{var v,E;d.stopPropagation(),d.key==="Enter"&&(t==null||t((E=(v=r.current)==null?void 0:v.value)!=null?E:""),d.preventDefault()),d.key==="Escape"&&(n==null||n(),d.preventDefault())};return R`
    <host>
      <div class="link-edit">
        <input
          class="input-area"
          placeholder=${i==null?void 0:i.inputPlaceholder}
          ref=${r}
          onkeydown=${u}
          oninput=${d=>l(d.target.value)}
          value=${o}
        />
        <span
          class=${wt("button confirm",!o&&"hidden")}
          onclick=${s}
        >
          ${i==null?void 0:i.confirmButton()}
        </span>
      </div>
    </host>
  `};dt.props={config:Object,src:String,onConfirm:Function,onCancel:Function};const ct=it(dt);var Dt=Object.defineProperty,bt=Object.defineProperties,Bt=Object.getOwnPropertyDescriptors,J=Object.getOwnPropertySymbols,At=Object.prototype.hasOwnProperty,Nt=Object.prototype.propertyIsEnumerable,ht=e=>{throw TypeError(e)},Q=(e,t,n)=>t in e?Dt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,C=(e,t)=>{for(var n in t||(t={}))At.call(t,n)&&Q(e,n,t[n]);if(J)for(var n of J(t))Nt.call(t,n)&&Q(e,n,t[n]);return e},U=(e,t)=>bt(e,Bt(t)),ft=(e,t,n)=>t.has(e)||ht("Cannot "+n),p=(e,t,n)=>(ft(e,t,"read from private field"),n?n.call(e):t.get(e)),g=(e,t,n)=>t.has(e)?ht("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),M=(e,t,n,i)=>(ft(e,t,"write to private field"),t.set(e,n),n),h,_,w,y,V,D;const Z={from:-1,to:-1,mark:null};class Vt{constructor(t,n){this.ctx=t,g(this,h,new ct),g(this,_),g(this,w,C({},Z)),g(this,y,()=>{p(this,_).hide(),this.ctx.update(f.key,i=>U(C({},i),{mode:"preview"})),M(this,w,C({},Z))}),g(this,V,i=>{const r=this.ctx.get(A),{from:o,to:l,mark:s}=p(this,w),u=N.type(this.ctx);if(s&&s.attrs.href===i){p(this,y).call(this);return}const d=r.state.tr;s&&d.removeMark(o,l,s),d.addMark(o,l,u.create({href:i})),r.dispatch(d),p(this,y).call(this)}),g(this,D,(i,r,o)=>{const l=this.ctx.get(K.key);p(this,h).config=l,p(this,h).src=i,this.ctx.update(f.key,u=>U(C({},u),{mode:"edit"}));const s=this.ctx.get(A);s.dispatch(s.state.tr.setSelection(q.create(s.state.doc,r,o))),p(this,_).show({getBoundingClientRect:()=>nt(s,r,o)}),requestAnimationFrame(()=>{var u;(u=p(this,h).querySelector("input"))==null||u.focus()})}),this.update=i=>{const{state:r}=i,{selection:o}=r;if(!(o instanceof q))return;const{from:l,to:s}=o;l===p(this,w).from&&s===p(this,w).to||p(this,y).call(this)},this.destroy=()=>{p(this,_).destroy(),p(this,h).remove()},this.addLink=(i,r)=>{M(this,w,{from:i,to:r,mark:null}),p(this,D).call(this,"",i,r)},this.editLink=(i,r,o)=>{M(this,w,{from:r,to:o,mark:i}),p(this,D).call(this,i.attrs.href,r,o)},this.removeLink=(i,r)=>{const o=this.ctx.get(A),l=o.state.tr;l.removeMark(i,r,N.type(this.ctx)),o.dispatch(l),p(this,y).call(this)},M(this,_,new rt({content:p(this,h),debounce:0,shouldShow:()=>!1})),p(this,_).onHide=()=>{p(this,h).update().catch(i=>{throw i}),n.dom.focus({preventScroll:!0})},p(this,_).update(n),p(this,h).onConfirm=p(this,V),p(this,h).onCancel=p(this,y)}}h=new WeakMap;_=new WeakMap;w=new WeakMap;y=new WeakMap;V=new WeakMap;D=new WeakMap;var Ft=Object.defineProperty,Rt=Object.defineProperties,jt=Object.getOwnPropertyDescriptors,tt=Object.getOwnPropertySymbols,Kt=Object.prototype.hasOwnProperty,Yt=Object.prototype.propertyIsEnumerable,et=(e,t,n)=>t in e?Ft(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,qt=(e,t)=>{for(var n in t||(t={}))Kt.call(t,n)&&et(e,n,t[n]);if(tt)for(var n of tt(t))Yt.call(t,n)&&et(e,n,t[n]);return e},Gt=(e,t)=>Rt(e,jt(t));st("milkdown-link-edit",ct);function Ht(e){let t;e.update(b.key,n=>Gt(qt({},n),{addLink:(i,r)=>{t==null||t.addLink(i,r)},editLink:(i,r,o)=>{t==null||t.editLink(i,r,o)},removeLink:(i,r)=>{t==null||t.removeLink(i,r)}})),e.set(B.key,{view:n=>(t=new Vt(e,n),t)})}function ee(e){xt(e),Ht(e)}const ne=[f,b,K,T,B].flat();export{ne as a,b,ee as c,K as l};
