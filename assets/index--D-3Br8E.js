import{af as n,al as T}from"./pro-components-L2sDkqQs.js";import{a as m,S as J,b0 as b,B as x,Y as O}from"./antd-Bzy0GL_f.js";import{I as p}from"./index-0oxnn2GF.js";import{c as w,p as E,a as k}from"./middleware-DqHBdyGy.js";import{aO as C,aP as R,aQ as L,aR as M,aS as K,aT as h,aU as P,aV as z}from"./json-editor-CBqK5HSN.js";import{u as B}from"./index-C1FgRNF4.js";import{L as I,U as _,g as $,i as A,a as D,b as U,c as V,p as g,d as W,e as q,s as Q,t as Y,f as Z}from"./stringify-DcdCB2ls.js";function F(e){throw new Error("config is deprecated, support for circularRefs is removed from the library. If you encounter circular references in your data structures, please rethink your datastructures: better prevent circular references in the first place.")}function G(e,t){return typeof t=="string"&&H.test(t)?new Date(t):t}const H=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z$/,X=Object.freeze(Object.defineProperty({__proto__:null,LosslessNumber:I,UnsafeNumberReason:_,config:F,getUnsafeNumberReason:$,isInteger:A,isLosslessNumber:D,isNumber:U,isSafeNumber:V,parse:g,parseLosslessNumber:W,parseNumberAndBigInt:q,reviveDate:G,stringify:Q,toLosslessNumber:Y,toSafeNumberOrThrow:Z},Symbol.toStringTag,{value:"Module"})),ee=w()(E((e,t)=>({jsonTabs:["0"],activeKey:"0",addJsonTab:s=>e(()=>({jsonTabs:R(t().jsonTabs,s)})),removeJsonTab:s=>e(()=>({jsonTabs:C(t().jsonTabs,s)})),setActiveKey:s=>e(()=>({activeKey:s}))}),{name:"json-tab-store",storage:k(()=>localStorage)})),se=e=>{const t=m.useRef(null),s=m.useRef(void 0);return m.useEffect(()=>(t!=null&&t.current&&(s.current=L({target:t.current,props:{parser:X,queryLanguages:[M,K],onRenderMenu:(a,c)=>{var u,d;const f=!c.readOnly&&h.text===c.mode&&((u=s.current)==null?void 0:u.get()).text.startsWith('"')&&((d=s.current)==null?void 0:d.get()).text.endsWith('"');return a.push({type:"button",title:"JSON.parse",icon:{prefix:"fas",icon:[512,512,[],"","m320,488c0,9.5 -5.6,18.1 -14.2,21.9s-18.8,2.3 -25.8,-4.1l-80,-72c-5.1,-4.6 -7.9,-11 -7.9,-17.8s2.9,-13.3 7.9,-17.8l80,-72c7,-6.3 17.2,-7.9 25.8,-4.1s14.2,12.4 14.2,21.9l0,40l16,0c35.3,0 64,-28.7 64,-64l0,-166.7c-28.3,-12.3 -48,-40.5 -48,-73.3c0,-44.2 35.8,-80 80,-80s80,35.8 80,80c0,32.8 -19.7,61 -48,73.3l0,166.7c0,70.7 -57.3,128 -128,128l-16,0l0,40zm136,-408a24,24 0 1 0 -48,0a24,24 0 1 0 48,0zm-264,-56c0,-9.5 5.6,-18.1 14.2,-21.9s18.8,-2.3 25.8,4.1l80,72c5.1,4.6 7.9,11 7.9,17.8s-2.9,13.3 -7.9,17.8l-80,72c-7,6.3 -17.2,7.9 -25.8,4.1s-14.2,-12.4 -14.2,-21.9l0,-40l-16,0c-35.3,0 -64,28.7 -64,64l0,166.7c28.3,12.3 48,40.5 48,73.3c0,44.2 -35.8,80 -80,80s-80,-35.8 -80,-80c0,-32.8 19.7,-61 48,-73.3l0,-166.7c0,-70.7 57.3,-128 128,-128l16,0l0,-40zm-136,408a24,24 0 1 0 48,0a24,24 0 1 0 -48,0z"],iconName:"code-compare"},onClick:()=>{var l,i;(i=s.current)==null||i.updateProps({content:{text:g(((l=s.current)==null?void 0:l.get()).text)}})},disabled:!f}),a}}})),()=>{s.current&&(s.current.destroy(),s.current=void 0)}),[]),m.useEffect(()=>{var a;(a=s.current)==null||a.updateProps({...e})},[e]),n.jsx("div",{className:"h-full w-full",ref:t})},te=e=>{const t={mode:"text",content:{text:""}},s=(e==null?void 0:e.idx)||"0",[a,c]=B(`json-${s}`,{defaultValue:t}),f=()=>a==null?h.text:a.mode,u=l=>{c(i=>({...i,content:l}))},d=l=>{c(i=>({...i,mode:l}))};return n.jsx(se,{mode:f(),content:a.content,onChange:u,onChangeMode:d})},de=()=>{const{jsonTabs:e,activeKey:t,addJsonTab:s,removeJsonTab:a,setActiveKey:c}=ee(),[f,u]=m.useState([]);m.useEffect(()=>{const r=e.map(o=>({key:o,label:`Tab ${o}`,closable:!0,children:n.jsx(te,{idx:o}),className:"h-[calc(100dvh-112px)] md:h-[calc(100dvh-56px)]"}));if(P(e,t)===-1){const o=z(r);c((o==null?void 0:o.key)||"0")}u(r)},[e,t,c]);const d=r=>{c(r)},l=(r,o)=>{o==="add"?i():j(r)},i=()=>{let r="0";if(e&&e.length>0){const o=e.map(v=>Number(v));r=`${Math.max(...o)+1}`}s(r),c(r)},j=r=>{a(String(r)),localStorage.removeItem(`json-${r}`),e&&e.length<=1&&s("0")},y={items:[{key:1,label:n.jsx("div",{children:"上传 JSON 文件"})},{key:2,label:n.jsx("div",{children:"上传 Excel 文件"})}]},S={items:[{key:1,label:n.jsx("div",{children:"下载为 JSON 文件"})},{key:2,label:n.jsx("div",{children:"下载为 Excel 文件"})}]},N={left:n.jsx("div",{className:"mx-4 hidden",children:n.jsxs(J.Compact,{children:[n.jsx(b,{menu:y,children:n.jsx(x,{icon:n.jsx(p,{icon:"lucide:upload"}),children:"上传"})}),n.jsx(b,{menu:S,children:n.jsx(x,{icon:n.jsx(p,{icon:"lucide:download"}),children:"下载"})})]})})};return n.jsx(T,{title:!1,className:"w-full",children:n.jsx(O,{type:"editable-card",size:"small",onChange:d,activeKey:t,onEdit:l,items:f,tabBarExtraContent:N})})};export{de as Component};
