import{i as Cn,a as In,d as Vt}from"./index-D6fLMv29-CeGVhQwU.js";import{b as Ut,d as Jt,f as Ue,h as re,x as Ln,y as Wn,u as Tn,z as Sn,A as En,B as Hn,C as Bn,D as xn,E as Rn,F as An,G as Dn,H as On,I as Pn,J as Nn,K as Gn,v as Fn,L as qn,M as zn,N as Kn}from"./functions-Bsik6ikd-D8GGRsLx.js";import{a as Pt,u as Vn,b as V}from"./hooks-Dt0wL0oo.js";import{h as Me,u as Qt,a as Yt,L as $,b as _e,c as Un,p as Jn,w as Xt,F as Qn,C as Yn,H as U,q as Xn,d as Zn,O as jn,T as es,M as ts,W as Nt,e as ns}from"./index-BKZqlHfW.js";import{t as ss}from"./index-6kZY_JYa.js";import{f as Zt,o as jt,c as en}from"./floating-ui.dom-DtR07Cup.js";import{a as tn,P as nn,N as Gt,H as as,T as Ye,f as ls}from"./index-CCHPmTqj.js";import{q as os}from"./index-BUFMBfDr.js";import{b as is}from"./index.es-DqAO6ekn.js";import"./pro-components-CPZIsSOc.js";import"./antd-Cl3cKmq-.js";import"./json-editor-D3HpTOiY.js";import"./syntax-2Kab1CR3.js";import"./index.browser-B0na17u1.js";import"./index-DkoMvkBT.js";var sn=n=>{throw TypeError(n)},Xe=(n,e,t)=>e.has(n)||sn("Cannot "+t),o=(n,e,t)=>(Xe(n,e,"read from private field"),t?t.call(n):e.get(n)),k=(n,e,t)=>e.has(n)?sn("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),p=(n,e,t,a)=>(Xe(n,e,"write to private field"),e.set(n,t),t),rs=(n,e,t)=>(Xe(n,e,"access private method"),t);function Ne(n,e){return Object.assign(n,{meta:{package:"@milkdown/plugin-block",...e}}),n}const ds=n=>!Yt(e=>e.type.name==="table")(n),se=Me({filterNodes:ds},"blockConfig");Ne(se,{displayName:"Ctx<blockConfig>"});function us(n,e,t){var a;if(!n.dom.parentElement)return null;try{const s=(a=n.posAtCoords({left:e.x,top:e.y}))==null?void 0:a.inside;if(s==null||s<0)return null;let l=n.state.doc.resolve(s),r=n.state.doc.nodeAt(s),c=n.nodeDOM(s);const u=_=>{const b=l.depth>=1&&l.index(l.depth)===0;if(!(_||b))return;const C=l.before(l.depth);r=n.state.doc.nodeAt(C),c=n.nodeDOM(C),l=n.state.doc.resolve(C),t(l,r)||u(!0)},y=t(l,r);return u(!y),!c||!r?null:{node:r,$pos:l,el:c}}catch{return null}}let Ft=null;function cs(){return Ft||(Ft=document.implementation.createHTMLDocument("title"))}const hs={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};function ps(n,e){const t=[];let{openStart:a,openEnd:s,content:l}=e;for(;a>1&&s>1&&l.childCount===1&&l.firstChild.childCount===1;){a-=1,s-=1;const M=l.firstChild;t.push(M.type.name,M.attrs!==M.type.defaultAttrs?M.attrs:null),l=M.content}const r=n.someProp("clipboardSerializer")||as.fromSchema(n.state.schema),c=cs(),u=c.createElement("div");u.appendChild(r.serializeFragment(l,{document:c}));let y=u.firstChild,_,b=0;for(;y&&y.nodeType===1&&(_=hs[y.nodeName.toLowerCase()]);){for(let M=_.length-1;M>=0;M--){const W=c.createElement(_[M]);for(;u.firstChild;)W.appendChild(u.firstChild);u.appendChild(W),b++}y=u.firstChild}y&&y.nodeType===1&&y.setAttribute("data-pm-slice",`${a} ${s}${b?` -${b}`:""} ${JSON.stringify(t)}`);const C=n.someProp("clipboardTextSerializer",M=>M(e,n))||e.content.textBetween(0,e.content.size,`

`);return{dom:u,text:C}}const qt=_e.ie&&_e.ie_version<15||_e.ios&&_e.webkit_version<604,zt=20;var ye,Ce,J,R,de,A,q,an,ue,Q,Y,Ie,ce,he,pe,Le,X;class ms{constructor(){k(this,q),k(this,ye),k(this,Ce),k(this,J),k(this,R),k(this,de),k(this,A),k(this,Q),k(this,Y),k(this,Ie),k(this,ce),k(this,he),k(this,pe),k(this,Le),k(this,X),p(this,Ce,()=>{if(!o(this,R))return null;const e=o(this,R),t=o(this,q,ue);if(t&&Gt.isSelectable(e.node)){const a=Gt.create(t.state.doc,e.$pos.pos);return t.dispatch(t.state.tr.setSelection(a)),t.focus(),p(this,J,a),a}return null}),p(this,J,null),p(this,R,null),p(this,de,void 0),p(this,A,!1),p(this,Y,()=>{var e;(e=o(this,Q))==null||e.call(this,{type:"hide"}),p(this,R,null)}),p(this,Ie,e=>{var t;p(this,R,e),(t=o(this,Q))==null||t.call(this,{type:"show",active:e})}),this.bind=(e,t)=>{p(this,ye,e),p(this,Q,t)},this.addEvent=e=>{e.addEventListener("mousedown",o(this,ce)),e.addEventListener("mouseup",o(this,he)),e.addEventListener("dragstart",o(this,pe))},this.removeEvent=e=>{e.removeEventListener("mousedown",o(this,ce)),e.removeEventListener("mouseup",o(this,he)),e.removeEventListener("dragstart",o(this,pe))},this.unBind=()=>{p(this,Q,void 0)},p(this,ce,()=>{var e;p(this,de,(e=o(this,R))==null?void 0:e.el.getBoundingClientRect()),o(this,Ce).call(this)}),p(this,he,()=>{if(!o(this,A)){requestAnimationFrame(()=>{var e;o(this,de)&&((e=o(this,q,ue))==null||e.focus())});return}p(this,A,!1),p(this,J,null)}),p(this,pe,e=>{var t;p(this,A,!0);const a=o(this,q,ue);if(!a)return;a.dom.dataset.dragging="true";const s=o(this,J);if(e.dataTransfer&&s){const l=s.content();e.dataTransfer.effectAllowed="copyMove";const{dom:r,text:c}=ps(a,l);e.dataTransfer.clearData(),e.dataTransfer.setData(qt?"Text":"text/html",r.innerHTML),qt||e.dataTransfer.setData("text/plain",c);const u=(t=o(this,R))==null?void 0:t.el;u&&e.dataTransfer.setDragImage(u,0,0),a.dragging={slice:l,move:!0}}}),this.keydownCallback=e=>(o(this,Y).call(this),p(this,A,!1),e.dom.dataset.dragging="false",!1),p(this,Le,ss((e,t)=>{if(!e.editable)return;const a=e.dom.getBoundingClientRect(),s=a.left+a.width/2;if(!(e.root.elementFromPoint(s,t.clientY)instanceof Element)){o(this,Y).call(this);return}const l=o(this,q,an);if(!l)return;const r=us(e,{x:s,y:t.clientY},l);if(!r){o(this,Y).call(this);return}o(this,Ie).call(this,r)},200)),this.mousemoveCallback=(e,t)=>(e.composing||!e.editable||o(this,Le).call(this,e,t),!1),this.dragoverCallback=(e,t)=>{var a;if(o(this,A)){const s=(a=o(this,q,ue))==null?void 0:a.dom.parentElement;if(!s)return!1;const l=s.scrollHeight>s.clientHeight,r=s.getBoundingClientRect();if(l){if(s.scrollTop>0&&Math.abs(t.y-r.y)<zt){const u=s.scrollTop>10?s.scrollTop-10:0;return s.scrollTop=u,!1}const c=Math.round(e.dom.getBoundingClientRect().height);if(Math.round(s.scrollTop+r.height)<c&&Math.abs(t.y-(r.height+r.y))<zt){const u=s.scrollTop+10;return s.scrollTop=u,!1}}}return!1},this.dragenterCallback=e=>{e.dragging&&(p(this,A,!0),e.dom.dataset.dragging="true")},this.dragleaveCallback=(e,t)=>{const a=t.clientX,s=t.clientY;(a<0||s<0||a>window.innerWidth||s>window.innerHeight)&&(p(this,R,null),o(this,X).call(this,e))},this.dropCallback=e=>(o(this,X).call(this,e),!1),this.dragendCallback=e=>{o(this,X).call(this,e)},p(this,X,e=>{p(this,A,!1),e.dom.dataset.dragging="false"})}}ye=new WeakMap,Ce=new WeakMap,J=new WeakMap,R=new WeakMap,de=new WeakMap,A=new WeakMap,q=new WeakSet,an=function(){var n;return(n=o(this,ye))==null?void 0:n.get(se.key).filterNodes},ue=function(){var n;return(n=o(this,ye))==null?void 0:n.get($)},Q=new WeakMap,Y=new WeakMap,Ie=new WeakMap,ce=new WeakMap,he=new WeakMap,pe=new WeakMap,Le=new WeakMap,X=new WeakMap;const Ze=Me(new ms,"blockService");Ne(se,{displayName:"Ctx<blockService>"});const je=Me({},"blockSpec");Ne(se,{displayName:"Ctx<blockSpec>"});const et=Qt(n=>{const e=new tn("MILKDOWN_BLOCK"),t=n.get(Ze.key),a=n.get(je.key);return new nn({key:e,...a,props:{...a.props,handleDOMEvents:{drop:s=>t.dropCallback(s),pointermove:(s,l)=>t.mousemoveCallback(s,l),keydown:s=>t.keydownCallback(s),dragover:(s,l)=>t.dragoverCallback(s,l),dragleave:(s,l)=>t.dragleaveCallback(s,l),dragenter:s=>t.dragenterCallback(s),dragend:s=>t.dragendCallback(s)}}})});Ne(et,{displayName:"Prose<block>"});var T,P,te,ne,Pe,me,We,Te,fe,ve,we,Je,ln;class fs{constructor(e){k(this,Je),k(this,T),k(this,P),k(this,te),k(this,ne),k(this,Pe),k(this,me),k(this,We),k(this,Te),k(this,fe),k(this,ve),k(this,we),p(this,ne,null),p(this,me,!1),this.update=()=>{requestAnimationFrame(()=>{if(!o(this,me))try{rs(this,Je,ln).call(this),p(this,me,!0)}catch{}})},this.destroy=()=>{var t,a;(t=o(this,te))==null||t.unBind(),(a=o(this,te))==null||a.removeEvent(o(this,T)),o(this,T).remove()},this.show=t=>{const a=t.el,s=o(this,P).get($).dom,l={ctx:o(this,P),active:t,editorDom:s,blockDom:o(this,T)},r={contextElement:a,getBoundingClientRect:()=>o(this,ve)?o(this,ve).call(this,l):a.getBoundingClientRect()},c=[Zt()];if(o(this,fe)){const u=o(this,fe).call(this,l),y=jt(u);c.push(y)}en(r,o(this,T),{placement:o(this,we)?o(this,we).call(this,l):"left",middleware:[...c,...o(this,We)],...o(this,Te)}).then(({x:u,y})=>{Object.assign(o(this,T).style,{left:`${u}px`,top:`${y}px`}),o(this,T).dataset.show="true"})},this.hide=()=>{o(this,T).dataset.show="false"},p(this,P,e.ctx),p(this,T,e.content),p(this,fe,e.getOffset),p(this,ve,e.getPosition),p(this,we,e.getPlacement),p(this,We,e.middleware??[]),p(this,Te,e.floatingUIOptions??{}),p(this,Pe,e.root),this.hide()}get active(){return o(this,ne)}}T=new WeakMap,P=new WeakMap,te=new WeakMap,ne=new WeakMap,Pe=new WeakMap,me=new WeakMap,We=new WeakMap,Te=new WeakMap,fe=new WeakMap,ve=new WeakMap,we=new WeakMap,Je=new WeakSet,ln=function(){const n=o(this,P).get($);(o(this,Pe)??n.dom.parentElement??document.body).appendChild(o(this,T));const e=o(this,P).get(Ze.key);e.bind(o(this,P),t=>{t.type==="hide"?(this.hide(),p(this,ne,null)):t.type==="show"&&(this.show(t.active),p(this,ne,t.active))}),p(this,te,e),o(this,te).addEvent(o(this,T)),o(this,T).draggable=!0};const Ge=[je,se,Ze,et];Ge.key=je.key;Ge.pluginKey=et.key;var on=n=>{throw TypeError(n)},tt=(n,e,t)=>e.has(n)||on("Cannot "+t),E=(n,e,t)=>(tt(n,e,"read from private field"),e.get(n)),B=(n,e,t)=>e.has(n)?on("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),x=(n,e,t,a)=>(tt(n,e,"write to private field"),e.set(n,t),t),vs=(n,e,t)=>(tt(n,e,"access private method"),t);function ws(n){const e=Me({},`${n}_SLASH_SPEC`),t=Qt(s=>{const l=s.get(e.key);return new nn({key:new tn(`${n}_SLASH`),...l})}),a=[e,t];return a.key=e.key,a.pluginKey=t.key,e.meta={package:"@milkdown/plugin-slash",displayName:`Ctx<slashSpec>|${n}`},t.meta={package:"@milkdown/plugin-slash",displayName:`Prose<slash>|${n}`},a}var ke,Se,Ee,He,Be,ee,xe,Re,Ae,Qe,rn;class ks{constructor(e){B(this,Qe),B(this,ke),B(this,Se),B(this,Ee),B(this,He),B(this,Be),B(this,ee),B(this,xe),B(this,Re),B(this,Ae),x(this,ke,!1),this.onShow=()=>{},this.onHide=()=>{},x(this,Ae,(t,a)=>{const{state:s,composing:l}=t,{selection:r,doc:c}=s,{ranges:u}=r,y=Math.min(...u.map(C=>C.$from.pos)),_=Math.max(...u.map(C=>C.$to.pos)),b=a&&a.doc.eq(c)&&a.selection.eq(r);if(E(this,ke)||((E(this,He)??t.dom.parentElement??document.body).appendChild(this.element),x(this,ke,!0)),!(l||b)){if(!E(this,xe).call(this,t,a)){this.hide();return}en({getBoundingClientRect:()=>Jn(t,y,_)},this.element,{placement:"bottom-start",middleware:[Zt(),jt(E(this,Re)),...E(this,Se)],...E(this,Ee)}).then(({x:C,y:M})=>{Object.assign(this.element.style,{left:`${C}px`,top:`${M}px`})}),this.show()}}),this.update=(t,a)=>{os(E(this,Ae),E(this,Be))(t,a)},this.getContent=(t,a=s=>s.type.name==="paragraph")=>{const{selection:s}=t.state,{empty:l,$from:r}=s,c=t.state.selection instanceof Ye,u=this.element.contains(document.activeElement),y=!t.hasFocus()&&!u,_=!t.editable,b=!Un(a)(t.state.selection);if(!(y||_||!l||!c||b))return r.parent.textBetween(Math.max(0,r.parentOffset-500),r.parentOffset,void 0,"￼")},this.destroy=()=>{},this.show=()=>{this.element.dataset.show="true",this.onShow()},this.hide=()=>{this.element.dataset.show="false",this.onHide()},this.element=e.content,x(this,Be,e.debounce??200),x(this,xe,e.shouldShow??vs(this,Qe,rn)),x(this,ee,e.trigger??"/"),x(this,Re,e.offset),x(this,Se,e.middleware??[]),x(this,Ee,e.floatingUIOptions??{}),x(this,He,e.root)}}ke=new WeakMap,Se=new WeakMap,Ee=new WeakMap,He=new WeakMap,Be=new WeakMap,ee=new WeakMap,xe=new WeakMap,Re=new WeakMap,Ae=new WeakMap,Qe=new WeakSet,rn=function(n){const e=this.getContent(n);if(!e)return!1;const t=e.at(-1);return t?Array.isArray(E(this,ee))?E(this,ee).includes(t):E(this,ee)===t:!1};function Fe(n){const{$from:e,$to:t}=n.selection,{pos:a}=e,{pos:s}=t;return n=n.deleteRange(a-e.node().content.size,s),n}function ys(n,e,t=null){const{from:a,to:s}=n.selection;return n.setBlockType(a,s,e,t)}function Ms(n,e,t=null){const{$from:a,$to:s}=n.selection,l=a.blockRange(s),r=l&&ls(l,e,t);return r?n.wrap(l,r):null}function bs(n,e,t=null){const a=e.createAndFill(t);return a?n.replaceSelectionWith(a):null}function F(n,e=null){return(t,a)=>{if(a){const s=ys(Fe(t.tr),n,e);a(s.scrollIntoView())}return!0}}function ge(n,e=null){return(t,a)=>{const s=Ms(Fe(t.tr),n,e);return s?(a&&a(s.scrollIntoView()),!0):!1}}function $e(n,e=null){return(t,a)=>{const s=bs(Fe(t.tr),n,e);return s?(a&&a(s.scrollIntoView()),!0):!1}}var dn=n=>{throw TypeError(n)},un=(n,e,t)=>e.has(n)||dn("Cannot "+t),oe=(n,e,t)=>(un(n,e,"read from private field"),t?t.call(n):e.get(n)),Kt=(n,e,t)=>e.has(n)?dn("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),_s=(n,e,t,a)=>(un(n,e,"write to private field"),e.set(n,t),t),Z,De;class gs{constructor(){Kt(this,Z,[]),this.clear=()=>(_s(this,Z,[]),this),Kt(this,De,e=>{const t={group:e,addItem:(a,s)=>{const l={key:a,...s};return e.items.push(l),t},clear:()=>(e.items=[],t)};return t}),this.addGroup=(e,t)=>{const s={key:e,label:t,items:[]};return oe(this,Z).push(s),oe(this,De).call(this,s)},this.getGroup=e=>{const t=oe(this,Z).find(a=>a.key===e);if(!t)throw new Error(`Group with key ${e} not found`);return oe(this,De).call(this,t)},this.build=()=>oe(this,Z)}}Z=new WeakMap;De=new WeakMap;function $s(n,e,t){var a,s,l,r,c,u,y,_,b,C,M,W,N,G,be,m,d,w,L,H,st,at,lt,ot,it,rt,dt,ut,ct,ht,pt,mt,ft,vt,wt,kt,yt,Mt,bt,_t,gt,$t,Ct,It,Lt,Wt,Tt,St,Et,Ht,Bt,xt;const Rt=t==null?void 0:t.get(Qn),Mn=Rt==null?void 0:Rt.includes(Yn.Latex),ae=new gs;ae.addGroup("text",(a=e==null?void 0:e.slashMenuTextGroupLabel)!=null?a:"Text").addItem("text",{label:(s=e==null?void 0:e.slashMenuTextGroupLabel)!=null?s:"Text",icon:(r=(l=e==null?void 0:e.slashMenuTextIcon)==null?void 0:l.call(e))!=null?r:Sn,onRun:i=>{const h=i.get($),{dispatch:f,state:v}=h;F(Xt.type(i))(v,f)}}).addItem("h1",{label:(c=e==null?void 0:e.slashMenuH1Label)!=null?c:"Heading 1",icon:(y=(u=e==null?void 0:e.slashMenuH1Icon)==null?void 0:u.call(e))!=null?y:En,onRun:i=>{const h=i.get($),{dispatch:f,state:v}=h;F(U.type(i),{level:1})(v,f)}}).addItem("h2",{label:(_=e==null?void 0:e.slashMenuH2Label)!=null?_:"Heading 2",icon:(C=(b=e==null?void 0:e.slashMenuH2Icon)==null?void 0:b.call(e))!=null?C:Hn,onRun:i=>{const h=i.get($),{dispatch:f,state:v}=h;F(U.type(i),{level:2})(v,f)}}).addItem("h3",{label:(M=e==null?void 0:e.slashMenuH3Label)!=null?M:"Heading 3",icon:(N=(W=e==null?void 0:e.slashMenuH3Icon)==null?void 0:W.call(e))!=null?N:Bn,onRun:i=>{const h=i.get($),{dispatch:f,state:v}=h;F(U.type(i),{level:3})(v,f)}}).addItem("h4",{label:(G=e==null?void 0:e.slashMenuH4Label)!=null?G:"Heading 4",icon:(m=(be=e==null?void 0:e.slashMenuH4Icon)==null?void 0:be.call(e))!=null?m:xn,onRun:i=>{const h=i.get($),{dispatch:f,state:v}=h;F(U.type(i),{level:4})(v,f)}}).addItem("h5",{label:(d=e==null?void 0:e.slashMenuH5Label)!=null?d:"Heading 5",icon:(L=(w=e==null?void 0:e.slashMenuH5Icon)==null?void 0:w.call(e))!=null?L:Rn,onRun:i=>{const h=i.get($),{dispatch:f,state:v}=h;F(U.type(i),{level:5})(v,f)}}).addItem("h6",{label:(H=e==null?void 0:e.slashMenuH6Label)!=null?H:"Heading 6",icon:(at=(st=e==null?void 0:e.slashMenuH6Icon)==null?void 0:st.call(e))!=null?at:An,onRun:i=>{const h=i.get($),{dispatch:f,state:v}=h;F(U.type(i),{level:6})(v,f)}}).addItem("quote",{label:(lt=e==null?void 0:e.slashMenuQuoteLabel)!=null?lt:"Quote",icon:(it=(ot=e==null?void 0:e.slashMenuQuoteIcon)==null?void 0:ot.call(e))!=null?it:Dn,onRun:i=>{const h=i.get($),{dispatch:f,state:v}=h;ge(Xn.type(i))(v,f)}}).addItem("divider",{label:(rt=e==null?void 0:e.slashMenuDividerLabel)!=null?rt:"Divider",icon:(ut=(dt=e==null?void 0:e.slashMenuDividerIcon)==null?void 0:dt.call(e))!=null?ut:On,onRun:i=>{const h=i.get($),{dispatch:f,state:v}=h;$e(Zn.type(i))(v,f)}}),ae.addGroup("list",(ct=e==null?void 0:e.slashMenuListGroupLabel)!=null?ct:"List").addItem("bullet-list",{label:(ht=e==null?void 0:e.slashMenuBulletListLabel)!=null?ht:"Bullet List",icon:(mt=(pt=e==null?void 0:e.slashMenuBulletListIcon)==null?void 0:pt.call(e))!=null?mt:Pn,onRun:i=>{const h=i.get($),{dispatch:f,state:v}=h;ge(jn.type(i))(v,f)}}).addItem("ordered-list",{label:(ft=e==null?void 0:e.slashMenuOrderedListLabel)!=null?ft:"Ordered List",icon:(wt=(vt=e==null?void 0:e.slashMenuOrderedListIcon)==null?void 0:vt.call(e))!=null?wt:Nn,onRun:i=>{const h=i.get($),{dispatch:f,state:v}=h;ge(es.type(i))(v,f)}}).addItem("todo-list",{label:(kt=e==null?void 0:e.slashMenuTaskListLabel)!=null?kt:"Todo List",icon:(Mt=(yt=e==null?void 0:e.slashMenuTaskListIcon)==null?void 0:yt.call(e))!=null?Mt:Gn,onRun:i=>{const h=i.get($),{dispatch:f,state:v}=h;ge(ts.type(i),{checked:!1})(v,f)}});const bn=ae.addGroup("advanced",(bt=e==null?void 0:e.slashMenuAdvancedGroupLabel)!=null?bt:"Advanced").addItem("image",{label:(_t=e==null?void 0:e.slashMenuImageLabel)!=null?_t:"Image",icon:($t=(gt=e==null?void 0:e.slashMenuImageIcon)==null?void 0:gt.call(e))!=null?$t:Fn,onRun:i=>{const h=i.get($),{dispatch:f,state:v}=h;$e(is.type(i))(v,f)}}).addItem("code",{label:(Ct=e==null?void 0:e.slashMenuCodeBlockLabel)!=null?Ct:"Code",icon:(Lt=(It=e==null?void 0:e.slashMenuCodeBlockIcon)==null?void 0:It.call(e))!=null?Lt:qn,onRun:i=>{const h=i.get($),{dispatch:f,state:v}=h;$e(Nt.type(i))(v,f)}}).addItem("table",{label:(Wt=e==null?void 0:e.slashMenuTableLabel)!=null?Wt:"Table",icon:(St=(Tt=e==null?void 0:e.slashMenuTableIcon)==null?void 0:Tt.call(e))!=null?St:zn,onRun:i=>{const h=i.get($),{dispatch:f,state:v}=h;let{tr:g}=v;g=Fe(g);const qe=g.selection.from,_n=ns(i,3,3);g=g.replaceSelectionWith(_n),f(g),requestAnimationFrame(()=>{const Dt=h.state.doc.content.size,gn=h.state.doc.resolve(qe>Dt?Dt:qe<0?0:qe),$n=Ye.near(gn),Ot=h.state.tr;Ot.setSelection($n),f(Ot.scrollIntoView())})}});Mn&&bn.addItem("math",{label:(Et=e==null?void 0:e.slashMenuMathLabel)!=null?Et:"Math",icon:(Bt=(Ht=e==null?void 0:e.slashMenuMathIcon)==null?void 0:Ht.call(e))!=null?Bt:Kn,onRun:i=>{const h=i.get($),{dispatch:f,state:v}=h;$e(Nt.type(i),{language:"LaTex"})(v,f)}}),(xt=e==null?void 0:e.buildMenu)==null||xt.call(e,ae);let le=ae.build();n&&(le=le.map(i=>{const h=i.items.filter(f=>f.label.toLowerCase().includes(n.toLowerCase()));return{...i,items:h}}).filter(i=>i.items.length>0));const At=le.flatMap(i=>i.items);return At.forEach((i,h)=>{Object.assign(i,{index:h})}),le.reduce((i,h)=>{const f=i+h.items.length;return Object.assign(h,{range:[i,f]}),f},0),{groups:le,size:At.length}}const cn=({show:n,hide:e,ctx:t,filter:a,config:s})=>{const{groups:l,size:r}=Pt(()=>$s(a,s,t),[a]),c=Tn(),[u,y]=Vn(0),_=Pt(()=>c.current.getRootNode(),[c]),b=Jt({x:-999,y:-999}),C=V(m=>{const d=b.current;if(!d)return;const{x:w,y:L}=m;d.x=w,d.y=L},[]);Ue(()=>{r===0&&n?e==null||e():u>=r&&y(0)},[r,n]);const M=V((m,d)=>{y(w=>{const L=typeof m=="function"?m(w):m;return d==null||d(L),L})},[]),W=V(m=>{const d=c.current.querySelector(`[data-index="${m}"]`),w=c.current.querySelector(".menu-groups");!d||!w||(w.scrollTop=d.offsetTop-w.offsetTop)},[]),N=V(m=>{const d=l.flatMap(w=>w.items).at(m);d&&t&&d.onRun(t),e==null||e()},[l]),G=V(m=>{if(m.key==="Escape"){m.preventDefault(),e==null||e();return}if(m.key==="ArrowDown")return m.preventDefault(),M(d=>d<r-1?d+1:d,W);if(m.key==="ArrowUp")return m.preventDefault(),M(d=>d<=0?d:d-1,W);if(m.key==="ArrowLeft")return m.preventDefault(),M(d=>{const w=l.find(H=>H.range[0]<=d&&H.range[1]>d);if(!w)return d;const L=l[l.indexOf(w)-1];return L?L.range[1]-1:d},W);if(m.key==="ArrowRight")return m.preventDefault(),M(d=>{const w=l.find(H=>H.range[0]<=d&&H.range[1]>d);if(!w)return d;const L=l[l.indexOf(w)+1];return L?L.range[0]:d},W);m.key==="Enter"&&(m.preventDefault(),N(u))},[e,l,u]),be=V(m=>d=>{const w=b.current;if(!w)return;const{x:L,y:H}=d;L===w.x&&H===w.y||M(m)},[]);return Ue(()=>(n?_.addEventListener("keydown",G,{capture:!0}):_.removeEventListener("keydown",G,{capture:!0}),()=>{_.removeEventListener("keydown",G,{capture:!0})}),[n,G]),re`
    <host onmousedown=${m=>m.preventDefault()}>
      <nav class="tab-group">
        <ul>
          ${l.map(m=>re`<li
                key=${m.key}
                onmousedown=${()=>M(m.range[0],W)}
                class=${u>=m.range[0]&&u<m.range[1]?"selected":""}
              >
                ${m.label}
              </li>`)}
        </ul>
      </nav>
      <div class="menu-groups" onmousemove=${C}>
        ${l.map(m=>re`
            <div key=${m.key} class="menu-group">
              <h6>${m.label}</h6>
              <ul>
                ${m.items.map(d=>re`<li
                      key=${d.key}
                      data-index=${d.index}
                      class=${u===d.index?"hover":""}
                      onmouseenter=${be(d.index)}
                      onmousedown=${()=>{var w;(w=c.current.querySelector(`[data-index="${d.index}"]`))==null||w.classList.add("active")}}
                      onmouseup=${()=>{var w;(w=c.current.querySelector(`[data-index="${d.index}"]`))==null||w.classList.remove("active"),N(d.index)}}
                    >
                      ${d.icon}
                      <span>${d.label}</span>
                    </li>`)}
              </ul>
            </div>
          `)}
      </div>
    </host>
  `};cn.props={ctx:Object,config:Object,show:Boolean,filter:String,hide:Function};const hn=Ut(cn);var pn=n=>{throw TypeError(n)},mn=(n,e,t)=>e.has(n)||pn("Cannot "+t),I=(n,e,t)=>(mn(n,e,"read from private field"),t?t.call(n):e.get(n)),ze=(n,e,t)=>e.has(n)?pn("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),ie=(n,e,t,a)=>(mn(n,e,"write to private field"),e.set(n,t),t),S,O,j;const fn=ws("CREPE_MENU"),nt=Me({show:()=>{},hide:()=>{}},"menuAPICtx");Vt("milkdown-slash-menu",hn);function Cs(n,e){n.set(fn.key,{view:t=>new Is(n,t,e)})}class Is{constructor(e,t,a){ze(this,S),ze(this,O),ze(this,j,null),this.update=l=>{I(this,O).update(l)},this.show=l=>{ie(this,j,l),I(this,S).filter="",I(this,O).show()},this.hide=()=>{ie(this,j,null),I(this,O).hide()},this.destroy=()=>{I(this,O).destroy(),I(this,S).remove()},ie(this,S,new hn),I(this,S).hide=this.hide,I(this,S).ctx=e,I(this,S).config=a;const s=this;ie(this,O,new ks({content:I(this,S),debounce:20,shouldShow(l){if(Cn(l.state.selection)||In(l.state.selection))return!1;const r=this.getContent(l,u=>["paragraph","heading"].includes(u.type.name));if(r==null)return!1;const c=I(s,j);return I(s,S).filter=r.startsWith("/")?r.slice(1):r,typeof c=="number"?l.state.doc.resolve(c).node()!==l.state.doc.resolve(l.state.selection.from).node()?(ie(s,j,null),!1):!0:!!r.startsWith("/")},offset:10})),I(this,O).onShow=()=>{I(this,S).show=!0},I(this,O).onHide=()=>{I(this,S).show=!1},this.update(t),e.set(nt.key,{show:l=>this.show(l),hide:()=>this.hide()})}}S=new WeakMap;O=new WeakMap;j=new WeakMap;const vn=({onAdd:n,addIcon:e,handleIcon:t})=>{const a=Jt();return Ue(()=>{var r;(r=a.current)==null||r.classList.remove("active")}),re`
    <host>
      <div
        ref=${a}
        onmousedown=${r=>{var c;r.preventDefault(),r.stopPropagation(),(c=a.current)==null||c.classList.add("active")}}
        onmouseup=${r=>{var c;r.preventDefault(),r.stopPropagation(),n==null||n(),(c=a.current)==null||c.classList.remove("active")}}
        class="operation-item"
      >
        ${(e==null?void 0:e())||Ln}
      </div>
      <div class="operation-item">${(t==null?void 0:t())||Wn}</div>
    </host>
  `};vn.props={show:Boolean,onAdd:Function,addIcon:Function,handleIcon:Function};const wn=Ut(vn);var kn=n=>{throw TypeError(n)},yn=(n,e,t)=>e.has(n)||kn("Cannot "+t),D=(n,e,t)=>(yn(n,e,"read from private field"),t?t.call(n):e.get(n)),Ke=(n,e,t)=>e.has(n)?kn("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),Ve=(n,e,t,a)=>(yn(n,e,"write to private field"),e.set(n,t),t),z,K,Oe;class Ls{constructor(e,t){Ke(this,z),Ke(this,K),Ke(this,Oe),this.update=()=>{D(this,K).update()},this.destroy=()=>{D(this,K).destroy(),D(this,z).remove()},this.onAdd=()=>{const s=D(this,Oe),l=s.get($);l.hasFocus()||l.focus();const{state:r,dispatch:c}=l,u=D(this,K).active;if(!u)return;const _=u.$pos.pos+u.node.nodeSize;let b=r.tr.insert(_,Xt.type(s).create());b=b.setSelection(Ye.near(b.doc.resolve(_))),c(b.scrollIntoView()),D(this,K).hide(),s.get(nt.key).show(b.selection.from)},Ve(this,Oe,e);const a=new wn;Ve(this,z,a),D(this,z).onAdd=this.onAdd,D(this,z).addIcon=t==null?void 0:t.handleAddIcon,D(this,z).handleIcon=t==null?void 0:t.handleDragIcon,Ve(this,K,new fs({ctx:e,content:a,getOffset:()=>16,getPlacement:({active:s,blockDom:l})=>{if(s.node.type.name==="heading")return"left";let r=0;s.node.descendants(N=>{r+=N.childCount});const c=s.el,u=c.getBoundingClientRect(),y=l.getBoundingClientRect(),_=window.getComputedStyle(c),b=Number.parseInt(_.paddingTop,10)||0,C=Number.parseInt(_.paddingBottom,10)||0,M=u.height-b-C,W=y.height;return r>2||W<M?"left-start":"left"}})),this.update()}}z=new WeakMap;K=new WeakMap;Oe=new WeakMap;Vt("milkdown-block-handle",wn);function Ws(n,e){n.set(se.key,{filterNodes:t=>!Yt(s=>["table","blockquote","math_inline"].includes(s.type.name))(t)}),n.set(Ge.key,{view:()=>new Ls(n,e)})}const zs=(n,e)=>{n.config(t=>Ws(t,e)).config(t=>Cs(t,e)).use(nt).use(Ge).use(fn)};export{zs as defineFeature};
