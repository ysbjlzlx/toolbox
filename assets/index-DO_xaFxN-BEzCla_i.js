import{aD as F,aE as O,aB as V}from"./md-editor-C6otpRZL.js";import{F as B,C as A,k as C,o as y,W as S,c as D,d as P}from"./index-DwPuSZv8.js";import{m as I,a as R}from"./inline-latex-C9IGAXXQ-DRybRJrd.js";import{d as X}from"./index-D6fLMv29-CeGVhQwU.js";import{j as q,b as z,h as G,i as H}from"./functions-Bsik6ikd-BaRT4VwH.js";import{c as U}from"./index.es-DsErxJOC.js";import{W as Y,V as Z}from"./index.es-DNOfJYMK.js";import{N as J,E as K,c as Q,k as j,S as ee,r as E,u as te}from"./index-i1pBeVdL.js";import"./pro-components-L2sDkqQs.js";import"./antd-Bzy0GL_f.js";import"./json-editor-CBqK5HSN.js";import"./ace-BbTluGSE.js";import"./index-08JC0wQa.js";import"./hooks-Bj5sJKsH.js";import"./floating-ui.dom-DtR07Cup.js";import"./index-0oxnn2GF.js";import"./index-DKaaQcYk.js";const ne=C("remarkMath",()=>O);function ae(e){return V(e,"math",(t,n,s)=>{const{value:a}=t,o={type:"code",lang:"LaTeX",value:a};s.children.splice(n,1,o)})}const re=C("remarkMathBlock",()=>()=>ae),L=({config:e,innerView:t,updateValue:n})=>{var s;const a=o=>{o.preventDefault(),n==null||n()};return G`
    <host>
      <div class="container">
        ${t&&H(t.dom,{})}
        <button onmousedown=${a}>
          ${(s=e==null?void 0:e.inlineEditConfirm)==null?void 0:s.call(e)}
        </button>
      </div>
    </host>
  `};L.props={config:Object,innerView:Object,updateValue:Function};const $=z(L),x=Y("INLINE_LATEX");var W=e=>{throw TypeError(e)},b=(e,t,n)=>t.has(e)||W("Cannot "+n),r=(e,t,n)=>(b(e,t,"read from private field"),n?n.call(e):t.get(e)),c=(e,t,n)=>t.has(e)?W("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),m=(e,t,n,s)=>(b(e,t,"write to private field"),t.set(e,n),n),d,h,w,u,k,v;class oe{constructor(t,n,s){this.ctx=t,c(this,d,new $),c(this,h),c(this,w),c(this,u),c(this,k,()=>{r(this,u)&&(r(this,u).destroy(),m(this,u,null))}),c(this,v,a=>{const i=(()=>{const{selection:l,schema:f}=a.state;if(l.empty||!(l instanceof J))return!1;const M=l.node;if(M.type.name!==R)return!1;const T=l.from,N=f.nodes.paragraph.create(null,f.text(M.attrs.value)),_=new K(r(this,w),{state:Q.create({doc:N,schema:new ee({nodes:{doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return["p",0]}},text:{group:"inline"}}}),plugins:[j({"Mod-z":te,"Mod-Z":E,"Mod-y":E,Enter:()=>{var p,g;return(g=(p=r(this,d)).updateValue)==null||g.call(p),!0}})]})});return m(this,u,_),r(this,d).innerView=r(this,u),r(this,d).updateValue=()=>{const{tr:p}=a.state;p.setNodeAttribute(T,"value",_.state.doc.textContent),a.dispatch(p),requestAnimationFrame(()=>{a.focus()})},!0})();return i||r(this,k).call(this),i}),this.update=(a,o)=>{r(this,h).update(a,o)},this.destroy=()=>{r(this,h).destroy(),r(this,d).remove()},m(this,h,new Z({debounce:0,content:r(this,d),shouldShow:r(this,v),offset:10,floatingUIOptions:{placement:"bottom"}})),r(this,d).config=s,r(this,h).update(n),m(this,w,document.createElement("div")),m(this,u,null)}}d=new WeakMap;h=new WeakMap;w=new WeakMap;u=new WeakMap;k=new WeakMap;v=new WeakMap;const se=y(e=>D(/(?:\$)([^$]+)(?:\$)$/,I.type(e),{getAttr:t=>{var n;return{value:(n=t[1])!=null?n:""}}})),ie=y(e=>P(/^\$\$[\s\n]$/,S.type(e),()=>({language:"LaTeX"}))),le=S.extendSchema(e=>t=>{const n=e(t);return{...n,toMarkdown:{match:n.toMarkdown.match,runner:(s,a)=>{var o,i;if(((o=a.attrs.language)!=null?o:"").toLowerCase()==="latex")s.addNode("math",void 0,((i=a.content.firstChild)==null?void 0:i.text)||"");else return n.toMarkdown.runner(s,a)}}}});X("milkdown-latex-inline-edit",$);const Ie=(e,t)=>{e.config(n=>{if(!n.get(B).includes(A.CodeMirror))throw new Error("You need to enable CodeMirror to use LaTeX feature");n.update(U.key,o=>({...o,renderPreview:(i,l)=>{if(i.toLowerCase()==="latex"&&l.length>0)return de(l,t==null?void 0:t.katexOptions);const f=o.renderPreview;return f(i,l)}})),n.set(x.key,{view:o=>{var i;return new oe(n,o,{inlineEditConfirm:(i=t==null?void 0:t.inlineEditConfirm)!=null?i:()=>q,...t})}})}).use(ne).use(re).use(I).use(x).use(se).use(ie).use(le)};function de(e,t){return F.renderToString(e,{...t,throwOnError:!1,displayMode:!0})}export{Ie as defineFeature};
